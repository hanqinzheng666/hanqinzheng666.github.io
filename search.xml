<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[åŸºäºŽJWTçš„tokenèº«ä»½è®¤è¯]]></title>
    <url>%2F2019%2F10%2F21%2F%E5%9F%BA%E4%BA%8EJWT%E7%9A%84token%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%2F</url>
    <content type="text"><![CDATA[åŸºäºŽJWTçš„tokenèº«ä»½è®¤è¯ä¸€ã€JWT(JSON Web Token)æ˜¯ä»€ä¹ˆï¼ŸJWTæ˜¯åŸºäºŽtokençš„èº«ä»½è®¤è¯çš„æ–¹æ¡ˆï¼Œå…¨ç§°json web tokenã€‚å¯ä»¥ä¿è¯å®‰å…¨ä¼ è¾“çš„å‰æä¸‹ä¼ é€ä¸€äº›åŸºæœ¬çš„ä¿¡æ¯ï¼Œä»¥å‡è½»å¯¹å¤–éƒ¨å­˜å‚¨çš„ä¾èµ–ï¼Œå‡å°‘äº†åˆ†å¸ƒå¼ç»„ä»¶çš„ä¾èµ–ï¼Œå‡å°‘äº†ç¡¬ä»¶çš„èµ„æºã€‚ å¯å®žçŽ°æ— çŠ¶æ€ã€åˆ†å¸ƒå¼çš„Webåº”ç”¨æŽˆæƒï¼Œjwtçš„å®‰å…¨ç‰¹æ€§ä¿è¯äº†tokençš„ä¸å¯ä¼ªé€ å’Œä¸å¯ç¯¡æ”¹ã€‚ æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„èº«ä»½éªŒè¯ä»¤ç‰Œï¼Œå¯ä»¥åŒ…å«ç”¨æˆ·æ ‡è¯†ã€ç”¨æˆ·è§’è‰²å’Œæƒé™ç­‰ä¿¡æ¯ï¼Œä»¥åŠæ‚¨å¯ä»¥å­˜å‚¨ä»»ä½•å…¶ä»–ä¿¡æ¯ï¼ˆè‡ªåŒ…å«ï¼‰ã€‚ä»»ä½•äººéƒ½å¯ä»¥è½»æ¾è¯»å–å’Œè§£æžï¼Œå¹¶ä½¿ç”¨å¯†é’¥æ¥éªŒè¯çœŸå®žæ€§ã€‚ ç¼ºé™·ï¼š 1ï¼‰JWTåœ¨ç”Ÿæˆtokençš„æ—¶å€™æ”¯æŒå¤±æ•ˆæ—¶é—´ï¼Œä½†æ˜¯æ”¯æŒçš„å¤±æ•ˆæ—¶é—´æ˜¯å›ºå®šçš„ï¼Œæ¯”å¦‚è¯´ä¸€å¤©ï¼Œç”¨æˆ·åœ¨ç­‰å‡ºçš„æ—¶å€™æ˜¯éšæœºè§¦å‘çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬jwt tokenæ¥åšè¿™ä¸ªå¤±æ•ˆæ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºjwtåœ¨åˆå§‹åŒ–çš„æ—¶å€™å·²ç»å®šæ­»åœ¨ä»€ä¹ˆæ—¶å€™è¿‡æœŸäº†ã€‚é‡‡ç”¨å…¶ä»–æ–¹æ¡ˆï¼Œåœ¨redisä¸­å­˜å‚¨tokenï¼Œè®¾ç½®tokençš„è¿‡æœŸæ—¶é—´ï¼Œæ¯æ¬¡é‰´æƒçš„æ—¶å€™éƒ½ä¼šåŽ»å»¶é•¿æ—¶é—´ 2ï¼‰jwtä¸é€‚åˆå­˜æ”¾å¤§é‡ä¿¡æ¯ï¼Œä¿¡æ¯è¶Šå¤štokenè¶Šé•¿ JWTåŒ…å«ä¸‰éƒ¨åˆ†æ•°æ®ï¼š Headerï¼šå¤´éƒ¨ï¼Œé€šå¸¸å¤´éƒ¨æœ‰ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼š å£°æ˜Žç±»åž‹ï¼Œè¿™é‡Œæ˜¯JWT åŠ å¯†ç®—æ³•ï¼Œè‡ªå®šä¹‰ æˆ‘ä»¬ä¼šå¯¹å¤´éƒ¨è¿›è¡Œbase64åŠ å¯†ï¼ˆå¯è§£å¯†ï¼‰ï¼Œå¾—åˆ°ç¬¬ä¸€éƒ¨åˆ†æ•°æ® Payloadï¼šè½½è·ï¼Œå°±æ˜¯æœ‰æ•ˆæ•°æ®ï¼Œä¸€èˆ¬åŒ…å«ä¸‹é¢ä¿¡æ¯ï¼š ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œå› ä¸ºé‡‡ç”¨base64åŠ å¯†ï¼Œå¯è§£å¯†ï¼Œå› æ­¤ä¸è¦å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼‰ æ³¨å†Œå£°æ˜Žï¼šå¦‚tokençš„ç­¾å‘æ—¶é—´ï¼Œè¿‡æœŸæ—¶é—´ï¼Œç­¾å‘äººç­‰ è¿™éƒ¨åˆ†ä¹Ÿä¼šé‡‡ç”¨base64åŠ å¯†ï¼Œå¾—åˆ°ç¬¬äºŒéƒ¨åˆ†æ•°æ® Signatureï¼šç­¾åï¼Œæ˜¯æ•´ä¸ªæ•°æ®çš„è®¤è¯ä¿¡æ¯ã€‚ä¸€èˆ¬æ ¹æ®å‰ä¸¤æ­¥çš„æ•°æ®ï¼Œå†åŠ ä¸ŠæœåŠ¡çš„çš„å¯†é’¥ï¼ˆsecretï¼‰ï¼ˆä¸è¦æ³„æ¼ï¼Œæœ€å¥½å‘¨æœŸæ€§æ›´æ¢ï¼‰ï¼Œé€šè¿‡åŠ å¯†ç®—æ³•ç”Ÿæˆã€‚ç”¨äºŽéªŒè¯æ•´ä¸ªæ•°æ®å®Œæ•´å’Œå¯é æ€§ ç”Ÿæˆçš„æ•°æ®æ ¼å¼ï¼š äºŒã€ä½¿ç”¨JWT(JSON Web Token)çš„å¥½å¤„ï¼Ÿ1.æ€§èƒ½é—®é¢˜ã€‚JWTæ–¹å¼å°†ç”¨æˆ·çŠ¶æ€åˆ†æ•£åˆ°äº†å®¢æˆ·ç«¯ä¸­ï¼Œç›¸æ¯”äºŽsessionï¼Œå¯ä»¥æ˜Žæ˜¾å‡è½»æœåŠ¡ç«¯çš„å†…å­˜åŽ‹åŠ›ã€‚ Sessionæ–¹å¼å­˜å‚¨ç”¨æˆ·idçš„æœ€å¤§å¼Šç—…åœ¨äºŽSessionæ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„ï¼Œæ‰€ä»¥éœ€è¦å ç”¨å¤§é‡æœåŠ¡å™¨å†…å­˜ï¼Œ å¯¹äºŽè¾ƒå¤§åž‹åº”ç”¨è€Œè¨€å¯èƒ½è¿˜è¦ä¿å­˜è®¸å¤šçš„çŠ¶æ€ï¼Œä¸€èˆ¬è¿˜éœ€å€ŸåŠ©nosqlå’Œç¼“å­˜æœºåˆ¶æ¥å®žçŽ°sessionçš„å­˜å‚¨ï¼Œå¦‚æžœæ˜¯åˆ†å¸ƒå¼åº”ç”¨è¿˜éœ€sessionå…±äº«ã€‚ 2.å•ç‚¹ç™»å½•ã€‚JWTèƒ½è½»æ¾çš„å®žçŽ°å•ç‚¹ç™»å½•ï¼Œå› ä¸ºç”¨æˆ·çš„çŠ¶æ€å·²ç»è¢«ä¼ é€åˆ°äº†å®¢æˆ·ç«¯ã€‚ token å¯ä¿å­˜è‡ªå®šä¹‰ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ŒwebæœåŠ¡å™¨ç”¨keyåŽ»è§£æžtokenï¼Œå°±èŽ·å–åˆ°è¯·æ±‚ç”¨æˆ·çš„ä¿¡æ¯äº†ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½®å®ƒä»¥ä¾¿åŒ…å«ç”¨æˆ·æ‹¥æœ‰çš„ä»»ä½•æƒé™ã€‚è¿™æ„å‘³ç€æ¯ä¸ªæœåŠ¡ä¸éœ€è¦ä¸ŽæŽˆæƒæœåŠ¡äº¤äº’æ‰èƒ½æŽˆæƒç”¨æˆ·ã€‚ 3.å‰åŽç«¯åˆ†ç¦»ã€‚ä»¥å‰çš„ä¼ ç»Ÿæ¨¡å¼ä¸‹ï¼ŒåŽå°å¯¹åº”çš„å®¢æˆ·ç«¯å°±æ˜¯æµè§ˆå™¨ï¼Œå°±å¯ä»¥ä½¿ç”¨session+cookiesçš„æ–¹å¼å®žçŽ°ç™»å½•ï¼Œ ä½†æ˜¯åœ¨å‰åŽåˆ†ç¦»çš„æƒ…å†µä¸‹ï¼ŒåŽç«¯åªè´Ÿè´£é€šè¿‡æš´éœ²çš„RestApiæä¾›æ•°æ®ï¼Œè€Œé¡µé¢çš„æ¸²æŸ“ã€è·¯ç”±éƒ½ç”±å‰ç«¯å®Œæˆã€‚å› ä¸ºrestæ˜¯æ— çŠ¶æ€çš„ï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šæœ‰sessionè®°å½•åˆ°æœåŠ¡å™¨ç«¯ã€‚ 4.å…¼å®¹æ€§ã€‚æ”¯æŒç§»åŠ¨è®¾å¤‡ï¼Œæ”¯æŒè·¨ç¨‹åºè°ƒç”¨ï¼ŒCookie æ˜¯ä¸å…è®¸åž®åŸŸè®¿é—®çš„ï¼Œè€Œ Token åˆ™ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚ 5.å¯æ‹“å±•æ€§ã€‚jwtæ˜¯æ— çŠ¶æ€çš„ï¼Œç‰¹åˆ«é€‚ç”¨äºŽåˆ†å¸ƒå¼ç«™ç‚¹çš„å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰åœºæ™¯ã€‚ æ¯”å¦‚æœ‰3å°æœºå™¨ï¼ˆAã€Bã€Cï¼‰ç»„æˆæœåŠ¡å™¨é›†ç¾¤ï¼Œè‹¥sessionå­˜åœ¨æœºå™¨Aä¸Šï¼Œsessionåªèƒ½ä¿å­˜åœ¨å…¶ä¸­ä¸€å°æœåŠ¡å™¨ï¼Œæ­¤æ—¶ä½ ä¾¿ä¸èƒ½è®¿é—®æœºå™¨Bã€Cï¼Œå› ä¸ºBã€Cä¸Šæ²¡æœ‰å­˜æ”¾è¯¥Sessionï¼Œ è€Œä½¿ç”¨tokenå°±èƒ½å¤ŸéªŒè¯ç”¨æˆ·è¯·æ±‚åˆæ³•æ€§ï¼Œå¹¶ä¸”æˆ‘å†åŠ å‡ å°æœºå™¨ä¹Ÿæ²¡äº‹ï¼Œæ‰€ä»¥å¯æ‹“å±•æ€§å¥½ã€‚ 6.å®‰å…¨æ€§ã€‚å› ä¸ºæœ‰ç­¾åï¼Œæ‰€ä»¥JWTå¯ä»¥é˜²æ­¢è¢«ç¯¡æ”¹ã€‚ ä¸‰ã€JWT(JSON Web Token)å·¥ä½œåŽŸç† åˆæ¬¡ç™»å½•ï¼šç”¨æˆ·åˆæ¬¡ç™»å½•ï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç  å¯†ç éªŒè¯ï¼šæœåŠ¡å™¨ä»Žæ•°æ®åº“å–å‡ºç”¨æˆ·åå’Œå¯†ç è¿›è¡ŒéªŒè¯ ç”ŸæˆJWTï¼šæœåŠ¡å™¨ç«¯éªŒè¯é€šè¿‡ï¼Œæ ¹æ®ä»Žæ•°æ®åº“è¿”å›žçš„ä¿¡æ¯ï¼Œä»¥åŠé¢„è®¾è§„åˆ™ï¼Œç”ŸæˆJWT è¿”è¿˜JWTï¼šæœåŠ¡å™¨çš„å°†tokenæ”¾åœ¨cookieä¸­å°†JWTè¿”è¿˜ å¸¦JWTçš„è¯·æ±‚ï¼šä»¥åŽå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼Œå¸¦ä¸Šcookieä¸­çš„tokenä¿¡æ¯ã€‚ å››ã€jwt+redisçš„ç™»å½•æ–¹æ¡ˆæµç¨‹ï¼š å‰ç«¯æœåŠ¡å™¨æ”¶åˆ°ç”¨æˆ·ç™»å½•è¯·æ±‚ï¼Œä¼ ç»™åŽå°APIç½‘å…³ã€‚ APIç½‘å…³æŠŠè¯·æ±‚åˆ†å‘åˆ°ç”¨æˆ·æœåŠ¡é‡Œè¿›è¡Œèº«ä»½éªŒè¯ã€‚ åŽå°ç”¨æˆ·æœåŠ¡éªŒè¯é€šè¿‡ï¼Œç„¶åŽä»Žè´¦å·ä¿¡æ¯æŠ½å–å‡ºuserNameã€login_timeç­‰åŸºæœ¬ä¿¡æ¯ç»„æˆpayloadï¼Œè¿›è€Œç»„è£…ä¸€ä¸ªJWTï¼ŒæŠŠJWTæ”¾å…¥redis(å› ä¸ºé€€å‡ºçš„æ—¶å€™æ— æ³•ä½¿jwtç«‹å³ä½œåºŸï¼Œæ‰€ä»¥ä½¿ç”¨ä¿å­˜åœ¨redisä¸­ï¼Œé€€å‡ºçš„æ—¶å€™deleteæŽ‰å°±å¯ä»¥äº†ï¼Œé‰´æƒçš„æ—¶å€™åŠ ä¸€å±‚åˆ¤æ–­jwtæ˜¯å¦åœ¨redisé‡Œï¼Œå¦‚æžœä¸åœ¨åˆ™è¯æ˜Žjwtå·²è¿‡æœŸä½œåºŸ)ï¼Œç„¶åŽåŒ…è£…cookieä¸­è¿”å›žåˆ°å‰ç«¯æœåŠ¡å™¨ï¼Œè¿™å°±ç™»å½•æˆåŠŸäº†ã€‚ å‰ç«¯æœåŠ¡å™¨æ‹¿åˆ°JWTï¼Œè¿›è¡Œå­˜å‚¨ï¼ˆå¯ä»¥å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¦‚æžœæ˜¯æµè§ˆå™¨ï¼Œå¯ä»¥å­˜å‚¨åœ¨ localStorage ä¸­ï¼Œæˆ‘å®žçŽ°çš„æ˜¯æ”¾å…¥åˆ°cookieé‡Œé¢ï¼‰ ç™»å½•åŽï¼Œå†è®¿é—®å…¶ä»–å¾®æœåŠ¡çš„æ—¶å€™ï¼Œå‰ç«¯ä¼šæºå¸¦jwtè®¿é—®åŽå°ï¼ŒåŽå°æ ¡éªŒ JWTï¼ŒéªŒç­¾é€šè¿‡åŽï¼Œè¿”å›žç›¸åº”èµ„æºå’Œæ•°æ®å°±å¯ä»¥äº†ã€‚ ï¼ˆè¿™é‡Œæ²¡æœ‰å°†redisç”»å‡ºæ¥ï¼‰ ç»“åˆæ‹¦æˆªå™¨ä¸Žä¸Šç¯‡session-cookieæ–¹å¼çš„åŒºåˆ« é¦–æ¬¡ç™»å½•æ­¥éª¤ï¼š 1.é¦–å…ˆAuthInterceptoræ‹¦æˆªå™¨æ‹¦æˆªç”¨æˆ·è¯·æ±‚ï¼Œåœ¨preHandleä¸­çœ‹cookieä¸­æ˜¯å¦æœ‰tokenä¿¡æ¯ï¼Œæ²¡æœ‰å°±æŽ¥ç€æ‹¦æˆªå™¨AuthActionInterceptoræ‹¦æˆªéœ€è¦ç™»å½•çš„urlï¼Œçœ‹threadlocalå½“ä¸­æ˜¯å¦æœ‰userå¯¹è±¡ï¼Œå¦‚æžœæ²¡æœ‰å°±è·³è½¬åˆ°ç™»å½•é¡µé¢è¿›è¡Œç™»å½•ï¼Œç™»å½•æˆåŠŸåŽä¼šå°†userå¯¹è±¡æ”¾åˆ°threadlocalä¸­ã€‚ï¼ˆæ³¨æ„è¿™ä¸ªåœ°æ–¹å’Œæ™®é€šç™»å½•æˆåŠŸåŽå°†useræ”¾åˆ°sessionçš„ä¸åŒï¼‰ ç™»å½•å¤„ç†æµç¨‹ï¼šåœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢éªŒè¯ç”¨æˆ·åå¯†ç ï¼Œé€šè¿‡å°±è®²è´¦å·ä¿¡æ¯æŠ½å–å‡ºusernameã€emailç­‰ä¿¡æ¯ç»„æˆä¸€ä¸ªpayloadï¼Œè¿›è€Œç»„è£…æˆä¸€ä¸ªJWTï¼Œç„¶åŽå°†JWTæ”¾åˆ°rediså½“ä¸­ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ã€‚ ç”Ÿæˆtokenï¼šç»™å®šç­¾åç®—æ³•ã€ç»™å®šè½½è·çš„mapã€è¿›è¡Œç­¾å 2.å½“ä¸šåŠ¡é€»è¾‘å¤„ç†å®Œä¹‹åŽåœ¨AuthInterceptorçš„postHandleä¸­ï¼Œä»ŽthreadlocalèŽ·å–userå¯¹è±¡ä¸­çš„tokenä¿¡æ¯ï¼Œå°†tokenæ”¾åˆ°cookieä¸­è¿”å›žç»™å‰ç«¯ã€‚ 3.è¯·æ±‚ç»“æŸåŽåœ¨AuthInterceptorçš„afterCompletionå°†userä»Žthreadlocalä¸­ç§»é™¤ã€‚ éªŒè¯æµç¨‹ï¼š å‰ç«¯å°†æºå¸¦jwtçš„cookieä¼ åˆ°åŽå°ï¼ŒAuthInterceptorä¼šæ ¹æ®tokenéªŒè¯è§£æžå‡ºuserï¼Œï¼ˆæ³¨æ„æ ¹ä¹‹å‰åœ¨sessionä¸­å–å¯¹è±¡çš„ä¸åŒï¼‰éªŒè¯åŽå†å°†useræ”¾åˆ°threadlocalä¸­ï¼ŒAuthActionInterceptorä¸€çœ‹threadlocalæœ‰userå¯¹è±¡ï¼Œç›´æŽ¥é€šè¿‡ã€‚åŽé¢çš„æ­¥éª¤ä¸€æ ·ã€‚ å‚è€ƒï¼šhttps://www.cnblogs.com/xiangkejin/archive/2018/05/08/9011119.html]]></content>
      <categories>
        <category>JWT</category>
      </categories>
      <tags>
        <tag>JWT</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨Springçš„é‚®ä»¶å°è£…ç±»JavaMailSenderImplå‘é€é‚®ä»¶]]></title>
    <url>%2F2019%2F10%2F08%2F%E4%BD%BF%E7%94%A8Spring%E7%9A%84%E9%82%AE%E4%BB%B6%E5%B0%81%E8%A3%85%E7%B1%BBJavaMailSenderImpl%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨Springçš„é‚®ä»¶å°è£…ç±»JavaMailSenderImplå‘é€é‚®ä»¶å‰è¨€JavaMailSenderImplæ˜¯Springå°è£…çš„é‚®ä»¶å‘é€å°è£…ç±»ï¼Œæ”¯æŒæ™®é€šæ–‡æœ¬ã€é™„ä»¶ã€htmlã€‚SpringBootå®žçŽ°é‚®ä»¶åŠŸèƒ½æ˜¯éžå¸¸çš„æ–¹ä¾¿å¿«æ·çš„ï¼Œå› ä¸ºSpringBooté»˜è®¤æœ‰starterå®žçŽ°äº†Mailã€‚å‘é€é‚®ä»¶åº”è¯¥æ˜¯ç½‘ç«™çš„å¿…å¤‡åŠŸèƒ½ä¹‹ä¸€ï¼Œä»€ä¹ˆæ³¨å†ŒéªŒè¯ï¼Œå¿˜è®°å¯†ç æˆ–è€…æ˜¯ç»™ç”¨æˆ·å‘é€è¥é”€ä¿¡æ¯ã€‚æœ€æ—©æœŸçš„æ—¶å€™æˆ‘ä»¬ä¼šä½¿ç”¨JavaMailç›¸å…³apiæ¥å†™å‘é€é‚®ä»¶çš„ç›¸å…³ä»£ç ï¼ŒåŽæ¥springé€€å‡ºäº†.JavaMailSenderæ›´åŠ ç®€åŒ–äº†é‚®ä»¶å‘é€çš„è¿‡ç¨‹ï¼Œåœ¨ä¹‹åŽspringbootå¯¹æ­¤è¿›è¡Œäº†å°è£…å°±æœ‰äº†çŽ°åœ¨çš„spring-boot-starter-mailã€‚ ä¸€ã€ä½¿ç”¨163.comå‘é€é‚®ä»¶ å¼€å¯POP3/SMTP/IMAPæœåŠ¡ å¼€å¯å¹¶è®¾ç½®é‚®ç®±æŽˆæƒç  å¼•å…¥Springç›¸å¯¹åº”çš„åŒ… 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;&lt;/dependency&gt; åœ¨application.propertiesé…ç½®ç›¸å¯¹åº”çš„å‚æ•° 163é‚®ç®±çš„é…ç½® 123456spring.mail.host=smtp.163.comspring.mail.username=ç”¨æˆ·163é‚®ç®±spring.mail.password=163é‚®ç®±æŽˆæƒç ï¼Œç¬¬äºŒæ­¥è®¾ç½®çš„spring.mail.properties.mail.smtp.auth=truespring.mail.properties.mail.smtp.starttls.enable=truespring.mail.properties.mail.smtp.starttls.required=true qqé‚®ç®±çš„é…ç½® 123456spring.mail.host=smtp.qq.comspring.mail.username=ç”¨æˆ·qqé‚®ç®±spring.mail.password=qqé‚®ç®±æŽˆæƒç ï¼Œç¬¬äºŒæ­¥è®¾ç½®çš„spring.mail.properties.mail.smtp.auth=truespring.mail.properties.mail.smtp.starttls.enable=truespring.mail.properties.mail.smtp.starttls.required=true é˜¿é‡Œäº‘é‚®ç®±çš„è®¾ç½® 123456spring.mail.host=smtp.aliyun.comspring.mail.username=ç”¨æˆ·é˜¿é‡Œäº‘é‚®ç®±spring.mail.password=æ³¨æ„ï¼šé˜¿é‡Œäº‘å¯†ç ï¼Œä¸æ˜¯æŽˆæƒç spring.mail.properties.mail.smtp.auth=truespring.mail.properties.mail.smtp.starttls.enable=truespring.mail.properties.mail.smtp.starttls.required=true å‘é€ç®€å•æ ¼å¼çš„é‚®ä»¶ 1234567891011121314@Autowiredprivate JavaMailSender mailSender;@Value("$&#123;spring.mail.username&#125;")private String from;public void setMail(String title, String text, String email) &#123; SimpleMailMessage message = new SimpleMailMessage(); message.setFrom(from); message.setTo(email); message.setSubject(title); message.setText(text); mailSender.send(message); &#125; æµ‹è¯•å‘é€ç®€å•çš„é‚®ä»¶ 12345678@Testpublic void TestSendMail()&#123; try&#123; mailService.setMail("é‚®ä»¶æµ‹è¯•å‘é€","å¾ˆå¼€å¿ƒèƒ½å‘é€é‚®ä»¶ç»™ä½ ",éœ€è¦å‘é€çš„é‚®ç®±è´¦å·); &#125;catch (Exception e)&#123; logger.error("é‚®ä»¶å‘é€å¤±è´¥",e.getMessage()); &#125; &#125; å‘é€ä¸€ä¸ªHTMLæ ¼å¼çš„é‚®ä»¶ 1234567891011121314public void sendHTMLMail(String recipient,String subject,String content) &#123; MimeMessage mimeMailMessage = null; try &#123; mimeMailMessage = mailSender.createMimeMessage(); MimeMessageHelper mimeMessageHelper = new MimeMessageHelper(mimeMailMessage, true); mimeMessageHelper.setFrom(from); mimeMessageHelper.setTo(recipient); mimeMessageHelper.setSubject(subject); mimeMessageHelper.setText(content, true); mailSender.send(mimeMailMessage); &#125; catch (Exception e) &#123; logger.error("é‚®ä»¶å‘é€å¤±è´¥",e.getMessage()); &#125;&#125; æµ‹è¯•å‘é€HTMLé‚®ä»¶ 12345678@Testpublic void TestSendMail()&#123; StringBuilder sb = new StringBuilder(); sb.append("&lt;h1&gt;SpirngBootæµ‹è¯•é‚®ä»¶HTML&lt;/h1&gt;") .append("\"&lt;p style='color:#F00'&gt;ä½ æ˜¯çœŸçš„å¤ªæ£’äº†ï¼&lt;/p&gt;") .append("&lt;p style='text-align:right'&gt;å³å¯¹é½&lt;/p&gt;"); mailService.sendHTMLMail(é‚®ç®±è´¦å·,"é‚®ä»¶æµ‹è¯•å‘é€",sb.toString()); &#125; å‘é€å¸¦æœ‰é™„ä»¶æ ¼å¼çš„é‚®ä»¶ 123456789101112131415161718public void sendAttachmentMail(String recipient,String subject,String content) &#123; MimeMessage mimeMailMessage = null; try &#123; mimeMailMessage = mailSender.createMimeMessage(); MimeMessageHelper mimeMessageHelper = new MimeMessageHelper(mimeMailMessage, true); mimeMessageHelper.setFrom(from); mimeMessageHelper.setTo(recipient); mimeMessageHelper.setSubject(subject); mimeMessageHelper.setText(content, true); //æ–‡ä»¶è·¯å¾„ FileSystemResource file = new FileSystemResource(new File(""C:\idea_workspace\house\house-web\src\main\resources\static\imgs\property-04.jpg")); mimeMessageHelper.addAttachment(file.getFilename(), file); mailSender.send(mimeMailMessage); &#125; catch (Exception e) &#123; logger.error("é‚®ä»¶å‘é€å¤±è´¥",e.getMessage()); &#125;&#125; æµ‹è¯•å‘é€å¸¦æœ‰é™„ä»¶æ ¼å¼çš„å›¾ç‰‡é‚®ä»¶ 1234@Testpublic void TestSendMail()&#123; mailService.sendAttachmentMail(é‚®ç®±è´¦å·,"é‚®ä»¶æµ‹è¯•å‘é€","æˆ‘çš„å›¾ç‰‡");&#125;]]></content>
      <categories>
        <category>JavaMailSenderImpl</category>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>JavaMailSenderImpl</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring Bootçš„é…ç½®æ–‡ä»¶]]></title>
    <url>%2F2019%2F09%2F26%2FSpring%20Boot%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[Spring Bootçš„é…ç½®æ–‡ä»¶é…ç½®æ–‡ä»¶çš„ä¸¤ç§æ–¹å¼SpringBootä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶åæ˜¯å›ºå®šçš„ application.properties application.yml å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªspringbooté¡¹ç›®çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé»˜è®¤åœ¨src/main/java/resourcesç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªapplication.propertiesã€‚ä½†æ˜¯ä½ ä¹Ÿå¯ä»¥ä¿®æ”¹ä¸ºapplication.yml ä¼˜å…ˆçº§ spring booté¡¹ç›®ä¸­åŒæ—¶å­˜åœ¨application.propertieså’Œapplication.ymlæ–‡ä»¶æ—¶ï¼Œä¸¤ä¸ªæ–‡ä»¶éƒ½æœ‰æ•ˆï¼Œä½†æ˜¯application.propertiesçš„ä¼˜å…ˆçº§ä¼šæ¯”application.ymlé«˜ã€‚ é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸åŒä¼˜å…ˆçº§ä¹Ÿä¸åŒã€‚å¦‚ä¸‹å›¾1~4ä¼˜å…ˆçº§ä»Žé«˜åˆ°ä½Žï¼Œå¦‚ä¸‹å›¾ ymlè¯­æ³•åŸºæœ¬è¯­æ³• k:(ç©ºæ ¼)vï¼šè¡¨ç¤ºä¸€å¯¹é”®å€¼å¯¹ï¼ˆç©ºæ ¼å¿…é¡»æœ‰ï¼‰ï¼› ä»¥ç©ºæ ¼çš„ç¼©è¿›æ¥æŽ§åˆ¶å±‚çº§å…³ç³»ï¼›åªè¦æ˜¯å·¦å¯¹é½çš„ä¸€åˆ—æ•°æ®ï¼Œéƒ½æ˜¯åŒä¸€ä¸ªå±‚çº§çš„ â€œâ€ï¼šåŒå¼•å·ï¼›ä¸ä¼šè½¬ä¹‰å­—ç¬¦ä¸²é‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦ï¼›ç‰¹æ®Šå­—ç¬¦ä¼šä½œä¸ºæœ¬èº«æƒ³è¡¨ç¤ºçš„æ„æ€ 1name: "zhangsan \n lisi"ï¼šè¾“å‡ºï¼›zhangsan æ¢è¡Œ lisi â€ï¼šå•å¼•å·ï¼›ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œç‰¹æ®Šå­—ç¬¦æœ€ç»ˆåªæ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²æ•°æ® 1name: â€˜zhangsan \n lisiâ€™ï¼šè¾“å‡ºï¼›zhangsan \n lisi å…·ä½“çš„å†™æ³•å¦‚ä¸‹(æ³¨é‡Šçš„#ä»£è¡¨çš„æ˜¯applicationå†™æ³•ï¼Œæ²¡æ³¨é‡Šçš„#ä»£è¡¨çš„ymlå†™æ³•) 123456789101112131415161718192021222324person: lastName: å¼ ä¸‰ age: 24 boss: false birth: 1994/5/1# maps: &#123;k1: v1,k2: v2&#125; maps: k1: v1 k2: v2# lists: [l1,l2,l3] lists: - l1 - l2 - l3 dog: name: è›‹é»„ age: 2server: port: 8090 æ•°æ®ç»‘å®šConfigurationProperties123456789101112131415161718192021222324252627282930/***å°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±žæ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶*@ConfigurationPropertiesï¼šå‘Šè¯‰SpringBootå°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±žæ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®š* prefix = "person"ï¼šé…ç½®æ–‡ä»¶ä¸­å“ªä¸ªä¸‹é¢çš„æ‰€æœ‰å±žæ€§è¿›è¡Œä¸€ä¸€æ˜ å°„* åªæœ‰è¿™ä¸ªç»„ä»¶æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½å®¹å™¨æä¾›çš„@ConfigurationPropertiesåŠŸèƒ½*/@Component@Validated //æ•°æ®æ ¡éªŒ@ConfigurationProperties(prefix = "person")public class Person &#123; private String favorite; private String hate; private String name; //æ£€æµ‹å€¼æ˜¯å¦ä¸ºEmailæ ¼å¼ @Email private String email; private Date birth; private int age; private List&lt;String&gt; address; private Map&lt;String,String&gt; childrens; private Dog dog; æˆ‘ä»¬å¯ä»¥å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œä»¥åŽç¼–å†™é…ç½®å°±æœ‰æç¤ºäº† 123456&lt;!â€â€å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œé…ç½®æ–‡ä»¶è¿›è¡Œç»‘å®šå°±ä¼šæœ‰æç¤ºâ€â€&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;springâ€bootâ€configurationâ€processor&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt; Value12345678910111213141516171819//ä»Žé…ç½®æ–‡ä»¶èŽ·å–å€¼ /** *ç›¸å½“äºŽspringçš„beané…ç½® *&lt;bean class="Person"&gt; * &lt;property name="lastName" value="å­—é¢é‡/$&#123;key&#125;ä»ŽçŽ¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ä¸­èŽ·å–å€¼/# &#123;SpEL&#125;"&gt;&lt;/property&gt; * &lt;bean/&gt; * */ @Value("$&#123;person.name&#125;") private String name; //å­—é¢å€¼å¸¸é‡ @Value("2017/10/10") private Date birth; //æ”¯æŒSPELè¡¨è¾¾å¼ @Value("#&#123;2+5&#125;") private int age; @ValueèŽ·å–å€¼å’Œ@Conï¬gurationPropertiesèŽ·å–å€¼æ¯”è¾ƒ Value Conï¬gurationProperties åŠŸèƒ½ ä¸€ä¸ªä¸ªæŒ‡å®š æ‰¹é‡æ³¨å…¥é…ç½®æ–‡ä»¶ä¸­çš„å±žæ€§ æ¾æ•£ç»‘å®šï¼ˆæ¾æ•£è¯­æ³•ï¼‰ ä¸æ”¯æŒ æ”¯æŒ SpEL æ”¯æŒ ä¸æ”¯æŒ JSR303 ä¸æ”¯æŒ æ”¯æŒ å¤æ‚ç±»åž‹å°è£… ä¸æ”¯æŒ æ”¯æŒ @PropertySource&amp;@ImportResource&amp;@Beanæˆ‘ä»¬æŠŠæ‰€æœ‰çš„é…ç½®éƒ½å†™åœ¨é»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸­æœªå…è¿‡äºŽæ²‰é‡,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@PropertySource åŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶ æˆ‘ä»¬å¯ä»¥æŠŠæˆ‘ä»¬personçš„é…ç½®å†™åœ¨person.propertiesæ–‡ä»¶ä¸­ 1234@PropertySource(value = &#123;"classpath:person.properties"&#125;)@Component@ConfigurationProperties(prefix = "person")public class Person &#123; @ImportResourceï¼šå¯¼å…¥Springçš„é…ç½®æ–‡ä»¶ï¼Œè®©é…ç½®æ–‡ä»¶é‡Œé¢çš„å†…å®¹ç”Ÿæ•ˆ Spring Booté‡Œé¢æ²¡æœ‰Springçš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½è‡ªåŠ¨è¯†åˆ«ï¼› æƒ³è®©Spring çš„é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼ŒåŠ è½½è¿›æ¥ï¼›éœ€è¦å°†@ImportResourceæ ‡æ³¨åœ¨ä¸€ä¸ªé…ç½®ç±»ä¸Š æˆ‘ä»¬å†™ä¸€ä¸ªbeans.xml å¹¶åœ¨é‡Œé¢é…ç½®bean 123456&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"&gt; &lt;bean id="helloService" class="com.example.demo.serivce.HelloService"&gt;&lt;/bean&gt;&lt;/beans&gt; æŽ¥ä¸‹æ¥æˆ‘ä»¬å†™æµ‹è¯•ç±»,çœ‹HelloServiceæ˜¯å¦æ³¨å†Œåˆ°springå®¹å™¨ä¸­ 123456789101112@RunWith(SpringRunner.class)@SpringBootTestpublic class DemoApplicationTests &#123; @Autowired ApplicationContext app; @Test public void testHelloService()&#123; System.out.println(app.containsBean("helloService")); &#125;&#125; å¯ä»¥çœ‹åˆ°è¾“å‡ºfalse,æ‰€ä»¥æ­£å¦‚ä¸Šé¢æ‰€è¯´Spring Booté‡Œé¢æ²¡æœ‰Springçš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½è‡ªåŠ¨è¯†åˆ«æ‰€ä»¥æˆ‘ä»¬å†æˆ‘ä»¬çš„ä¸»é…ç½®ç±»ä¸Šå¢žåŠ @ImportResource æ³¨è§£å³å¯, 12345678@ImportResource(locations = "classpath:beans.xml")@SpringBootApplicationpublic class DemoApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(DemoApplication.class, args); &#125;&#125; SpringBootä¸æ”¯æŒä¸Šé¢çš„åšæ³•ï¼Œä½¿ç”¨@Beanæ³¨è§£è¿›è¡Œæ³¨å†Œ 12345678@Configurationpublic class AppConfig &#123; //æ–¹æ³•åå³ä¸ºæ³¨å†Œbean id,è¿”å›žå€¼ä¸ºå®žä¾‹ @Bean public HelloService helloService()&#123; return new HelloService(); &#125;&#125; è¿è¡Œæµ‹è¯•ç±»,å¯ä»¥çœ‹åˆ°HelloService å·²ç»æ³¨å†Œåˆ°æˆ‘ä»¬çš„IOCå®¹å™¨ä¸­äº†]]></content>
      <categories>
        <category>Spring Boot</category>
      </categories>
      <tags>
        <tag>Spring Boot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring Bootå…¥é—¨]]></title>
    <url>%2F2019%2F09%2F24%2FSpring%20Boot%E5%85%A5%E9%97%A8%2F</url>
    <content type="text"><![CDATA[ä¸€ã€ä»€ä¹ˆæ˜¯Spring Boot ä½¿ç”¨â€çº¦å®šå¤§äºŽé…ç½®â€çš„ç†å¿µè®©é¡¹ç›®å¿«é€Ÿè¿è¡Œèµ·æ¥ å®ƒå¹¶ä¸æ˜¯ä»€ä¹ˆæ–°çš„æ¡†æž¶ï¼Œè€Œæ˜¯é»˜è®¤é…ç½®äº†å¾ˆå¤šæ¡†æž¶çš„ä½¿ç”¨æ–¹å¼ï¼Œå°±åƒ Maven æ•´åˆäº†æ‰€æœ‰çš„ jar åŒ…ä¸€æ ·ï¼ŒSpring Boot æ•´åˆäº†æ‰€æœ‰æ¡†æž¶ äºŒã€ä½¿ç”¨Spring Bootæœ‰ä»€ä¹ˆå¥½å¤„å›žé¡¾ä¹‹å‰çš„SSMé¡¹ç›®ï¼Œæ­å»ºè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒç¹ççš„ï¼Œéœ€è¦ï¼š é…ç½®web.xml,åŠ è½½è¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒç¹ç é…ç½®æ•°æ®åº“è¿žæŽ¥ã€åŠ è½½springå’Œspring mvc é…ç½®æ–‡ä»¶çš„è¯»å–ã€å¼€å¯æ³¨è§£ é…ç½®mapperæ–‡ä»¶ â€¦â€¦ ä½¿ç”¨Spring Bootå¼€å‘é¡¹ç›®ç®€å•ã€å¿«é€Ÿã€æ–¹ä¾¿åœ°æ­å»ºé¡¹ç›®ï¼Œæžå¤§çš„æäº¤å¼€å‘å’Œéƒ¨ç½²çš„æ•ˆçŽ‡ ä¸‰ã€ä½¿ç”¨IDEA2016å¿«é€Ÿæ­å»ºSpring Booté¡¹ç›®1ã€é…ç½®çŽ¯å¢ƒ IDEA2017 jdk1.8 maven 3 SpringBoot 2.1.8 2ã€file-&gt;new projectåœ¨å¼¹å‡ºçš„çª—å£é€‰æ‹©Spring Initializr 3ã€å¡«å†™é¡¹ç›®ä¿¡æ¯ 4ã€å‹¾ä¸ŠWebæ¨¡æ¿ï¼Œmysqlè¿žæŽ¥(å¦‚æžœéœ€è¦è¿žæŽ¥æ•°æ®åº“) 5ã€HelloWorldæŽ¥å£ç®€å•ç¼–å†™1234567891011121314package com.example.demo;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;@RestControllerpublic class HelloController &#123; @RequestMapping("/hello") public String Hello()&#123; return "hello Spring boot"; &#125;&#125; å»ºç«‹çš„Controllerå¿…é¡»å’Œå¯åŠ¨ç±»å†åŒä¸€ä¸ªåŒ…ä¸‹ 6ã€å¯åŠ¨ç±»ä»‹ç»123456789101112package com.example.demo;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;@SpringBootApplicationpublic class DemoApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(DemoApplication.class, args); &#125;&#125; 7ã€pomä»‹ç»123456789101112131415161718192021222324252627282930313233343536373839404142434445464748&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.1.8.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.example&lt;/groupId&gt; &lt;artifactId&gt;demo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;demo&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; @SpringBootApplicationæ˜¯springBootçš„æ ¸å¿ƒæ³¨è§£æ³¨è§£,è¯¥æ³¨è§£æ˜¯@Configurationã€@EnableAutoConfigurationã€@ComponentScan æ³¨è§£çš„åˆä½“ç‰ˆ 8ã€å¯åŠ¨é¡¹ç›® 9ã€æµè§ˆå™¨è®¿é—®è¯·æ±‚ å››ã€ SpringBootç›®å½•ä»‹ç» resourcesä¸­çš„staticä¸­åªæ”¾ç½®é™æ€é¡µé¢ï¼Œå¦‚cssã€jsã€imagesç­‰(ä¹Ÿå¯åœ¨resourcesä¸­å»ºç«‹publicç›®å½•æ”¾ç½®é™æ€æ–‡ä»¶ï¼ŒåŠŸèƒ½è·Ÿstaticä¸€æ ·) resourcesä¸­templatesä¸­åªæ”¾ç½®åŠ¨æ€é¡µé¢ï¼ŒåŠ¨æ€é¡µé¢éœ€è¦å…ˆè¯·æ±‚æœåŠ¡å™¨ï¼Œè®¿é—®åŽå°åº”ç”¨ç¨‹åºï¼Œç„¶åŽå†è½¬å‘é¡µé¢ï¼Œæ¯”å¦‚JSPã€‚Spring Bootå»ºè®®ä¸è¦ä½¿ç”¨JSPï¼Œé»˜è®¤ä½¿ç”¨Thymeleafæ¥åšåŠ¨æ€é¡µé¢ï¼Œä½†æ˜¯å¦‚æžœè¦ä½¿ç”¨Thymeleafï¼Œå¿…é¡»æ·»åŠ ä¾èµ–ï¼Œå¦‚ä¸‹å›¾ã€‚Thymeleafé»˜è®¤çš„é¡µé¢æ–‡ä»¶åŽç¼€æ˜¯.htmlã€‚Thymeleafçš„è¯­æ³•è§„èŒƒå¯æŸ¥çœ‹ä¸€ä¸‹é“¾æŽ¥https://www.e-learn.cn/thymeleaf 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;&lt;/dependency&gt; resourcesä¸­çš„application.propertiesä¸»è¦é…ç½®æ–‡ä»¶ï¼ŒSpring Bootå¸®æˆ‘ä»¬å…é™¤äº†å¤§éƒ¨åˆ†çš„æ‰‹åŠ¨é…ç½®ï¼Œä½†æ˜¯ä¸€äº›ç‰¹å®šçš„æƒ…å†µï¼Œè¿˜æ˜¯éœ€è¦æˆ‘ä»¬åœ¨applicationä¸­é…ç½®ï¼Œä½†æ˜¯åªèƒ½æ˜¯è¢«ä¸¤ç§æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ymlæ–‡ä»¶å’Œpropertiesæ–‡ä»¶]]></content>
      <categories>
        <category>Spring Boot</category>
      </categories>
      <tags>
        <tag>Spring Boot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring Bootæ³¨è§£å¤§å…¨]]></title>
    <url>%2F2019%2F09%2F19%2FSpring%20Boot%E6%B3%A8%E8%A7%A3%E5%A4%A7%E5%85%A8%2F</url>
    <content type="text"><![CDATA[Spring Bootæ³¨è§£å¤§å…¨ä¸€ã€æ³¨è§£åˆ—è¡¨@SpringBootApplicationåŒ…å«äº†@ComponentScanã€@Configurationå’Œ@EnableAutoConfigurationæ³¨è§£ã€‚å…¶ä¸­@ComponentScanè®©spring Bootæ‰«æåˆ°Configurationç±»å¹¶æŠŠå®ƒåŠ å…¥åˆ°ç¨‹åºä¸Šä¸‹æ–‡ã€‚ @ComponentScan ç»„ä»¶æ‰«æï¼Œå¯è‡ªåŠ¨å‘çŽ°å’Œè£…é…ä¸€äº›Beanã€‚ @Configuration ç­‰åŒäºŽspringçš„XMLé…ç½®æ–‡ä»¶ï¼›ä½¿ç”¨Javaä»£ç å¯ä»¥æ£€æŸ¥ç±»åž‹å®‰å…¨ã€‚ @EnableAutoConfiguration è‡ªåŠ¨é…ç½®ã€‚ @Componentå¯é…åˆCommandLineRunnerä½¿ç”¨ï¼Œåœ¨ç¨‹åºå¯åŠ¨åŽæ‰§è¡Œä¸€äº›åŸºç¡€ä»»åŠ¡ã€‚ @RestControlleræ³¨è§£æ˜¯@Controllerå’Œ@ResponseBodyçš„åˆé›†,è¡¨ç¤ºè¿™æ˜¯ä¸ªæŽ§åˆ¶å™¨bean,å¹¶ä¸”æ˜¯å°†å‡½æ•°çš„è¿”å›žå€¼ç›´ æŽ¥å¡«å…¥HTTPå“åº”ä½“ä¸­,æ˜¯RESTé£Žæ ¼çš„æŽ§åˆ¶å™¨ã€‚ @Autowiredè‡ªåŠ¨å¯¼å…¥ã€‚ @PathVariableèŽ·å–å‚æ•°ã€‚ 123456@RequestMapping(â€/testPathVariable/&#123;id&#125;") public String testPathVariable(@PathVariable(â€œidâ€) Integer id) &#123; System.out.println(â€œtestPathVariable:â€+id); return SUCCESS; &#125; äºŒã€å¸¸ç”¨æ³¨è§£è¯¦æƒ…@ResponseBodyï¼šè¡¨ç¤ºè¯¥æ–¹æ³•çš„è¿”å›žç»“æžœç›´æŽ¥å†™å…¥HTTP response bodyä¸­ï¼Œä¸€èˆ¬åœ¨å¼‚æ­¥èŽ·å–æ•°æ®æ—¶ä½¿ç”¨ï¼Œç”¨äºŽæž„å»ºRESTfulçš„apiã€‚åœ¨ä½¿ç”¨@RequestMappingåŽï¼Œè¿”å›žå€¼é€šå¸¸è§£æžä¸ºè·³è½¬è·¯å¾„ï¼ŒåŠ ä¸Š@ResponsebodyåŽè¿”å›žç»“æžœä¸ä¼šè¢«è§£æžä¸ºè·³è½¬è·¯å¾„ï¼Œè€Œæ˜¯ç›´æŽ¥å†™å…¥HTTP response bodyä¸­ã€‚æ¯”å¦‚å¼‚æ­¥èŽ·å–jsonæ•°æ®ï¼ŒåŠ ä¸Š@ResponsebodyåŽï¼Œä¼šç›´æŽ¥è¿”å›žjsonæ•°æ®ã€‚è¯¥æ³¨è§£ä¸€èˆ¬ä¼šé…åˆ@RequestMappingä¸€èµ·ä½¿ç”¨ 123451 @RequestMapping("/testâ€)2 @ResponseBody3 public String test()&#123;4 returnâ€okâ€;5 &#125; @Controllerï¼šç”¨äºŽå®šä¹‰æŽ§åˆ¶å™¨ç±»ï¼Œåœ¨springé¡¹ç›®ä¸­ç”±æŽ§åˆ¶å™¨è´Ÿè´£å°†ç”¨æˆ·å‘æ¥çš„URLè¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„æœåŠ¡æŽ¥å£ï¼ˆserviceå±‚ï¼‰ï¼Œä¸€èˆ¬è¿™ä¸ªæ³¨è§£åœ¨ç±»ä¸­ï¼Œé€šå¸¸æ–¹æ³•éœ€è¦é…åˆæ³¨è§£@RequestMappingã€‚ 1234567891011121314 1 @Controller 2 @RequestMapping(â€œ/demoInfoâ€) 3 public class DemoController &#123; 4 @Autowired 5 private DemoInfoService demoInfoService; 6 7 @RequestMapping(â€/helloâ€œ) 8 public String hello(Map&lt;String,Object&gt; map)&#123; 9 System.out.println(â€œDemoController.hello()â€);10 map.put(â€helloâ€œ,â€from TemplateController.helloHtmlâ€œ);11 //ä¼šä½¿ç”¨hello.htmlæˆ–è€…hello.ftlæ¨¡æ¿è¿›è¡Œæ¸²æŸ“æ˜¾ç¤º.12 return "/helloâ€œ;13 &#125;14 &#125; @RestControllerï¼šç”¨äºŽæ ‡æ³¨æŽ§åˆ¶å±‚ç»„ä»¶(å¦‚strutsä¸­çš„action)ï¼Œ@ResponseBodyå’Œ@Controllerçš„åˆé›†ã€‚ 123456789101112131415 1 package com.kfit.demo.web; 2 3 import org.springframework.web.bind.annotation.RequestMapping; 4 import org.springframework.web.bind.annotation.RestController; 5 6 7 @RestController 8 @RequestMapping(â€œ/demoInfo2â€) 9 publicclass DemoController2 &#123;10 11 @RequestMapping("/test")12 public String test()&#123;13 return "ok";14 &#125;15 &#125; @Importï¼šç”¨æ¥å¯¼å…¥å…¶ä»–é…ç½®ç±»ã€‚ @ImportResourceï¼šç”¨æ¥åŠ è½½xmlé…ç½®æ–‡ä»¶ã€‚ @Autowiredï¼šè‡ªåŠ¨å¯¼å…¥ä¾èµ–çš„bean @Serviceï¼šä¸€èˆ¬ç”¨äºŽä¿®é¥°serviceå±‚çš„ç»„ä»¶ @Repositoryï¼šä½¿ç”¨@Repositoryæ³¨è§£å¯ä»¥ç¡®ä¿DAOæˆ–è€…repositoriesæä¾›å¼‚å¸¸è½¬è¯‘ï¼Œè¿™ä¸ªæ³¨è§£ä¿®é¥°çš„DAOæˆ–è€…repositoriesç±»ä¼šè¢«ComponetScanå‘çŽ°å¹¶é…ç½®ï¼ŒåŒæ—¶ä¹Ÿä¸éœ€è¦ä¸ºå®ƒä»¬æä¾›XMLé…ç½®é¡¹ã€‚ @Beanï¼šç”¨@Beanæ ‡æ³¨æ–¹æ³•ç­‰ä»·äºŽXMLä¸­é…ç½®çš„beanã€‚ @Valueï¼šæ³¨å…¥Spring boot application.propertiesé…ç½®çš„å±žæ€§çš„å€¼ã€‚ 121 @Value(value = â€œ#&#123;message&#125;â€) 2 private String message; @Componentï¼šæ³›æŒ‡ç»„ä»¶ï¼Œå½“ç»„ä»¶ä¸å¥½å½’ç±»çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ³¨è§£è¿›è¡Œæ ‡æ³¨ã€‚ @Bean:ç›¸å½“äºŽXMLä¸­çš„,æ”¾åœ¨æ–¹æ³•çš„ä¸Šé¢ï¼Œè€Œä¸æ˜¯ç±»ï¼Œæ„æ€æ˜¯äº§ç”Ÿä¸€ä¸ªbean,å¹¶äº¤ç»™springç®¡ç†ã€‚ @Qualifierï¼šå½“æœ‰å¤šä¸ªåŒä¸€ç±»åž‹çš„Beanæ—¶ï¼Œå¯ä»¥ç”¨@Qualifier(â€œnameâ€)æ¥æŒ‡å®šã€‚ä¸Ž@Autowiredé…åˆä½¿ç”¨ã€‚@Qualifieré™å®šæè¿°ç¬¦é™¤äº†èƒ½æ ¹æ®åå­—è¿›è¡Œæ³¨å…¥ï¼Œä½†èƒ½è¿›è¡Œæ›´ç»†ç²’åº¦çš„æŽ§åˆ¶å¦‚ä½•é€‰æ‹©å€™é€‰è€… 1231 @Autowired2 @Qualifier(value = â€œdemoInfoServiceâ€)3 private DemoInfoService demoInfoService;]]></content>
      <categories>
        <category>Spring Boot</category>
      </categories>
      <tags>
        <tag>Spring Boot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Typoraç¼–è¾‘å™¨ä»‹ç»]]></title>
    <url>%2F2019%2F09%2F16%2FTypora%E7%BC%96%E8%BE%91%E5%99%A8%E4%BB%8B%E7%BB%8D%2F</url>
    <content type="text"><![CDATA[Typoraç¼–è¾‘å™¨ä»‹ç»Typora æ˜¯ä»€ä¹ˆï¼ŸTypora æ˜¯ä¸€æ¬¾æ”¯æŒå®žæ—¶é¢„è§ˆçš„ Markdown æ–‡æœ¬ç¼–è¾‘å™¨ã€‚å®ƒæœ‰ OS Xã€Windowsã€Linux ä¸‰ä¸ªå¹³å°çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”ç”±äºŽä»åœ¨æµ‹è¯•ä¸­ï¼Œæ˜¯å®Œå…¨å…è´¹çš„ï¼Œæœ¬ç½‘ç«™ä½¿ç”¨çš„ç¼–è¾‘å™¨å°±æ˜¯è¿™æ¬¾ï¼Œä½¿ç”¨ç®€ä¾¿ï¼Œç”¨èµ·æ¥å¾ˆèˆ’æœã€‚ä¸‹è½½åœ°å€https://www.typora.io/ å…³äºŽ MarkdownMarkdown æ˜¯ç”¨æ¥ç¼–å†™ç»“æž„åŒ–æ–‡æ¡£çš„ä¸€ç§çº¯æ–‡æœ¬æ ¼å¼ï¼Œå®ƒä½¿æˆ‘ä»¬åœ¨åŒæ‰‹ä¸ç¦»å¼€é”®ç›˜çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¯¹æ–‡æœ¬è¿›è¡Œä¸€å®šç¨‹åº¦çš„æ ¼å¼æŽ’ç‰ˆã€‚ Typoraå¿«æ·é”®windowså¿«æ·é”®ï¼š æ— åºåˆ—è¡¨ï¼šè¾“å…¥-ä¹‹åŽè¾“å…¥ç©ºæ ¼ æœ‰åºåˆ—è¡¨ï¼šè¾“å…¥æ•°å­—+â€œ.â€ä¹‹åŽè¾“å…¥ç©ºæ ¼ ä»»åŠ¡åˆ—è¡¨ï¼š-[ç©ºæ ¼]ç©ºæ ¼ æ–‡å­— æ ‡é¢˜ï¼šctrl+æ•°å­— è¡¨æ ¼ï¼šctrl+t ç”Ÿæˆç›®å½•ï¼š[TOC]æŒ‰å›žè½¦ é€‰ä¸­ä¸€æ•´è¡Œï¼šctrl+l é€‰ä¸­å•è¯ï¼šctrl+d é€‰ä¸­ç›¸åŒæ ¼å¼çš„æ–‡å­—ï¼šctrl+e è·³è½¬åˆ°æ–‡ç« å¼€å¤´ï¼šctrl+home è·³è½¬åˆ°æ–‡ç« ç»“å°¾ï¼šctrl+end æœç´¢ï¼šctrl+f æ›¿æ¢ï¼šctrl+h å¼•ç”¨ï¼šè¾“å…¥&gt;ä¹‹åŽè¾“å…¥ç©ºæ ¼ ä»£ç å—ï¼šctrl+alt+f åŠ ç²—ï¼šctrl+b å€¾æ–œï¼šctrl+i ä¸‹åˆ’çº¿ï¼šctrl+u åˆ é™¤çº¿ï¼šalt+shift+5 æ’å…¥å›¾ç‰‡ï¼šç›´æŽ¥æ‹–åŠ¨åˆ°æŒ‡å®šä½ç½®å³å¯æˆ–è€…ctrl+shift+i æ’å…¥é“¾æŽ¥ï¼šctrl + k Macä¸­çš„å¿«æ·é”®ï¼š æœ€å¤§æ ‡é¢˜ï¼šcommand + 1 æˆ–è€…ï¼š# å¤§æ ‡é¢˜ï¼šcommand + 2 æˆ–è€…ï¼š## æ ‡å‡†æ ‡é¢˜ï¼šcommand + 3 æˆ–è€…ï¼š### ä¸­æ ‡é¢˜ï¼šcommand + 4 æˆ–è€…ï¼š#### å°æ ‡é¢˜ï¼šcommand + 5 æˆ–è€…ï¼š##### æ’å…¥è¡¨æ ¼ï¼šcommand + T æ’å…¥ä»£ç ï¼šcommand + alt +c è¡Œé—´å…¬å¼ command + Alt + b æ®µè½ï¼šcommand + 0 ç«–çº¿ ï¼š command + Alt +q æœ‰åºåˆ—è¡¨ï¼ˆ1. 2.ï¼‰ ï¼šè¾“å…¥æ•°å­—+â€œ.â€ä¹‹åŽè¾“å…¥ç©ºæ ¼ æˆ–è€…ï¼šcommand + Alt + o é»‘ç‚¹æ ‡è®°ï¼šcommand + Alt + u éš”ç¦»çº¿shift + command + - è¶…é“¾æŽ¥ï¼šcommand + Alt + l æ’å…¥é“¾æŽ¥ï¼šcommand +k ä¸‹åˆ’çº¿ï¼šcommand +u åŠ ç²—ï¼šcommand +b æœç´¢ï¼šcommand +f è¡¨æƒ…è¾“å‡ºè¡¨æƒ…éœ€è¦å€ŸåŠ© ï¼šç¬¦å·ã€‚ æ —å­ï¼š:smile æ˜¾ç¤ºä¸º ðŸ˜„,è®°ä½æ˜¯å·¦å³ä¸¤è¾¹éƒ½è¦å†’å·ã€‚ ä½¿ç”¨è€…å¯ä»¥é€šè¿‡ä½¿ç”¨ESCé”®è§¦å‘è¡¨æƒ…å»ºè®®è¡¥å…¨åŠŸèƒ½ï¼Œä¹Ÿå¯åœ¨åŠŸèƒ½é¢æ¿å¯ç”¨åŽè‡ªåŠ¨è§¦å‘æ­¤åŠŸèƒ½ã€‚åŒæ—¶ï¼Œç›´æŽ¥ä»Žèœå•æ Edit -&gt; Emoji &amp; Symbolsæ’å…¥UTF8è¡¨æƒ…ç¬¦å·ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ æˆ–è€…ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³• è®¿é—®ç½‘ç«™ https://emojikeyboard.org/,æ‰¾åˆ°éœ€è¦çš„ç¬¦å·ï¼Œé¼ æ ‡å·¦é”®å•å‡»ï¼Œç„¶åŽç²˜è´´åˆ°éœ€è¦çš„åœ°æ–¹å°±è¡Œäº†ï¼ðŸ†—]]></content>
      <categories>
        <category>Typora</category>
      </categories>
      <tags>
        <tag>Typora</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[IntelliJIDEAå¸¸ç”¨å¿«æ·é”®æ€»ç»“]]></title>
    <url>%2F2019%2F06%2F14%2FIntelliJ%20IDEA%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[IntelliJIDEAå¸¸ç”¨å¿«æ·é”®æ€»ç»“ä¹‹å‰å¼€å‘é¡¹ç›®ä¸€ç›´ç”¨çš„æ˜¯eclipseè¿›è¡Œå¼€å‘ï¼Œè¿‘æœŸåœ¨ä½¿ç”¨IDEAè¿™ä¸ªå·¥å…·è¿›è¡Œé¡¹ç›®å¼€å‘ï¼Œä¹‹å‰åœ¨eclipseä¸Šèƒ½ä½¿ç”¨çš„å¿«æ·é”®æ–¹æ³•æ”¾åœ¨IDEAä¸Šå¾ˆå¤šéƒ½ä¸é€‚ç”¨äº†ï¼Œå› æ­¤åœ¨æ­¤æ€»ç»“ä¸€ä¸‹å…³äºŽIDEAå¿«æ·é”®çš„ä½¿ç”¨æ–¹æ³•ï¼š å¿«é€ŸæŸ¥æ‰¾åœ¨æ–‡ä»¶ä¸­çš„å†…å®¹å¹¶æ˜¾ç¤ºï¼šCtrl+Shift+F å¿«é€Ÿè·³è½¬åˆ°å…·ä½“æ–‡ä»¶å¤¹ä¸­ï¼šæŒ‰ä¸¤ä¸‹Shift é‡å‘½åï¼šShift+F6 åˆ‡æ¢å¤§å°å†™ï¼šCtrl+Shift+U äº§ç”Ÿæž„é€ æ–¹æ³•ï¼Œget/setæ–¹æ³•ç­‰ï¼šAlt+Insert è‡ªåŠ¨æç¤ºå®Œæˆï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼šAlt+Enter æ˜¾ç¤ºæ‰€æœ‰ç±»æˆ–è€…æ–¹æ³•çš„åŒåçš„ç±»åž‹:Ctrl+P å¿«é€Ÿæ‰“å°è¾“å‡º:é™¤äº†ç”¨soutå¼€å¤´å¿«é€Ÿç”Ÿæˆï¼Œè¿˜å¯ä»¥ä½¿ç”¨å˜é‡å.sout å¿«é€Ÿå®šä¹‰å±€éƒ¨å˜é‡:åœ¨å­—ç¬¦ä¸²æˆ–è€…æ•°å­—åŽé¢è¾“å…¥.var,å›žè½¦ å¿«é€Ÿåˆ¤æ–­ï¼ˆéžï¼‰ç©ºï¼šéžç©ºï¼š.notnullæˆ–è€….nu ç©ºï¼š.null å¿«é€ŸéåŽ†é›†åˆï¼š.for, .fori, .forr éƒ½å¯ä»¥æ»¡è¶³ä½ çš„è¦æ±‚ã€‚]]></content>
      <categories>
        <category>IDEA</category>
      </categories>
      <tags>
        <tag>IDEA</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashMapçš„åº•å±‚å®žçŽ°å’Œé¢è¯•é—®é¢˜]]></title>
    <url>%2F2019%2F06%2F01%2FHashMap%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E5%92%8C%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[HashMapçš„åº•å±‚å®žçŽ°å’Œé¢è¯•é—®é¢˜HashMapç®€ä»‹HashMapæ•°æ®ç»“æž„æ˜¯å“ˆå¸Œè¡¨ç»“æž„ï¼ˆæ•°ç»„+é“¾è¡¨ï¼‰ HashMapæ˜¯ä¸€ä¸ªæ•£åˆ—è¡¨ï¼Œå®ƒå­˜å‚¨çš„å†…å®¹æ˜¯é”®å€¼å¯¹ï¼ˆkey-valueï¼‰æ˜ å°„ HashMapç»§æ‰¿äºŽAbstractMapï¼Œå®žçŽ°äº†Mapã€Cloneableã€java.io.SerializableæŽ¥å£ã€‚ HashMap çš„å®žçŽ°ä¸æ˜¯åŒæ­¥çš„ï¼Œè¿™æ„å‘³ç€å®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å®ƒçš„keyã€valueéƒ½å¯ä»¥ä¸ºnullã€‚æ­¤å¤–ï¼ŒHashMapä¸­çš„æ˜ å°„ä¸æ˜¯æœ‰åºçš„ é¢è¯•é¢˜ LinkedHashMapå’ŒhashMapå’ŒTreeMapçš„åŒºåˆ«ä»¥åŠåº”ç”¨åœºæ™¯ï¼Ÿ åŒºåˆ« LinkedHashMapæ˜¯ç»§æ‰¿äºŽHashMapï¼Œæ˜¯åŸºäºŽHashMapå’ŒåŒå‘é“¾è¡¨æ¥å®žçŽ°çš„ã€‚ HashMapæ— åºï¼›LinkedHashMapæœ‰åºï¼Œå¯åˆ†ä¸ºæ’å…¥é¡ºåºå’Œè®¿é—®é¡ºåºä¸¤ç§ã€‚å¦‚æžœæ˜¯è®¿é—®é¡ºåºï¼Œé‚£putå’Œgetæ“ä½œå·²å­˜åœ¨çš„Entryæ—¶ï¼Œéƒ½ä¼šæŠŠEntryç§»åŠ¨åˆ°åŒå‘é“¾è¡¨çš„è¡¨å°¾(å…¶å®žæ˜¯å…ˆåˆ é™¤å†æ’å…¥)ã€‚ LinkedHashMapå­˜å–æ•°æ®ï¼Œè¿˜æ˜¯è·ŸHashMapä¸€æ ·ä½¿ç”¨çš„Entry[]çš„æ–¹å¼ï¼ŒåŒå‘é“¾è¡¨åªæ˜¯ä¸ºäº†ä¿è¯é¡ºåºã€‚ LinkedHashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚ TreeMapåŸºäºŽçº¢é»‘æ ‘çš„å®žçŽ°ï¼ˆä¸»è¦æ˜¯æŽ’åºï¼‰ï¼Œé»˜è®¤çš„æŽ’åºä¸ºå‡åºï¼Œå¦‚æžœè¦æ”¹å˜å…¶æŽ’åºå¯ä»¥è‡ªå·±å†™ä¸€ä¸ªComparator ConcurrentHashMap çº¿ç¨‹å®‰å…¨çš„Map åº”ç”¨åœºæ™¯ HashMapï¼šåœ¨ Map ä¸­æ’å…¥ã€åˆ é™¤å’Œå®šä½å…ƒç´ æ—¶ï¼› TreeMapï¼šåœ¨éœ€è¦æŒ‰è‡ªç„¶é¡ºåºæˆ–è‡ªå®šä¹‰é¡ºåºéåŽ†é”®çš„æƒ…å†µä¸‹ LinkedHashMapï¼šåœ¨éœ€è¦è¾“å‡ºçš„é¡ºåºå’Œè¾“å…¥çš„é¡ºåºç›¸åŒçš„æƒ…å†µä¸‹ã€‚ Mapç®€ä»‹ Mapä¸­é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå€¼å¯ä»¥é‡å¤ é¢è¯•é¢˜ å¦‚ä½•éåŽ†map 12345Map&lt;String, String&gt;map = new HashMap&lt;String,String&gt;(); map.put("student1", "é˜¿ä¼Ÿ"); map.put("student2", "å°æŽ"); map.put("student3", "å°å¼ "); map.put("student4", "å°çŽ‹"); ä½¿ç”¨entrySet()éåŽ† 1234567Iterator it = map.entrySet().iterator();while (it.hasNext()) &#123; Map.Entry entry =(Map.Entry) it.next(); Object key = entry.getKey(); Object value = entry.getValue(); System.out.println("key="+key+" value"+value); &#125; é€šè¿‡Map.KeysetéåŽ†keyå’Œvalue,æ™®éä½¿ç”¨ï¼ŒäºŒæ¬¡å–å€¼ 12for(String key:map.keySet())&#123; System.out.println("Key="+key+"\tvalue="+map.get(key));&#125; é€šè¿‡map.values()éåŽ†æ‰€æœ‰çš„valueï¼Œä½†ä¸èƒ½éåŽ†key 123for(String v:map.values())&#123; System.out.println("value="+v);&#125; map.entrySetéåŽ†keyå’Œvalue(æŽ¨èä½¿ç”¨ï¼Œç‰¹åˆ«æ˜¯å®¹é‡å¤§æ—¶) 123for(Map.Entry&lt;String, String&gt; entry:map.entrySet())&#123; System.out.println("key="+entry.getKey()+"\tvalue="+entry.getValue());&#125; HashMapåº•å±‚ä»£ç å®žçŽ°HashMapçš„ä¸»è¦å‚æ•°æœ‰å“ªäº›ï¼Ÿ æ¡¶ï¼ˆcapacityï¼‰å®¹é‡ï¼Œå³æ•°ç»„é•¿åº¦ï¼šDEFAULT_INITIAL_CAPACITY=1&lt;&lt;4ï¼›é»˜è®¤å€¼ä¸º16ï¼Œå³åœ¨ä¸æä¾›æœ‰å‚æž„é€ çš„æ—¶å€™ï¼Œå£°æ˜Žçš„hashmapçš„æ¡¶å®¹é‡ï¼› MAXIMUM_CAPACITY = 1 &lt;&lt; 30;æžé™å®¹é‡ï¼Œè¡¨ç¤ºhashmapèƒ½æ‰¿å—çš„æœ€å¤§æ¡¶å®¹é‡ä¸º2çš„30æ¬¡æ–¹ï¼Œè¶…è¿‡è¿™ä¸ªå®¹é‡å°†ä¸å†æ‰©å®¹ï¼Œè®©hashç¢°æ’žèµ·æ¥å§ï¼ static final float DEFAULT_LOAD_FACTOR = 0.75f;è´Ÿè½½å› å­ï¼ˆloadfactorï¼Œé»˜è®¤0.75ï¼‰ï¼Œè´Ÿè½½å› å­æœ‰ä¸ªå¥‡ç‰¹çš„æ•ˆæžœï¼Œè¡¨ç¤ºå½“å½“å‰å®¹é‡å¤§äºŽï¼ˆsize/ï¼‰æ—¶ï¼Œå°†è¿›è¡Œhashmapçš„æ‰©å®¹ï¼Œæ‰©å®¹ä¸€èˆ¬ä¸ºæ‰©å®¹ä¸ºåŽŸæ¥çš„ä¸¤å€ã€‚ int threshold;é˜ˆå€¼ é˜ˆå€¼ç®—æ³•ä¸ºcapacity*loadfactoryï¼Œå¤§è‡´å½“mapä¸­entryæ•°é‡å¤§äºŽæ­¤é˜ˆå€¼æ—¶è¿›è¡Œæ‰©å®¹ï¼ˆ1.8ï¼‰ transient Entry&lt;K,V&gt;[] table = (Entry&lt;K,V&gt;[]) EMPTY_TABLE;ï¼ˆé»˜è®¤ä¸ºç©º{}ï¼‰ æ ¸å¿ƒçš„æ•°æ®ç»“æž„ï¼Œå³æ‰€è°“çš„æ•°ç»„+é“¾è¡¨çš„éƒ¨åˆ†ã€‚ HashMapçš„æ•°æ®ç»“æž„æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ ä¸»è¦æ•°æ®ç»“æž„å³ä¸ºæ•°ç»„+é“¾è¡¨ã€‚ åœ¨hashmapä¸­çš„ä¸»è¦è¡¨çŽ°å½¢å¼ä¸ºä¸€ä¸ªtableï¼Œç±»åž‹ä¸ºEntry&lt;K,V&gt;[] table é¦–å…ˆæ˜¯ä¸€ä¸ªEntryåž‹çš„æ•°ç»„ï¼ŒEntryä¸ºhashmapçš„å†…éƒ¨ç±»ï¼š æºç å¦‚ä¸‹ 1234567 static class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final K key; V value; Entry&lt;K,V&gt; next; int hash;&#125; ç»“æž„å¦‚å›¾æ‰€ç¤º hashç®—æ³•hashç®—æ³•æ˜¯è®¡ç®—keyå€¼å¯¹åº”å“ˆå¸Œæ¡¶çš„ä½ç½®å³ç´¢å¼•å€¼ã€‚æˆ‘ä»¬éƒ½çŸ¥é“æ•°ç»„åœ¨èŽ·å–å…ƒç´ ä¼šæ¯”é“¾è¡¨å¿«ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°½é‡è®©æ¯ä¸ªå“ˆå¸Œæ¡¶åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œè¿™æ ·åœ¨æŸ¥è¯¢æ—¶å°±åªéœ€è¦é€šè¿‡ç´¢å¼•å€¼æ‰¾åˆ°å¯¹åº”çš„å“ˆå¸Œæ¡¶å†…çš„å€¼ï¼Œè€Œä¸éœ€è¦å†é€šè¿‡æ¡¶å†…çš„é“¾è¡¨ä¸€ä¸ªä¸€ä¸ªåŽ»æŸ¥ã€‚æ‰€ä»¥hashç®—æ³•çš„ä½œç”¨æ˜¯ä¸ºäº†è®©å…ƒç´ åˆ†æ•£å‡åŒ€ï¼Œä»Žè€Œæé«˜æŸ¥è¯¢æ•ˆçŽ‡ã€‚æºç å¦‚ä¸‹ 12345678910111213141516171819202122232425//è¿™æ˜¯æ ¹æ®keyå€¼èŽ·å–valueå€¼çš„æ–¹æ³•public V get(Object key) &#123; Node&lt;K,V&gt; e; //å…ˆè°ƒç”¨hash(key) return (e = getNode(hash(key), key)) == null ? null : e.value;&#125;//Hashç®—æ³•å¦‚ä¸‹static final int hash(Object key) &#123; int h; //ç¬¬ä¸€æ­¥ï¼šå…ˆèŽ·å–keyä¸­çš„hashCodeå€¼ return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16); //ç¬¬äºŒæ­¥ å†ä¸Žhashcodeå‘å·¦ç§»16ä½çš„å€¼è¿›è¡ŒæŠ‘æˆ– &#125;final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; //ç¬¬ä¸‰æ­¥ næ˜¯æŒ‡æ•°ç»„é•¿åº¦ï¼Œhashä¸Ž(n-1)è¿›è¡Œ&amp;ä¸Žè¿ç®— (first = tab[(n - 1) &amp; hash]) != null) &#123; //çœç•¥ ... ... &#125; return null;&#125; é¦–å…ˆç¬¬ä¸€æ­¥èŽ·å–hashcodeæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œåˆ°ç¬¬äºŒæ­¥ä¸ºä»€ä¹ˆä¼šè·Ÿhashcodeå·¦ç§»16ä½çš„å€¼è¿›è¡ŒæŠ‘æˆ–å‘¢? å…¶å®žæ˜¯å°†é«˜ä½ä¸Žä½Žä½è¿›è¡Œä¸Žè¿ç®—ï¼Œå‡å°‘ç¢°æ’žæœºçŽ‡ã€‚ç¬¬ä¸‰æ­¥å–ä½™è¿ç®—ï¼Œä½†åœ¨è®¡ç®—æœºè¿ç®—ä¸­&amp;è‚¯å®šæ¯”%å¿«ï¼Œåˆå› ä¸ºh % n = h &amp;ï¼ˆn - 1ï¼‰ï¼Œæ‰€ä»¥æœ€ç»ˆå°†ç¬¬äºŒæ­¥å¾—åˆ°çš„hashè·Ÿn-1è¿›è¡Œä¸Žè¿ç®—ã€‚næ˜¯tableä¸­çš„é•¿åº¦ã€‚ HashMapçš„putå¢žåŠ æ–¹æ³•æµç¨‹putæ–¹æ³•æ˜¯é‡ç‚¹ä¹Ÿæ˜¯æœ€å¤æ‚çš„æ“ä½œã€‚éœ€è¦æŽŒæ¡åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è¦æ‰©å®¹ï¼ˆåŽé¢ä¼šè®²ä¸€ä¸‹æ˜¯å¦‚ä½•æ‰©å®¹çš„ï¼‰ï¼Œæ»¡è¶³ä»€ä¹ˆæ¡ä»¶ä¸‹é“¾è¡¨éœ€è¦è½¬æˆçº¢é»‘æ ‘ã€‚ä¸‹é¢æ˜¯putæ–¹æ³•ä¸­æµç¨‹å›¾ HashMapçš„getæ–¹æ³•ï¼ŒæŸ¥è¯¢å…ƒç´ æŸ¥è¯¢getæ–¹æ³•ç›¸å¯¹ç®€å•ï¼Œåªè¦æ˜Žç™½hashç®—æ³•åŽå¾—åˆ°å“ˆå¸Œæ¡¶çš„ç´¢å¼•å€¼ï¼Œå†å¯¹æ¡¶å†…çš„é“¾è¡¨è¿›è¡Œæ¯”è¾ƒhashï¼Œkeyæ˜¯å¦ç›¸ç­‰ã€‚ æ‰©å®¹æ‰©å®¹æ˜¯Hashmapé‡ç‚¹ä¸­çš„é‡ç‚¹ã€‚ä¹Ÿæ˜¯æœ€è€—æ€§èƒ½çš„æ“ä½œã€‚æ‰©å®¹çš„æ­¥éª¤æ˜¯å…ˆå¯¹sizeæ‰©å¤§ä¸¤å€ï¼Œå†å¯¹åŽŸå…ˆçš„èŠ‚ç‚¹é‡æ–°ç»è¿‡hashç®—æ³•å¾—åˆ°æ–°çš„ç´¢å¼•å€¼å³å¤åˆ¶åˆ°æ–°çš„å“ˆå¸Œæ¡¶é‡Œã€‚æœ€åŽå¾—åˆ°æ–°çš„tableã€‚å…¶ä¸­jdk8å¯¹æ‰©å®¹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæé«˜äº†æ‰©å®¹çš„æ•ˆçŽ‡ã€‚ä½†åœ¨å¹³å¸¸è¿ç”¨ä¸­å°½é‡è¦é¿å…è®©hashmapè¿›è¡Œæ‰©å®¹ï¼Œè‹¥å·²çŸ¥hashmapä¸­çš„å…ƒç´ æ•°é‡ï¼Œåˆ™ä¸€å¼€å§‹åˆå§‹åŒ–hashmapæ—¶æŒ‡å®šå®¹é‡ï¼Œè¿™æ ·å°±å‡å°‘äº†hashmapæ‰©å®¹æ¬¡æ•°ã€‚ é¢è¯•é¢˜ HashMapåº•å±‚æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿé¦–å…ˆåº•å±‚æ•°æ®ç»“æž„æ˜¯ç”±æ•°ç»„+é“¾è¡¨ç»„æˆé“¾è¡¨æ•£åˆ—ã€‚HashMapå…ˆå¾—åˆ°keyçš„æ•£åˆ—å€¼ï¼Œåœ¨é€šè¿‡æ‰°åŠ¨å‡½æ•°ï¼ˆå‡å°‘ç¢°æ’žæ¬¡æ•°ï¼‰å¾—åˆ°Hashå€¼ï¼ŒæŽ¥ç€é€šè¿‡hash &amp; ï¼ˆn -1 ï¼‰ï¼Œnä½tableçš„é•¿åº¦ï¼Œè¿ç®—åŽå¾—åˆ°æ•°ç»„çš„ç´¢å¼•å€¼ã€‚å¦‚æžœå½“å‰èŠ‚ç‚¹å­˜åœ¨å…ƒç´ ï¼Œåˆ™é€šè¿‡æ¯”è¾ƒhashå€¼å’Œkeyå€¼æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™æ›¿æ¢ï¼Œä¸ç›¸ç­‰åˆ™é€šè¿‡æ‹‰é“¾æ³•æŸ¥æ‰¾å…ƒç´ ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸ç­‰æˆ–è€…ä¸‹ä¸ªèŠ‚ç‚¹ä¸ºnullæ—¶ã€‚1.8å¯¹æ‰°åŠ¨å‡½æ•°ï¼Œæ‰©å®¹æ–¹æ³•è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶ä¸”å¢žåŠ äº†çº¢é»‘æ ‘çš„æ•°æ®ç»“æž„ã€‚ HashMap å’Œ Hashtable çš„åŒºåˆ«çº¿ç¨‹å®‰å…¨ HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œè€ŒHashTableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ¯ä¸ªäººæ–¹æ³•é€šè¿‡ä¿®é¥°synchronizedæ¥æŽ§åˆ¶çº¿ç¨‹å®‰å…¨ã€‚æ•ˆçŽ‡ HashMapæ¯”HashTableæ•ˆçŽ‡é«˜ï¼ŒåŽŸå› åœ¨äºŽHashTableçš„æ–¹æ³•é€šè¿‡synchronizedä¿®é¥°åŽï¼Œå¹¶å‘çš„æ•ˆçŽ‡ä¼šé™ä½Žã€‚å…ä¸å…è®¸null HashMapè¿è¡Œåªæœ‰ä¸€ä¸ªkeyä¸ºnullï¼Œå¯ä»¥æœ‰å¤šä¸ªnullçš„valueã€‚è€ŒHashTableä¸å…è®¸keyï¼Œvalueä¸ºnull HashMapçš„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯2çš„å€æ•°åœ¨HashMapçš„æ“ä½œæµç¨‹ä¸­ï¼Œé¦–å…ˆä¼šå¯¹keyè¿›è¡Œhashç®—æ³•å¾—åˆ°ä¸€ä¸ªç´¢å¼•å€¼ï¼Œè¿™ä¸ªç´¢å¼•å€¼å°±æ˜¯å¯¹åº”å“ˆå¸Œæ¡¶æ•°ç»„çš„ç´¢å¼•ã€‚ä¸ºäº†å¾—åˆ°è¿™ä¸ªç´¢å¼•å€¼å¿…é¡»å¯¹æ‰°åŠ¨åŽçš„æ•°è·Ÿæ•°ç»„é•¿åº¦è¿›è¡Œå–ä½™è¿ç®—ã€‚å³ hash % n (nä¸ºhashmapçš„é•¿åº¦)ï¼Œåˆå› ä¸º&amp;æ¯”%è¿ç®—å¿«ã€‚nå¦‚æžœä¸º2çš„å€æ•°ï¼Œå°±å¯ä»¥å°†%è½¬æ¢ä¸º&amp;ï¼Œç»“æžœå°±æ˜¯ hash &amp; (n-1)ã€‚æ‰€ä»¥è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆHashMapé•¿åº¦æ˜¯2çš„å€æ•°ã€‚ Jdk1.8ä¸­æ»¡è¶³ä»€ä¹ˆæ¡ä»¶åŽå°†é“¾è¡¨è½¬åŒ–æˆçº¢é»‘æ ‘ï¼Ÿå¾ˆæ˜¾ç„¶åœ¨putValæ–¹æ³•ä¸­æ˜¯åˆ¤æ–­æ¡¶å†…çš„èŠ‚ç‚¹ä¸ªæ•°æ˜¯å¦å¤§äºŽ8ï¼Œä¹‹åŽé€šè¿‡treeifyBinæ–¹æ³•ä¸­åˆ¤æ–­é•¿åº¦æ˜¯å¦å¤§äºŽæœ€å°çº¢é»‘æ ‘å®¹é‡64,å°äºŽåˆ™ç»§ç»­æ‰©å®¹ï¼Œå¤§äºŽåˆ™è½¬ä¸ºçº¢é»‘æ ‘ã€‚]]></content>
      <categories>
        <category>HashMap</category>
      </categories>
      <tags>
        <tag>HashMap</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Elasticsearchä»‹ç»å’Œå®‰è£…]]></title>
    <url>%2F2019%2F06%2F01%2FElasticsearch%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%8F%8A%E5%AE%89%E8%A3%85%2F</url>
    <content type="text"><![CDATA[0.å­¦ä¹ ç›®æ ‡ ç‹¬ç«‹å®‰è£…Elasticsearch ä¼šä½¿ç”¨Restçš„APIæ“ä½œç´¢å¼• ä¼šä½¿ç”¨Restçš„APIæŸ¥è¯¢æ•°æ® ä¼šä½¿ç”¨Restçš„APIèšåˆæ•°æ® æŽŒæ¡Spring Data Elasticsearchä½¿ç”¨ 1.Elasticsearchä»‹ç»å’Œå®‰è£…ç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„é¦–é¡µï¼Œä¸€èˆ¬éƒ½ä¼šç›´æŽ¥æœç´¢æ¥å¯»æ‰¾è‡ªå·±æƒ³è¦è´­ä¹°çš„å•†å“ã€‚ è€Œå•†å“çš„æ•°é‡éžå¸¸å¤šï¼Œè€Œä¸”åˆ†ç±»ç¹æ‚ã€‚å¦‚æžœèƒ½æ­£ç¡®çš„æ˜¾ç¤ºå‡ºç”¨æˆ·æƒ³è¦çš„å•†å“ï¼Œå¹¶è¿›è¡Œåˆç†çš„è¿‡æ»¤ï¼Œå°½å¿«ä¿ƒæˆäº¤æ˜“ï¼Œæ˜¯æœç´¢ç³»ç»Ÿè¦ç ”ç©¶çš„æ ¸å¿ƒã€‚ é¢å¯¹è¿™æ ·å¤æ‚çš„æœç´¢ä¸šåŠ¡å’Œæ•°æ®é‡ï¼Œä½¿ç”¨ä¼ ç»Ÿæ•°æ®åº“æœç´¢å°±æ˜¾å¾—åŠ›ä¸ä»Žå¿ƒï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨å…¨æ–‡æ£€ç´¢æŠ€æœ¯ï¼Œæ¯”å¦‚ä¹‹å‰å¤§å®¶å­¦ä¹ è¿‡çš„Solrã€‚ ä¸è¿‡ä»Šå¤©ï¼Œæˆ‘ä»¬è¦è®²çš„æ˜¯å¦ä¸€ä¸ªå…¨æ–‡æ£€ç´¢æŠ€æœ¯ï¼šElasticsearchã€‚ 1.1.ç®€ä»‹1.1.1.ElasticElasticå®˜ç½‘ï¼šhttps://www.elastic.co/cn/ Elasticæœ‰ä¸€æ¡å®Œæ•´çš„äº§å“çº¿åŠè§£å†³æ–¹æ¡ˆï¼šElasticsearchã€Kibanaã€Logstashç­‰ï¼Œå‰é¢è¯´çš„ä¸‰ä¸ªå°±æ˜¯å¤§å®¶å¸¸è¯´çš„ELKæŠ€æœ¯æ ˆã€‚ 1.1.2.ElasticsearchElasticsearchå®˜ç½‘ï¼šhttps://www.elastic.co/cn/products/elasticsearch å¦‚ä¸Šæ‰€è¿°ï¼ŒElasticsearchå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š åˆ†å¸ƒå¼ï¼Œæ— éœ€äººå·¥æ­å»ºé›†ç¾¤ï¼ˆsolrå°±éœ€è¦äººä¸ºé…ç½®ï¼Œä½¿ç”¨Zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼‰ Restfulé£Žæ ¼ï¼Œä¸€åˆ‡APIéƒ½éµå¾ªReståŽŸåˆ™ï¼Œå®¹æ˜“ä¸Šæ‰‹ è¿‘å®žæ—¶æœç´¢ï¼Œæ•°æ®æ›´æ–°åœ¨Elasticsearchä¸­å‡ ä¹Žæ˜¯å®Œå…¨åŒæ­¥çš„ã€‚ 1.1.3.ç‰ˆæœ¬ç›®å‰Elasticsearchæœ€æ–°çš„ç‰ˆæœ¬æ˜¯6.3.1ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨6.3.0 éœ€è¦è™šæ‹ŸæœºJDK1.8åŠä»¥ä¸Š 1.2.å®‰è£…å’Œé…ç½®ä¸ºäº†æ¨¡æ‹ŸçœŸå®žåœºæ™¯ï¼Œæˆ‘ä»¬å°†åœ¨linuxä¸‹å®‰è£…Elasticsearchã€‚ 1.2.1.æ–°å»ºä¸€ä¸ªç”¨æˆ·leyouå‡ºäºŽå®‰å…¨è€ƒè™‘ï¼Œelasticsearché»˜è®¤ä¸å…è®¸ä»¥rootè´¦å·è¿è¡Œã€‚ åˆ›å»ºç”¨æˆ·ï¼š 1useradd leyou è®¾ç½®å¯†ç ï¼š 1passwd leyou åˆ‡æ¢ç”¨æˆ·ï¼š 1su - leyou 1.2.2.ä¸Šä¼ å®‰è£…åŒ…,å¹¶è§£åŽ‹æˆ‘ä»¬å°†å®‰è£…åŒ…ä¸Šä¼ åˆ°ï¼š/home/leyouç›®å½• è§£åŽ‹ç¼©ï¼š 1tar -zxvf elasticsearch-6.2.4.tar.gz æˆ‘ä»¬æŠŠç›®å½•é‡å‘½åï¼š 1mv elasticsearch-6.2.4/ elasticsearch è¿›å…¥ï¼ŒæŸ¥çœ‹ç›®å½•ç»“æž„ï¼š 1.2.3.ä¿®æ”¹é…ç½®æˆ‘ä»¬è¿›å…¥configç›®å½•ï¼šcd config éœ€è¦ä¿®æ”¹çš„é…ç½®æ–‡ä»¶æœ‰ä¸¤ä¸ªï¼š jvm.options ElasticsearchåŸºäºŽLuceneçš„ï¼Œè€ŒLuceneåº•å±‚æ˜¯javaå®žçŽ°ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é…ç½®jvmå‚æ•°ã€‚ ç¼–è¾‘jvm.optionsï¼š 1vim jvm.options é»˜è®¤é…ç½®å¦‚ä¸‹ï¼š 12-Xms1g-Xmx1g å†…å­˜å ç”¨å¤ªå¤šäº†ï¼Œæˆ‘ä»¬è°ƒå°ä¸€äº›ï¼š 12-Xms512m-Xmx512m elasticsearch.yml 1vim elasticsearch.yml ä¿®æ”¹æ•°æ®å’Œæ—¥å¿—ç›®å½•ï¼š 12path.data: /home/leyou/elasticsearch/data # æ•°æ®ç›®å½•ä½ç½®path.logs: /home/leyou/elasticsearch/logs # æ—¥å¿—ç›®å½•ä½ç½® æˆ‘ä»¬æŠŠdataå’Œlogsç›®å½•ä¿®æ”¹æŒ‡å‘äº†elasticsearchçš„å®‰è£…ç›®å½•ã€‚ä½†æ˜¯è¿™ä¸¤ä¸ªç›®å½•å¹¶ä¸å­˜åœ¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ›å»ºå‡ºæ¥ã€‚ è¿›å…¥elasticsearchçš„æ ¹ç›®å½•ï¼Œç„¶åŽåˆ›å»ºï¼š 12mkdir datamkdir logs ä¿®æ”¹ç»‘å®šçš„ipï¼š 1network.host: 0.0.0.0 # ç»‘å®šåˆ°0.0.0.0ï¼Œå…è®¸ä»»ä½•ipæ¥è®¿é—® é»˜è®¤åªå…è®¸æœ¬æœºè®¿é—®ï¼Œä¿®æ”¹ä¸º0.0.0.0åŽåˆ™å¯ä»¥è¿œç¨‹è®¿é—® ç›®å‰æˆ‘ä»¬æ˜¯åšçš„å•æœºå®‰è£…ï¼Œå¦‚æžœè¦åšé›†ç¾¤ï¼Œåªéœ€è¦åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­æ·»åŠ å…¶å®ƒèŠ‚ç‚¹ä¿¡æ¯å³å¯ã€‚ elasticsearch.ymlçš„å…¶å®ƒå¯é…ç½®ä¿¡æ¯ï¼š å±žæ€§å è¯´æ˜Ž cluster.name é…ç½®elasticsearchçš„é›†ç¾¤åç§°ï¼Œé»˜è®¤æ˜¯elasticsearchã€‚å»ºè®®ä¿®æ”¹æˆä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°ã€‚ node.name èŠ‚ç‚¹åï¼Œesä¼šé»˜è®¤éšæœºæŒ‡å®šä¸€ä¸ªåå­—ï¼Œå»ºè®®æŒ‡å®šä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°ï¼Œæ–¹ä¾¿ç®¡ç† path.conf è®¾ç½®é…ç½®æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œtaræˆ–zipåŒ…å®‰è£…é»˜è®¤åœ¨esæ ¹ç›®å½•ä¸‹çš„configæ–‡ä»¶å¤¹ï¼Œrpmå®‰è£…é»˜è®¤åœ¨/etc/ elasticsearch path.data è®¾ç½®ç´¢å¼•æ•°æ®çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯esæ ¹ç›®å½•ä¸‹çš„dataæ–‡ä»¶å¤¹ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªå­˜å‚¨è·¯å¾„ï¼Œç”¨é€—å·éš”å¼€ path.logs è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯esæ ¹ç›®å½•ä¸‹çš„logsæ–‡ä»¶å¤¹ path.plugins è®¾ç½®æ’ä»¶çš„å­˜æ”¾è·¯å¾„ï¼Œé»˜è®¤æ˜¯esæ ¹ç›®å½•ä¸‹çš„pluginsæ–‡ä»¶å¤¹ bootstrap.memory_lock è®¾ç½®ä¸ºtrueå¯ä»¥é”ä½ESä½¿ç”¨çš„å†…å­˜ï¼Œé¿å…å†…å­˜è¿›è¡Œswap network.host è®¾ç½®bind_hostå’Œpublish_hostï¼Œè®¾ç½®ä¸º0.0.0.0å…è®¸å¤–ç½‘è®¿é—® http.port è®¾ç½®å¯¹å¤–æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ä¸º9200ã€‚ transport.tcp.port é›†ç¾¤ç»“ç‚¹ä¹‹é—´é€šä¿¡ç«¯å£ discovery.zen.ping.timeout è®¾ç½®ESè‡ªåŠ¨å‘çŽ°èŠ‚ç‚¹è¿žæŽ¥è¶…æ—¶çš„æ—¶é—´ï¼Œé»˜è®¤ä¸º3ç§’ï¼Œå¦‚æžœç½‘ç»œå»¶è¿Ÿé«˜å¯è®¾ç½®å¤§äº› discovery.zen.minimum_master_nodes ä¸»ç»“ç‚¹æ•°é‡çš„æœ€å°‘å€¼ ,æ­¤å€¼çš„å…¬å¼ä¸ºï¼š(master_eligible_nodes / 2) + 1 ï¼Œæ¯”å¦‚ï¼šæœ‰3ä¸ªç¬¦åˆè¦æ±‚çš„ä¸»ç»“ç‚¹ï¼Œé‚£ä¹ˆè¿™é‡Œè¦è®¾ç½®ä¸º2 1.3.è¿è¡Œè¿›å…¥elasticsearch/binç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢çš„æ‰§è¡Œæ–‡ä»¶ï¼š ç„¶åŽè¾“å…¥å‘½ä»¤ï¼š 1./elasticsearch å‘çŽ°æŠ¥é”™äº†ï¼Œå¯åŠ¨å¤±è´¥ï¼š 1.3.1.é”™è¯¯1ï¼šå†…æ ¸è¿‡ä½Ž æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯centos6ï¼Œå…¶linuxå†…æ ¸ç‰ˆæœ¬ä¸º2.6ã€‚è€ŒElasticsearchçš„æ’ä»¶è¦æ±‚è‡³å°‘3.5ä»¥ä¸Šç‰ˆæœ¬ã€‚ä¸è¿‡æ²¡å…³ç³»ï¼Œæˆ‘ä»¬ç¦ç”¨è¿™ä¸ªæ’ä»¶å³å¯ã€‚ ä¿®æ”¹elasticsearch.ymlæ–‡ä»¶ï¼Œåœ¨æœ€ä¸‹é¢æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š 1bootstrap.system_call_filter: false ç„¶åŽé‡å¯ 1.3.2.é”™è¯¯2ï¼šæ–‡ä»¶æƒé™ä¸è¶³å†æ¬¡å¯åŠ¨ï¼Œåˆå‡ºé”™äº†ï¼š 1[1]: max file descriptors [4096] for elasticsearch process likely too low, increase to at least [65536] æˆ‘ä»¬ç”¨çš„æ˜¯leyouç”¨æˆ·ï¼Œè€Œä¸æ˜¯rootï¼Œæ‰€ä»¥æ–‡ä»¶æƒé™ä¸è¶³ã€‚ é¦–å…ˆç”¨rootç”¨æˆ·ç™»å½•ã€‚ ç„¶åŽä¿®æ”¹é…ç½®æ–‡ä»¶: 1vim /etc/security/limits.conf æ·»åŠ ä¸‹é¢çš„å†…å®¹ï¼š 1234567* soft nofile 65536* hard nofile 131072* soft nproc 4096* hard nproc 4096 1.3.3.é”™è¯¯3ï¼šçº¿ç¨‹æ•°ä¸å¤Ÿåˆšæ‰æŠ¥é”™ä¸­ï¼Œè¿˜æœ‰ä¸€è¡Œï¼š 1[1]: max number of threads [1024] for user [leyou] is too low, increase to at least [4096] è¿™æ˜¯çº¿ç¨‹æ•°ä¸å¤Ÿã€‚ ç»§ç»­ä¿®æ”¹é…ç½®ï¼š 1vim /etc/security/limits.d/90-nproc.conf ä¿®æ”¹ä¸‹é¢çš„å†…å®¹ï¼š 1* soft nproc 1024 æ”¹ä¸ºï¼š 1* soft nproc 4096 1.3.4.é”™è¯¯4ï¼šè¿›ç¨‹è™šæ‹Ÿå†…å­˜1[3]: max virtual memory areas vm.max_map_count [65530] likely too low, increase to at least [262144] vm.max_map_countï¼šé™åˆ¶ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰çš„VMA(è™šæ‹Ÿå†…å­˜åŒºåŸŸ)çš„æ•°é‡ï¼Œç»§ç»­ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œ ï¼š 1vim /etc/sysctl.conf æ·»åŠ ä¸‹é¢å†…å®¹ï¼š 1vm.max_map_count=655360 ç„¶åŽæ‰§è¡Œå‘½ä»¤ï¼š 1sysctl -p 1.3.5.é‡å¯ç»ˆç«¯çª—å£æ‰€æœ‰é”™è¯¯ä¿®æ”¹å®Œæ¯•ï¼Œä¸€å®šè¦é‡å¯ä½ çš„ Xshellç»ˆç«¯ï¼Œå¦åˆ™é…ç½®æ— æ•ˆã€‚ 1.3.6.å¯åŠ¨å†æ¬¡å¯åŠ¨ï¼Œç»ˆäºŽæˆåŠŸäº†ï¼ å¯ä»¥çœ‹åˆ°ç»‘å®šäº†ä¸¤ä¸ªç«¯å£: 9300ï¼šé›†ç¾¤èŠ‚ç‚¹é—´é€šè®¯æŽ¥å£ 9200ï¼šå®¢æˆ·ç«¯è®¿é—®æŽ¥å£ æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼šhttp://192.168.56.101:9200 1.4.å®‰è£…kibana1.4.1.ä»€ä¹ˆæ˜¯Kibanaï¼Ÿ Kibanaæ˜¯ä¸€ä¸ªåŸºäºŽNode.jsçš„Elasticsearchç´¢å¼•åº“æ•°æ®ç»Ÿè®¡å·¥å…·ï¼Œå¯ä»¥åˆ©ç”¨Elasticsearchçš„èšåˆåŠŸèƒ½ï¼Œç”Ÿæˆå„ç§å›¾è¡¨ï¼Œå¦‚æŸ±å½¢å›¾ï¼Œçº¿çŠ¶å›¾ï¼Œé¥¼å›¾ç­‰ã€‚ è€Œä¸”è¿˜æä¾›äº†æ“ä½œElasticsearchç´¢å¼•æ•°æ®çš„æŽ§åˆ¶å°ï¼Œå¹¶ä¸”æä¾›äº†ä¸€å®šçš„APIæç¤ºï¼Œéžå¸¸æœ‰åˆ©äºŽæˆ‘ä»¬å­¦ä¹ Elasticsearchçš„è¯­æ³•ã€‚ 1.4.2.å®‰è£…å› ä¸ºKibanaä¾èµ–äºŽnodeï¼Œæˆ‘ä»¬çš„è™šæ‹Ÿæœºæ²¡æœ‰å®‰è£…nodeï¼Œè€Œwindowä¸­å®‰è£…è¿‡ã€‚æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©åœ¨windowä¸‹ä½¿ç”¨kibanaã€‚ æœ€æ–°ç‰ˆæœ¬ä¸Želasticsearchä¿æŒä¸€è‡´ï¼Œä¹Ÿæ˜¯6.3.0 è§£åŽ‹åˆ°ç‰¹å®šç›®å½•å³å¯ 1.4.3.é…ç½®è¿è¡Œ é…ç½® è¿›å…¥å®‰è£…ç›®å½•ä¸‹çš„configç›®å½•ï¼Œä¿®æ”¹kibana.ymlæ–‡ä»¶ï¼š ä¿®æ”¹elasticsearchæœåŠ¡å™¨çš„åœ°å€ï¼š 1elasticsearch.url: &quot;http://192.168.56.101:9200&quot; è¿è¡Œ è¿›å…¥å®‰è£…ç›®å½•ä¸‹çš„binç›®å½•ï¼š åŒå‡»è¿è¡Œï¼š å‘çŽ°kibanaçš„ç›‘å¬ç«¯å£æ˜¯5601 æˆ‘ä»¬è®¿é—®ï¼šhttp://127.0.0.1:5601 1.4.4.æŽ§åˆ¶å°é€‰æ‹©å·¦ä¾§çš„DevToolsèœå•ï¼Œå³å¯è¿›å…¥æŽ§åˆ¶å°é¡µé¢ï¼š åœ¨é¡µé¢å³ä¾§ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¾“å…¥è¯·æ±‚ï¼Œè®¿é—®Elasticsearchäº†ã€‚ 1.5.å®‰è£…ikåˆ†è¯å™¨Luceneçš„IKåˆ†è¯å™¨æ—©åœ¨2012å¹´å·²ç»æ²¡æœ‰ç»´æŠ¤äº†ï¼ŒçŽ°åœ¨æˆ‘ä»¬è¦ä½¿ç”¨çš„æ˜¯åœ¨å…¶åŸºç¡€ä¸Šç»´æŠ¤å‡çº§çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¼€å‘ä¸ºElasticSearchçš„é›†æˆæ’ä»¶äº†ï¼Œä¸ŽElasticsearchä¸€èµ·ç»´æŠ¤å‡çº§ï¼Œç‰ˆæœ¬ä¹Ÿä¿æŒä¸€è‡´ï¼Œæœ€æ–°ç‰ˆæœ¬ï¼š6.3.0 1.5.1.å®‰è£…ä¸Šä¼ è¯¾å‰èµ„æ–™ä¸­çš„zipåŒ…ï¼Œè§£åŽ‹åˆ°Elasticsearchç›®å½•çš„pluginsç›®å½•ä¸­ï¼š ä½¿ç”¨unzipå‘½ä»¤è§£åŽ‹ï¼š 1unzip elasticsearch-analysis-ik-6.3.0.zip -d ik-analyzer ç„¶åŽé‡å¯elasticsearchï¼š 1.5.2.æµ‹è¯•å¤§å®¶å…ˆä¸ç®¡è¯­æ³•ï¼Œæˆ‘ä»¬å…ˆæµ‹è¯•ä¸€æ³¢ã€‚ åœ¨kibanaæŽ§åˆ¶å°è¾“å…¥ä¸‹é¢çš„è¯·æ±‚ï¼š 12345POST _analyze&#123; &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;text&quot;: &quot;æˆ‘æ˜¯ä¸­å›½äºº&quot;&#125; è¿è¡Œå¾—åˆ°ç»“æžœï¼š 123456789101112131415161718192021222324252627282930313233343536373839&#123; &quot;tokens&quot;: [ &#123; &quot;token&quot;: &quot;æˆ‘&quot;, &quot;start_offset&quot;: 0, &quot;end_offset&quot;: 1, &quot;type&quot;: &quot;CN_CHAR&quot;, &quot;position&quot;: 0 &#125;, &#123; &quot;token&quot;: &quot;æ˜¯&quot;, &quot;start_offset&quot;: 1, &quot;end_offset&quot;: 2, &quot;type&quot;: &quot;CN_CHAR&quot;, &quot;position&quot;: 1 &#125;, &#123; &quot;token&quot;: &quot;ä¸­å›½äºº&quot;, &quot;start_offset&quot;: 2, &quot;end_offset&quot;: 5, &quot;type&quot;: &quot;CN_WORD&quot;, &quot;position&quot;: 2 &#125;, &#123; &quot;token&quot;: &quot;ä¸­å›½&quot;, &quot;start_offset&quot;: 2, &quot;end_offset&quot;: 4, &quot;type&quot;: &quot;CN_WORD&quot;, &quot;position&quot;: 3 &#125;, &#123; &quot;token&quot;: &quot;å›½äºº&quot;, &quot;start_offset&quot;: 3, &quot;end_offset&quot;: 5, &quot;type&quot;: &quot;CN_WORD&quot;, &quot;position&quot;: 4 &#125; ]&#125; 1.7.APIElasticsearchæä¾›äº†Resté£Žæ ¼çš„APIï¼Œå³httpè¯·æ±‚æŽ¥å£ï¼Œè€Œä¸”ä¹Ÿæä¾›äº†å„ç§è¯­è¨€çš„å®¢æˆ·ç«¯API 1.7.1.Resté£Žæ ¼APIæ–‡æ¡£åœ°å€ï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/current/index.html 1.7.2.å®¢æˆ·ç«¯APIElasticsearchæ”¯æŒçš„å®¢æˆ·ç«¯éžå¸¸å¤šï¼šhttps://www.elastic.co/guide/en/elasticsearch/client/index.html ç‚¹å‡»Java Rest ClientåŽï¼Œä½ ä¼šå‘çŽ°åˆæœ‰ä¸¤ä¸ªï¼š Low Level Rest Clientæ˜¯ä½Žçº§åˆ«å°è£…ï¼Œæä¾›ä¸€äº›åŸºç¡€åŠŸèƒ½ï¼Œä½†æ›´çµæ´» High Level Rest Clientï¼Œæ˜¯åœ¨Low Level Rest ClientåŸºç¡€ä¸Šè¿›è¡Œçš„é«˜çº§åˆ«å°è£…ï¼ŒåŠŸèƒ½æ›´ä¸°å¯Œå’Œå®Œå–„ï¼Œè€Œä¸”APIä¼šå˜çš„ç®€å• 1.7.3.å¦‚ä½•å­¦ä¹ å»ºè®®å…ˆå­¦ä¹ Resté£Žæ ¼APIï¼Œäº†è§£å‘èµ·è¯·æ±‚çš„åº•å±‚å®žçŽ°ï¼Œè¯·æ±‚ä½“æ ¼å¼ç­‰ã€‚ 2.æ“ä½œç´¢å¼•2.1.åŸºæœ¬æ¦‚å¿µElasticsearchä¹Ÿæ˜¯åŸºäºŽLuceneçš„å…¨æ–‡æ£€ç´¢åº“ï¼Œæœ¬è´¨ä¹Ÿæ˜¯å­˜å‚¨æ•°æ®ï¼Œå¾ˆå¤šæ¦‚å¿µä¸ŽMySQLç±»ä¼¼çš„ã€‚ å¯¹æ¯”å…³ç³»ï¼š ç´¢å¼•ï¼ˆindicesï¼‰â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“Databases æ•°æ®åº“ â€‹ ç±»åž‹ï¼ˆtypeï¼‰â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“Table æ•°æ®è¡¨ â€‹ æ–‡æ¡£ï¼ˆDocumentï¼‰â€”â€”â€”â€”â€”-Row è¡Œ â€‹ å­—æ®µï¼ˆFieldï¼‰â€”â€”â€”â€”â€”â€”-Columns åˆ— è¯¦ç»†è¯´æ˜Žï¼š æ¦‚å¿µ è¯´æ˜Ž ç´¢å¼•åº“ï¼ˆindices) indicesæ˜¯indexçš„å¤æ•°ï¼Œä»£è¡¨è®¸å¤šçš„ç´¢å¼•ï¼Œ ç±»åž‹ï¼ˆtypeï¼‰ ç±»åž‹æ˜¯æ¨¡æ‹Ÿmysqlä¸­çš„tableæ¦‚å¿µï¼Œä¸€ä¸ªç´¢å¼•åº“ä¸‹å¯ä»¥æœ‰ä¸åŒç±»åž‹çš„ç´¢å¼•ï¼Œæ¯”å¦‚å•†å“ç´¢å¼•ï¼Œè®¢å•ç´¢å¼•ï¼Œå…¶æ•°æ®æ ¼å¼ä¸åŒã€‚ä¸è¿‡è¿™ä¼šå¯¼è‡´ç´¢å¼•åº“æ··ä¹±ï¼Œå› æ­¤æœªæ¥ç‰ˆæœ¬ä¸­ä¼šç§»é™¤è¿™ä¸ªæ¦‚å¿µ æ–‡æ¡£ï¼ˆdocumentï¼‰ å­˜å…¥ç´¢å¼•åº“åŽŸå§‹çš„æ•°æ®ã€‚æ¯”å¦‚æ¯ä¸€æ¡å•†å“ä¿¡æ¯ï¼Œå°±æ˜¯ä¸€ä¸ªæ–‡æ¡£ å­—æ®µï¼ˆfieldï¼‰ æ–‡æ¡£ä¸­çš„å±žæ€§ æ˜ å°„é…ç½®ï¼ˆmappingsï¼‰ å­—æ®µçš„æ•°æ®ç±»åž‹ã€å±žæ€§ã€æ˜¯å¦ç´¢å¼•ã€æ˜¯å¦å­˜å‚¨ç­‰ç‰¹æ€§ æ˜¯ä¸æ˜¯ä¸ŽLuceneå’Œsolrä¸­çš„æ¦‚å¿µç±»ä¼¼ã€‚ å¦å¤–ï¼Œåœ¨SolrCloudä¸­ï¼Œæœ‰ä¸€äº›é›†ç¾¤ç›¸å…³çš„æ¦‚å¿µï¼Œåœ¨Elasticsearchä¹Ÿæœ‰ç±»ä¼¼çš„ï¼š ç´¢å¼•é›†ï¼ˆIndicesï¼Œindexçš„å¤æ•°ï¼‰ï¼šé€»è¾‘ä¸Šçš„å®Œæ•´ç´¢å¼• åˆ†ç‰‡ï¼ˆshardï¼‰ï¼šæ•°æ®æ‹†åˆ†åŽçš„å„ä¸ªéƒ¨åˆ† å‰¯æœ¬ï¼ˆreplicaï¼‰ï¼šæ¯ä¸ªåˆ†ç‰‡çš„å¤åˆ¶ è¦æ³¨æ„çš„æ˜¯ï¼šElasticsearchæœ¬èº«å°±æ˜¯åˆ†å¸ƒå¼çš„ï¼Œå› æ­¤å³ä¾¿ä½ åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒElasticsearché»˜è®¤ä¹Ÿä¼šå¯¹ä½ çš„æ•°æ®è¿›è¡Œåˆ†ç‰‡å’Œå‰¯æœ¬æ“ä½œï¼Œå½“ä½ å‘é›†ç¾¤æ·»åŠ æ–°æ•°æ®æ—¶ï¼Œæ•°æ®ä¹Ÿä¼šåœ¨æ–°åŠ å…¥çš„èŠ‚ç‚¹ä¸­è¿›è¡Œå¹³è¡¡ã€‚ 2.2.åˆ›å»ºç´¢å¼•2.2.1.è¯­æ³•Elasticsearché‡‡ç”¨Resté£Žæ ¼APIï¼Œå› æ­¤å…¶APIå°±æ˜¯ä¸€æ¬¡httpè¯·æ±‚ï¼Œä½ å¯ä»¥ç”¨ä»»ä½•å·¥å…·å‘èµ·httpè¯·æ±‚ åˆ›å»ºç´¢å¼•çš„è¯·æ±‚æ ¼å¼ï¼š è¯·æ±‚æ–¹å¼ï¼šPUT è¯·æ±‚è·¯å¾„ï¼š/ç´¢å¼•åº“å è¯·æ±‚å‚æ•°ï¼šjsonæ ¼å¼ï¼š 123456&#123; "settings": &#123; "number_of_shards": 3, "number_of_replicas": 2 &#125;&#125; settingsï¼šç´¢å¼•åº“çš„è®¾ç½® number_of_shardsï¼šåˆ†ç‰‡æ•°é‡ number_of_replicasï¼šå‰¯æœ¬æ•°é‡ 2.2.2.æµ‹è¯•æˆ‘ä»¬å…ˆç”¨RestClientæ¥è¯•è¯• å“åº”ï¼š å¯ä»¥çœ‹åˆ°ç´¢å¼•åˆ›å»ºæˆåŠŸäº†ã€‚ 2.2.3.ä½¿ç”¨kibanaåˆ›å»ºkibanaçš„æŽ§åˆ¶å°ï¼Œå¯ä»¥å¯¹httpè¯·æ±‚è¿›è¡Œç®€åŒ–ï¼Œç¤ºä¾‹ï¼š ç›¸å½“äºŽæ˜¯çœåŽ»äº†elasticsearchçš„æœåŠ¡å™¨åœ°å€ è€Œä¸”è¿˜æœ‰è¯­æ³•æç¤ºï¼Œéžå¸¸èˆ’æœã€‚ 2.3.æŸ¥çœ‹ç´¢å¼•è®¾ç½® è¯­æ³• Getè¯·æ±‚å¯ä»¥å¸®æˆ‘ä»¬æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯ï¼Œæ ¼å¼ï¼š 1GET /ç´¢å¼•åº“å æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨*æ¥æŸ¥è¯¢æ‰€æœ‰ç´¢å¼•åº“é…ç½®ï¼š 2.4.åˆ é™¤ç´¢å¼•åˆ é™¤ç´¢å¼•ä½¿ç”¨DELETEè¯·æ±‚ è¯­æ³• 1DELETE /ç´¢å¼•åº“å ç¤ºä¾‹ å†æ¬¡æŸ¥çœ‹heima2ï¼š å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨HEADè¯·æ±‚ï¼ŒæŸ¥çœ‹ç´¢å¼•æ˜¯å¦å­˜åœ¨ï¼š 2.5.æ˜ å°„é…ç½®ç´¢å¼•æœ‰äº†ï¼ŒæŽ¥ä¸‹æ¥è‚¯å®šæ˜¯æ·»åŠ æ•°æ®ã€‚ä½†æ˜¯ï¼Œåœ¨æ·»åŠ æ•°æ®ä¹‹å‰å¿…é¡»å®šä¹‰æ˜ å°„ã€‚ ä»€ä¹ˆæ˜¯æ˜ å°„ï¼Ÿ â€‹ æ˜ å°„æ˜¯å®šä¹‰æ–‡æ¡£çš„è¿‡ç¨‹ï¼Œæ–‡æ¡£åŒ…å«å“ªäº›å­—æ®µï¼Œè¿™äº›å­—æ®µæ˜¯å¦ä¿å­˜ï¼Œæ˜¯å¦ç´¢å¼•ï¼Œæ˜¯å¦åˆ†è¯ç­‰ åªæœ‰é…ç½®æ¸…æ¥šï¼ŒElasticsearchæ‰ä¼šå¸®æˆ‘ä»¬è¿›è¡Œç´¢å¼•åº“çš„åˆ›å»ºï¼ˆä¸ä¸€å®šï¼‰ 2.5.1.åˆ›å»ºæ˜ å°„å­—æ®µ è¯­æ³• è¯·æ±‚æ–¹å¼ä¾ç„¶æ˜¯PUT 1234567891011PUT /ç´¢å¼•åº“å/_mapping/ç±»åž‹åç§°&#123; &quot;properties&quot;: &#123; &quot;å­—æ®µå&quot;: &#123; &quot;type&quot;: &quot;ç±»åž‹&quot;, &quot;index&quot;: trueï¼Œ &quot;store&quot;: trueï¼Œ &quot;analyzer&quot;: &quot;åˆ†è¯å™¨&quot; &#125; &#125;&#125; ç±»åž‹åç§°ï¼šå°±æ˜¯å‰é¢å°†çš„typeçš„æ¦‚å¿µï¼Œç±»ä¼¼äºŽæ•°æ®åº“ä¸­çš„ä¸åŒè¡¨å­—æ®µåï¼šä»»æ„å¡«å†™ ï¼Œå¯ä»¥æŒ‡å®šè®¸å¤šå±žæ€§ï¼Œä¾‹å¦‚ï¼š typeï¼šç±»åž‹ï¼Œå¯ä»¥æ˜¯textã€longã€shortã€dateã€integerã€objectç­‰ indexï¼šæ˜¯å¦ç´¢å¼•ï¼Œé»˜è®¤ä¸ºtrue storeï¼šæ˜¯å¦å­˜å‚¨ï¼Œé»˜è®¤ä¸ºfalse analyzerï¼šåˆ†è¯å™¨ï¼Œè¿™é‡Œçš„ik_max_wordå³ä½¿ç”¨ikåˆ†è¯å™¨ ç¤ºä¾‹ å‘èµ·è¯·æ±‚ï¼š 12345678910111213141516PUT heima/_mapping/goods&#123; "properties": &#123; "title": &#123; "type": "text", "analyzer": "ik_max_word" &#125;, "images": &#123; "type": "keyword", "index": "false" &#125;, "price": &#123; "type": "float" &#125; &#125;&#125; å“åº”ç»“æžœï¼š 123&#123; &quot;acknowledged&quot;: true&#125; 2.5.2.æŸ¥çœ‹æ˜ å°„å…³ç³» è¯­æ³•ï¼š 1GET /ç´¢å¼•åº“å/_mapping ç¤ºä¾‹ï¼š 1GET /heima/_mapping å“åº”ï¼š 123456789101112131415161718192021&#123; "heima": &#123; "mappings": &#123; "goods": &#123; "properties": &#123; "images": &#123; "type": "keyword", "index": false &#125;, "price": &#123; "type": "float" &#125;, "title": &#123; "type": "text", "analyzer": "ik_max_word" &#125; &#125; &#125; &#125; &#125;&#125; 2.5.3.å­—æ®µå±žæ€§è¯¦è§£2.5.3.1.typeElasticsearchä¸­æ”¯æŒçš„æ•°æ®ç±»åž‹éžå¸¸ä¸°å¯Œï¼š æˆ‘ä»¬è¯´å‡ ä¸ªå…³é”®çš„ï¼š Stringç±»åž‹ï¼Œåˆåˆ†ä¸¤ç§ï¼š textï¼šå¯åˆ†è¯ï¼Œä¸å¯å‚ä¸Žèšåˆ keywordï¼šä¸å¯åˆ†è¯ï¼Œæ•°æ®ä¼šä½œä¸ºå®Œæ•´å­—æ®µè¿›è¡ŒåŒ¹é…ï¼Œå¯ä»¥å‚ä¸Žèšåˆ Numericalï¼šæ•°å€¼ç±»åž‹ï¼Œåˆ†ä¸¤ç±» åŸºæœ¬æ•°æ®ç±»åž‹ï¼šlongã€intergerã€shortã€byteã€doubleã€floatã€half_float æµ®ç‚¹æ•°çš„é«˜ç²¾åº¦ç±»åž‹ï¼šscaled_float éœ€è¦æŒ‡å®šä¸€ä¸ªç²¾åº¦å› å­ï¼Œæ¯”å¦‚10æˆ–100ã€‚elasticsearchä¼šæŠŠçœŸå®žå€¼ä¹˜ä»¥è¿™ä¸ªå› å­åŽå­˜å‚¨ï¼Œå–å‡ºæ—¶å†è¿˜åŽŸã€‚ Dateï¼šæ—¥æœŸç±»åž‹ elasticsearchå¯ä»¥å¯¹æ—¥æœŸæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²å­˜å‚¨ï¼Œä½†æ˜¯å»ºè®®æˆ‘ä»¬å­˜å‚¨ä¸ºæ¯«ç§’å€¼ï¼Œå­˜å‚¨ä¸ºlongï¼ŒèŠ‚çœç©ºé—´ã€‚ 2.5.3.2.indexindexå½±å“å­—æ®µçš„ç´¢å¼•æƒ…å†µã€‚ trueï¼šå­—æ®µä¼šè¢«ç´¢å¼•ï¼Œåˆ™å¯ä»¥ç”¨æ¥è¿›è¡Œæœç´¢ã€‚é»˜è®¤å€¼å°±æ˜¯true falseï¼šå­—æ®µä¸ä¼šè¢«ç´¢å¼•ï¼Œä¸èƒ½ç”¨æ¥æœç´¢ indexçš„é»˜è®¤å€¼å°±æ˜¯trueï¼Œä¹Ÿå°±æ˜¯è¯´ä½ ä¸è¿›è¡Œä»»ä½•é…ç½®ï¼Œæ‰€æœ‰å­—æ®µéƒ½ä¼šè¢«ç´¢å¼•ã€‚ ä½†æ˜¯æœ‰äº›å­—æ®µæ˜¯æˆ‘ä»¬ä¸å¸Œæœ›è¢«ç´¢å¼•çš„ï¼Œæ¯”å¦‚å•†å“çš„å›¾ç‰‡ä¿¡æ¯ï¼Œå°±éœ€è¦æ‰‹åŠ¨è®¾ç½®indexä¸ºfalseã€‚ 2.5.3.3.storeæ˜¯å¦å°†æ•°æ®è¿›è¡Œé¢å¤–å­˜å‚¨ã€‚ åœ¨å­¦ä¹ luceneå’Œsolræ—¶ï¼Œæˆ‘ä»¬çŸ¥é“å¦‚æžœä¸€ä¸ªå­—æ®µçš„storeè®¾ç½®ä¸ºfalseï¼Œé‚£ä¹ˆåœ¨æ–‡æ¡£åˆ—è¡¨ä¸­å°±ä¸ä¼šæœ‰è¿™ä¸ªå­—æ®µçš„å€¼ï¼Œç”¨æˆ·çš„æœç´¢ç»“æžœä¸­ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚ ä½†æ˜¯åœ¨Elasticsearchä¸­ï¼Œå³ä¾¿storeè®¾ç½®ä¸ºfalseï¼Œä¹Ÿå¯ä»¥æœç´¢åˆ°ç»“æžœã€‚ åŽŸå› æ˜¯Elasticsearchåœ¨åˆ›å»ºæ–‡æ¡£ç´¢å¼•æ—¶ï¼Œä¼šå°†æ–‡æ¡£ä¸­çš„åŽŸå§‹æ•°æ®å¤‡ä»½ï¼Œä¿å­˜åˆ°ä¸€ä¸ªå«åš_sourceçš„å±žæ€§ä¸­ã€‚è€Œä¸”æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿‡æ»¤_sourceæ¥é€‰æ‹©å“ªäº›è¦æ˜¾ç¤ºï¼Œå“ªäº›ä¸æ˜¾ç¤ºã€‚ è€Œå¦‚æžœè®¾ç½®storeä¸ºtrueï¼Œå°±ä¼šåœ¨_sourceä»¥å¤–é¢å¤–å­˜å‚¨ä¸€ä»½æ•°æ®ï¼Œå¤šä½™ï¼Œå› æ­¤ä¸€èˆ¬æˆ‘ä»¬éƒ½ä¼šå°†storeè®¾ç½®ä¸ºfalseï¼Œäº‹å®žä¸Šï¼Œstoreçš„é»˜è®¤å€¼å°±æ˜¯falseã€‚ 2.5.3.4.boostæ¿€åŠ±å› å­ï¼Œè¿™ä¸ªä¸Žluceneä¸­ä¸€æ · å…¶å®ƒçš„ä¸å†ä¸€ä¸€è®²è§£ï¼Œç”¨çš„ä¸å¤šï¼Œå¤§å®¶å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š 2.6.æ–°å¢žæ•°æ®2.6.1.éšæœºç”Ÿæˆidé€šè¿‡POSTè¯·æ±‚ï¼Œå¯ä»¥å‘ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç´¢å¼•åº“ä¸­æ·»åŠ æ•°æ®ã€‚ è¯­æ³•ï¼š 1234POST /ç´¢å¼•åº“å/ç±»åž‹å&#123; &quot;key&quot;:&quot;value&quot;&#125; ç¤ºä¾‹ï¼š 123456POST /heima/goods/&#123; "title":"å°ç±³æ‰‹æœº", "images":"http://image.leyou.com/12479122.jpg", "price":2699.00&#125; å“åº”ï¼š 1234567891011121314&#123; "_index": "heima", "_type": "goods", "_id": "r9c1KGMBIhaxtY5rlRKv", "_version": 1, "result": "created", "_shards": &#123; "total": 3, "successful": 1, "failed": 0 &#125;, "_seq_no": 0, "_primary_term": 2&#125; é€šè¿‡kibanaæŸ¥çœ‹æ•°æ®ï¼š 123456get _search&#123; "query":&#123; "match_all":&#123;&#125; &#125;&#125; 123456789101112&#123; "_index": "heima", "_type": "goods", "_id": "r9c1KGMBIhaxtY5rlRKv", "_version": 1, "_score": 1, "_source": &#123; "title": "å°ç±³æ‰‹æœº", "images": "http://image.leyou.com/12479122.jpg", "price": 2699 &#125;&#125; _sourceï¼šæºæ–‡æ¡£ä¿¡æ¯ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½åœ¨é‡Œé¢ã€‚ _idï¼šè¿™æ¡æ–‡æ¡£çš„å”¯ä¸€æ ‡ç¤ºï¼Œä¸Žæ–‡æ¡£è‡ªå·±çš„idå­—æ®µæ²¡æœ‰å…³è” 2.6.2.è‡ªå®šä¹‰idå¦‚æžœæˆ‘ä»¬æƒ³è¦è‡ªå·±æ–°å¢žçš„æ—¶å€™æŒ‡å®šidï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š 1234POST /ç´¢å¼•åº“å/ç±»åž‹/idå€¼&#123; ...&#125; ç¤ºä¾‹ï¼š 123456POST /heima/goods/2&#123; "title":"å¤§ç±³æ‰‹æœº", "images":"http://image.leyou.com/12479122.jpg", "price":2899.00&#125; å¾—åˆ°çš„æ•°æ®ï¼š 1234567891011&#123; "_index": "heima", "_type": "goods", "_id": "2", "_score": 1, "_source": &#123; "title": "å¤§ç±³æ‰‹æœº", "images": "http://image.leyou.com/12479122.jpg", "price": 2899 &#125;&#125; 2.6.3.æ™ºèƒ½åˆ¤æ–­åœ¨å­¦ä¹ Solræ—¶æˆ‘ä»¬å‘çŽ°ï¼Œæˆ‘ä»¬åœ¨æ–°å¢žæ•°æ®æ—¶ï¼Œåªèƒ½ä½¿ç”¨æå‰é…ç½®å¥½æ˜ å°„å±žæ€§çš„å­—æ®µï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚ ä¸è¿‡åœ¨Elasticsearchä¸­å¹¶æ²¡æœ‰è¿™æ ·çš„è§„å®šã€‚ äº‹å®žä¸ŠElasticsearchéžå¸¸æ™ºèƒ½ï¼Œä½ ä¸éœ€è¦ç»™ç´¢å¼•åº“è®¾ç½®ä»»ä½•mappingæ˜ å°„ï¼Œå®ƒä¹Ÿå¯ä»¥æ ¹æ®ä½ è¾“å…¥çš„æ•°æ®æ¥åˆ¤æ–­ç±»åž‹ï¼ŒåŠ¨æ€æ·»åŠ æ•°æ®æ˜ å°„ã€‚ æµ‹è¯•ä¸€ä¸‹ï¼š 12345678POST /heima/goods/3&#123; "title":"è¶…ç±³æ‰‹æœº", "images":"http://image.leyou.com/12479122.jpg", "price":2899.00, "stock": 200, "saleable":true&#125; æˆ‘ä»¬é¢å¤–æ·»åŠ äº†stockåº“å­˜ï¼Œå’Œsaleableæ˜¯å¦ä¸Šæž¶ä¸¤ä¸ªå­—æ®µã€‚ æ¥çœ‹ç»“æžœï¼š 1234567891011121314&#123; "_index": "heima", "_type": "goods", "_id": "3", "_version": 1, "_score": 1, "_source": &#123; "title": "è¶…ç±³æ‰‹æœº", "images": "http://image.leyou.com/12479122.jpg", "price": 2899, "stock": 200, "saleable": true &#125;&#125; åœ¨çœ‹ä¸‹ç´¢å¼•åº“çš„æ˜ å°„å…³ç³»: 123456789101112131415161718192021222324252627&#123; "heima": &#123; "mappings": &#123; "goods": &#123; "properties": &#123; "images": &#123; "type": "keyword", "index": false &#125;, "price": &#123; "type": "float" &#125;, "saleable": &#123; "type": "boolean" &#125;, "stock": &#123; "type": "long" &#125;, "title": &#123; "type": "text", "analyzer": "ik_max_word" &#125; &#125; &#125; &#125; &#125;&#125; stockå’Œsaleableéƒ½è¢«æˆåŠŸæ˜ å°„äº†ã€‚ 2.7.ä¿®æ”¹æ•°æ®æŠŠåˆšæ‰æ–°å¢žçš„è¯·æ±‚æ–¹å¼æ”¹ä¸ºPUTï¼Œå°±æ˜¯ä¿®æ”¹äº†ã€‚ä¸è¿‡ä¿®æ”¹å¿…é¡»æŒ‡å®šidï¼Œ idå¯¹åº”æ–‡æ¡£å­˜åœ¨ï¼Œåˆ™ä¿®æ”¹ idå¯¹åº”æ–‡æ¡£ä¸å­˜åœ¨ï¼Œåˆ™æ–°å¢ž æ¯”å¦‚ï¼Œæˆ‘ä»¬æŠŠidä¸º3çš„æ•°æ®è¿›è¡Œä¿®æ”¹ï¼š 12345678PUT /heima/goods/3&#123; "title":"è¶…å¤§ç±³æ‰‹æœº", "images":"http://image.leyou.com/12479122.jpg", "price":3899.00, "stock": 100, "saleable":true&#125; ç»“æžœï¼š 1234567891011121314151617181920212223242526272829&#123; "took": 17, "timed_out": false, "_shards": &#123; "total": 9, "successful": 9, "skipped": 0, "failed": 0 &#125;, "hits": &#123; "total": 1, "max_score": 1, "hits": [ &#123; "_index": "heima", "_type": "goods", "_id": "3", "_score": 1, "_source": &#123; "title": "è¶…å¤§ç±³æ‰‹æœº", "images": "http://image.leyou.com/12479122.jpg", "price": 3899, "stock": 100, "saleable": true &#125; &#125; ] &#125;&#125; 2.8.åˆ é™¤æ•°æ®åˆ é™¤ä½¿ç”¨DELETEè¯·æ±‚ï¼ŒåŒæ ·ï¼Œéœ€è¦æ ¹æ®idè¿›è¡Œåˆ é™¤ï¼š è¯­æ³• 1DELETE /ç´¢å¼•åº“å/ç±»åž‹å/idå€¼ ç¤ºä¾‹ï¼š 3.æŸ¥è¯¢æˆ‘ä»¬ä»Ž4å—æ¥è®²æŸ¥è¯¢ï¼š åŸºæœ¬æŸ¥è¯¢ _sourceè¿‡æ»¤ ç»“æžœè¿‡æ»¤ é«˜çº§æŸ¥è¯¢ æŽ’åº 3.1.åŸºæœ¬æŸ¥è¯¢ï¼š åŸºæœ¬è¯­æ³• 12345678GET /ç´¢å¼•åº“å/_search&#123; "query":&#123; "æŸ¥è¯¢ç±»åž‹":&#123; "æŸ¥è¯¢æ¡ä»¶":"æŸ¥è¯¢æ¡ä»¶å€¼" &#125; &#125;&#125; è¿™é‡Œçš„queryä»£è¡¨ä¸€ä¸ªæŸ¥è¯¢å¯¹è±¡ï¼Œé‡Œé¢å¯ä»¥æœ‰ä¸åŒçš„æŸ¥è¯¢å±žæ€§ æŸ¥è¯¢ç±»åž‹ï¼š ä¾‹å¦‚ï¼šmatch_allï¼Œ matchï¼Œterm ï¼Œ range ç­‰ç­‰ æŸ¥è¯¢æ¡ä»¶ï¼šæŸ¥è¯¢æ¡ä»¶ä¼šæ ¹æ®ç±»åž‹çš„ä¸åŒï¼Œå†™æ³•ä¹Ÿæœ‰å·®å¼‚ï¼ŒåŽé¢è¯¦ç»†è®²è§£ 3.1.1 æŸ¥è¯¢æ‰€æœ‰ï¼ˆmatch_all) ç¤ºä¾‹ï¼š 123456GET /heima/_search&#123; "query":&#123; "match_all": &#123;&#125; &#125;&#125; queryï¼šä»£è¡¨æŸ¥è¯¢å¯¹è±¡ match_allï¼šä»£è¡¨æŸ¥è¯¢æ‰€æœ‰ ç»“æžœï¼š 1234567891011121314151617181920212223242526272829303132333435363738&#123; "took": 2, "timed_out": false, "_shards": &#123; "total": 3, "successful": 3, "skipped": 0, "failed": 0 &#125;, "hits": &#123; "total": 2, "max_score": 1, "hits": [ &#123; "_index": "heima", "_type": "goods", "_id": "2", "_score": 1, "_source": &#123; "title": "å¤§ç±³æ‰‹æœº", "images": "http://image.leyou.com/12479122.jpg", "price": 2899 &#125; &#125;, &#123; "_index": "heima", "_type": "goods", "_id": "r9c1KGMBIhaxtY5rlRKv", "_score": 1, "_source": &#123; "title": "å°ç±³æ‰‹æœº", "images": "http://image.leyou.com/12479122.jpg", "price": 2699 &#125; &#125; ] &#125;&#125; tookï¼šæŸ¥è¯¢èŠ±è´¹æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ time_outï¼šæ˜¯å¦è¶…æ—¶ _shardsï¼šåˆ†ç‰‡ä¿¡æ¯ hitsï¼šæœç´¢ç»“æžœæ€»è§ˆå¯¹è±¡ totalï¼šæœç´¢åˆ°çš„æ€»æ¡æ•° max_scoreï¼šæ‰€æœ‰ç»“æžœä¸­æ–‡æ¡£å¾—åˆ†çš„æœ€é«˜åˆ† hitsï¼šæœç´¢ç»“æžœçš„æ–‡æ¡£å¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€æ¡æœç´¢åˆ°çš„æ–‡æ¡£ä¿¡æ¯ _indexï¼šç´¢å¼•åº“ _typeï¼šæ–‡æ¡£ç±»åž‹ _idï¼šæ–‡æ¡£id _scoreï¼šæ–‡æ¡£å¾—åˆ† _sourceï¼šæ–‡æ¡£çš„æºæ•°æ® 3.1.2 åŒ¹é…æŸ¥è¯¢ï¼ˆmatchï¼‰æˆ‘ä»¬å…ˆåŠ å…¥ä¸€æ¡æ•°æ®ï¼Œä¾¿äºŽæµ‹è¯•ï¼š 123456PUT /heima/goods/3&#123; "title":"å°ç±³ç”µè§†4A", "images":"http://image.leyou.com/12479122.jpg", "price":3899.00&#125; çŽ°åœ¨ï¼Œç´¢å¼•åº“ä¸­æœ‰2éƒ¨æ‰‹æœºï¼Œ1å°ç”µè§†ï¼š orå…³ç³» matchç±»åž‹æŸ¥è¯¢ï¼Œä¼šæŠŠæŸ¥è¯¢æ¡ä»¶è¿›è¡Œåˆ†è¯ï¼Œç„¶åŽè¿›è¡ŒæŸ¥è¯¢,å¤šä¸ªè¯æ¡ä¹‹é—´æ˜¯orçš„å…³ç³» 12345678GET /heima/_search&#123; "query":&#123; "match":&#123; "title":"å°ç±³ç”µè§†" &#125; &#125;&#125; ç»“æžœï¼š 12345678910111213141516171819202122232425262728"hits": &#123; "total": 2, "max_score": 0.6931472, "hits": [ &#123; "_index": "heima", "_type": "goods", "_id": "tmUBomQB_mwm6wH_EC1-", "_score": 0.6931472, "_source": &#123; "title": "å°ç±³æ‰‹æœº", "images": "http://image.leyou.com/12479122.jpg", "price": 2699 &#125; &#125;, &#123; "_index": "heima", "_type": "goods", "_id": "3", "_score": 0.5753642, "_source": &#123; "title": "å°ç±³ç”µè§†4A", "images": "http://image.leyou.com/12479122.jpg", "price": 3899 &#125; &#125; ]&#125; åœ¨ä¸Šé¢çš„æ¡ˆä¾‹ä¸­ï¼Œä¸ä»…ä¼šæŸ¥è¯¢åˆ°ç”µè§†ï¼Œè€Œä¸”ä¸Žå°ç±³ç›¸å…³çš„éƒ½ä¼šæŸ¥è¯¢åˆ°ï¼Œå¤šä¸ªè¯ä¹‹é—´æ˜¯orçš„å…³ç³»ã€‚ andå…³ç³» æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ›´ç²¾ç¡®æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªå…³ç³»å˜æˆandï¼Œå¯ä»¥è¿™æ ·åšï¼š 1234567891011GET /heima/_search&#123; "query":&#123; "match": &#123; "title": &#123; "query": "å°ç±³ç”µè§†", "operator": "and" &#125; &#125; &#125;&#125; ç»“æžœï¼š 123456789101112131415161718192021222324252627&#123; "took": 2, "timed_out": false, "_shards": &#123; "total": 3, "successful": 3, "skipped": 0, "failed": 0 &#125;, "hits": &#123; "total": 1, "max_score": 0.5753642, "hits": [ &#123; "_index": "heima", "_type": "goods", "_id": "3", "_score": 0.5753642, "_source": &#123; "title": "å°ç±³ç”µè§†4A", "images": "http://image.leyou.com/12479122.jpg", "price": 3899 &#125; &#125; ] &#125;&#125; æœ¬ä¾‹ä¸­ï¼Œåªæœ‰åŒæ—¶åŒ…å«å°ç±³å’Œç”µè§†çš„è¯æ¡æ‰ä¼šè¢«æœç´¢åˆ°ã€‚ orå’Œandä¹‹é—´ï¼Ÿ åœ¨ or ä¸Ž and é—´äºŒé€‰ä¸€æœ‰ç‚¹è¿‡äºŽéžé»‘å³ç™½ã€‚ å¦‚æžœç”¨æˆ·ç»™å®šçš„æ¡ä»¶åˆ†è¯åŽæœ‰ 5 ä¸ªæŸ¥è¯¢è¯é¡¹ï¼Œæƒ³æŸ¥æ‰¾åªåŒ…å«å…¶ä¸­ 4 ä¸ªè¯çš„æ–‡æ¡£ï¼Œè¯¥å¦‚ä½•å¤„ç†ï¼Ÿå°† operator æ“ä½œç¬¦å‚æ•°è®¾ç½®æˆ and åªä¼šå°†æ­¤æ–‡æ¡£æŽ’é™¤ã€‚ æœ‰æ—¶å€™è¿™æ­£æ˜¯æˆ‘ä»¬æœŸæœ›çš„ï¼Œä½†åœ¨å…¨æ–‡æœç´¢çš„å¤§å¤šæ•°åº”ç”¨åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬æ—¢æƒ³åŒ…å«é‚£äº›å¯èƒ½ç›¸å…³çš„æ–‡æ¡£ï¼ŒåŒæ—¶åˆæŽ’é™¤é‚£äº›ä¸å¤ªç›¸å…³çš„ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬æƒ³è¦å¤„äºŽä¸­é—´æŸç§ç»“æžœã€‚ match æŸ¥è¯¢æ”¯æŒ minimum_should_match æœ€å°åŒ¹é…å‚æ•°ï¼Œ è¿™è®©æˆ‘ä»¬å¯ä»¥æŒ‡å®šå¿…é¡»åŒ¹é…çš„è¯é¡¹æ•°ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªæ–‡æ¡£æ˜¯å¦ç›¸å…³ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶è®¾ç½®ä¸ºæŸä¸ªå…·ä½“æ•°å­—ï¼Œæ›´å¸¸ç”¨çš„åšæ³•æ˜¯å°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªç™¾åˆ†æ•°ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•æŽ§åˆ¶ç”¨æˆ·æœç´¢æ—¶è¾“å…¥çš„å•è¯æ•°é‡ï¼š 1234567891011GET /heima/_search&#123; "query":&#123; "match":&#123; "title":&#123; "query":"å°ç±³æ›²é¢ç”µè§†", "minimum_should_match": "75%" &#125; &#125; &#125;&#125; æœ¬ä¾‹ä¸­ï¼Œæœç´¢è¯­å¥å¯ä»¥åˆ†ä¸º3ä¸ªè¯ï¼Œå¦‚æžœä½¿ç”¨andå…³ç³»ï¼Œéœ€è¦åŒæ—¶æ»¡è¶³3ä¸ªè¯æ‰ä¼šè¢«æœç´¢åˆ°ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨æœ€å°å“ç‰Œæ•°ï¼š75%ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´åªè¦åŒ¹é…åˆ°æ€»è¯æ¡æ•°é‡çš„75%å³å¯ï¼Œè¿™é‡Œ3*75% çº¦ç­‰äºŽ2ã€‚æ‰€ä»¥åªè¦åŒ…å«2ä¸ªè¯æ¡å°±ç®—æ»¡è¶³æ¡ä»¶äº†ã€‚ ç»“æžœï¼š 3.1.3 å¤šå­—æ®µæŸ¥è¯¢ï¼ˆmulti_matchï¼‰multi_matchä¸Žmatchç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å®ƒå¯ä»¥åœ¨å¤šä¸ªå­—æ®µä¸­æŸ¥è¯¢ 123456789GET /heima/_search&#123; "query":&#123; "multi_match": &#123; "query": "å°ç±³", "fields": [ "title", "subTitle" ] &#125; &#125;&#125; æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¼šåœ¨titleå­—æ®µå’Œsubtitleå­—æ®µä¸­æŸ¥è¯¢å°ç±³è¿™ä¸ªè¯ 3.1.4 è¯æ¡åŒ¹é…(term)term æŸ¥è¯¢è¢«ç”¨äºŽç²¾ç¡®å€¼ åŒ¹é…ï¼Œè¿™äº›ç²¾ç¡®å€¼å¯èƒ½æ˜¯æ•°å­—ã€æ—¶é—´ã€å¸ƒå°”æˆ–è€…é‚£äº›æœªåˆ†è¯çš„å­—ç¬¦ä¸² 12345678GET /heima/_search&#123; "query":&#123; "term":&#123; "price":2699.00 &#125; &#125;&#125; ç»“æžœï¼š 123456789101112131415161718192021222324252627&#123; "took": 2, "timed_out": false, "_shards": &#123; "total": 3, "successful": 3, "skipped": 0, "failed": 0 &#125;, "hits": &#123; "total": 1, "max_score": 1, "hits": [ &#123; "_index": "heima", "_type": "goods", "_id": "r9c1KGMBIhaxtY5rlRKv", "_score": 1, "_source": &#123; "title": "å°ç±³æ‰‹æœº", "images": "http://image.leyou.com/12479122.jpg", "price": 2699 &#125; &#125; ] &#125;&#125; 3.1.5 å¤šè¯æ¡ç²¾ç¡®åŒ¹é…(terms)terms æŸ¥è¯¢å’Œ term æŸ¥è¯¢ä¸€æ ·ï¼Œä½†å®ƒå…è®¸ä½ æŒ‡å®šå¤šå€¼è¿›è¡ŒåŒ¹é…ã€‚å¦‚æžœè¿™ä¸ªå­—æ®µåŒ…å«äº†æŒ‡å®šå€¼ä¸­çš„ä»»ä½•ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡æ¡£æ»¡è¶³æ¡ä»¶ï¼š 12345678GET /heima/_search&#123; "query":&#123; "terms":&#123; "price":[2699.00,2899.00,3899.00] &#125; &#125;&#125; ç»“æžœï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849&#123; "took": 4, "timed_out": false, "_shards": &#123; "total": 3, "successful": 3, "skipped": 0, "failed": 0 &#125;, "hits": &#123; "total": 3, "max_score": 1, "hits": [ &#123; "_index": "heima", "_type": "goods", "_id": "2", "_score": 1, "_source": &#123; "title": "å¤§ç±³æ‰‹æœº", "images": "http://image.leyou.com/12479122.jpg", "price": 2899 &#125; &#125;, &#123; "_index": "heima", "_type": "goods", "_id": "r9c1KGMBIhaxtY5rlRKv", "_score": 1, "_source": &#123; "title": "å°ç±³æ‰‹æœº", "images": "http://image.leyou.com/12479122.jpg", "price": 2699 &#125; &#125;, &#123; "_index": "heima", "_type": "goods", "_id": "3", "_score": 1, "_source": &#123; "title": "å°ç±³ç”µè§†4A", "images": "http://image.leyou.com/12479122.jpg", "price": 3899 &#125; &#125; ] &#125;&#125; 3.2.ç»“æžœè¿‡æ»¤é»˜è®¤æƒ…å†µä¸‹ï¼Œelasticsearchåœ¨æœç´¢çš„ç»“æžœä¸­ï¼Œä¼šæŠŠæ–‡æ¡£ä¸­ä¿å­˜åœ¨_sourceçš„æ‰€æœ‰å­—æ®µéƒ½è¿”å›žã€‚ å¦‚æžœæˆ‘ä»¬åªæƒ³èŽ·å–å…¶ä¸­çš„éƒ¨åˆ†å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ _sourceçš„è¿‡æ»¤ 3.2.1.ç›´æŽ¥æŒ‡å®šå­—æ®µç¤ºä¾‹ï¼š 123456789GET /heima/_search&#123; "_source": ["title","price"], "query": &#123; "term": &#123; "price": 2699 &#125; &#125;&#125; è¿”å›žçš„ç»“æžœï¼š 1234567891011121314151617181920212223242526&#123; "took": 12, "timed_out": false, "_shards": &#123; "total": 3, "successful": 3, "skipped": 0, "failed": 0 &#125;, "hits": &#123; "total": 1, "max_score": 1, "hits": [ &#123; "_index": "heima", "_type": "goods", "_id": "r9c1KGMBIhaxtY5rlRKv", "_score": 1, "_source": &#123; "price": 2699, "title": "å°ç±³æ‰‹æœº" &#125; &#125; ] &#125;&#125; 3.2.2.æŒ‡å®šincludeså’Œexcludesæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ï¼š includesï¼šæ¥æŒ‡å®šæƒ³è¦æ˜¾ç¤ºçš„å­—æ®µ excludesï¼šæ¥æŒ‡å®šä¸æƒ³è¦æ˜¾ç¤ºçš„å­—æ®µ äºŒè€…éƒ½æ˜¯å¯é€‰çš„ã€‚ ç¤ºä¾‹ï¼š 1234567891011GET /heima/_search&#123; "_source": &#123; "includes":["title","price"] &#125;, "query": &#123; "term": &#123; "price": 2699 &#125; &#125;&#125; ä¸Žä¸‹é¢çš„ç»“æžœå°†æ˜¯ä¸€æ ·çš„ï¼š 1234567891011GET /heima/_search&#123; "_source": &#123; "excludes": ["images"] &#125;, "query": &#123; "term": &#123; "price": 2699 &#125; &#125;&#125; 3.3 é«˜çº§æŸ¥è¯¢3.3.1 å¸ƒå°”ç»„åˆï¼ˆbool)boolæŠŠå„ç§å…¶å®ƒæŸ¥è¯¢é€šè¿‡mustï¼ˆä¸Žï¼‰ã€must_notï¼ˆéžï¼‰ã€shouldï¼ˆæˆ–ï¼‰çš„æ–¹å¼è¿›è¡Œç»„åˆ 12345678910GET /heima/_search&#123; "query":&#123; "bool":&#123; "must": &#123; "match": &#123; "title": "å¤§ç±³" &#125;&#125;, "must_not": &#123; "match": &#123; "title": "ç”µè§†" &#125;&#125;, "should": &#123; "match": &#123; "title": "æ‰‹æœº" &#125;&#125; &#125; &#125;&#125; ç»“æžœï¼š 123456789101112131415161718192021222324252627&#123; "took": 10, "timed_out": false, "_shards": &#123; "total": 3, "successful": 3, "skipped": 0, "failed": 0 &#125;, "hits": &#123; "total": 1, "max_score": 0.5753642, "hits": [ &#123; "_index": "heima", "_type": "goods", "_id": "2", "_score": 0.5753642, "_source": &#123; "title": "å¤§ç±³æ‰‹æœº", "images": "http://image.leyou.com/12479122.jpg", "price": 2899 &#125; &#125; ] &#125;&#125; 3.3.2 èŒƒå›´æŸ¥è¯¢(range)range æŸ¥è¯¢æ‰¾å‡ºé‚£äº›è½åœ¨æŒ‡å®šåŒºé—´å†…çš„æ•°å­—æˆ–è€…æ—¶é—´ 1234567891011GET /heima/_search&#123; "query":&#123; "range": &#123; "price": &#123; "gte": 1000.0, "lt": 2800.00 &#125; &#125; &#125;&#125; rangeæŸ¥è¯¢å…è®¸ä»¥ä¸‹å­—ç¬¦ï¼š æ“ä½œç¬¦ è¯´æ˜Ž gt å¤§äºŽ gte å¤§äºŽç­‰äºŽ lt å°äºŽ lte å°äºŽç­‰äºŽ 3.3.3 æ¨¡ç³ŠæŸ¥è¯¢(fuzzy)æˆ‘ä»¬æ–°å¢žä¸€ä¸ªå•†å“ï¼š 123456POST /heima/goods/4&#123; "title":"appleæ‰‹æœº", "images":"http://image.leyou.com/12479122.jpg", "price":6899.00&#125; fuzzy æŸ¥è¯¢æ˜¯ term æŸ¥è¯¢çš„æ¨¡ç³Šç­‰ä»·ã€‚å®ƒå…è®¸ç”¨æˆ·æœç´¢è¯æ¡ä¸Žå®žé™…è¯æ¡çš„æ‹¼å†™å‡ºçŽ°åå·®ï¼Œä½†æ˜¯åå·®çš„ç¼–è¾‘è·ç¦»ä¸å¾—è¶…è¿‡2ï¼š 12345678GET /heima/_search&#123; "query": &#123; "fuzzy": &#123; "title": "appla" &#125; &#125;&#125; ä¸Šé¢çš„æŸ¥è¯¢ï¼Œä¹Ÿèƒ½æŸ¥è¯¢åˆ°appleæ‰‹æœº æˆ‘ä»¬å¯ä»¥é€šè¿‡fuzzinessæ¥æŒ‡å®šå…è®¸çš„ç¼–è¾‘è·ç¦»ï¼š 1234567891011GET /heima/_search&#123; "query": &#123; "fuzzy": &#123; "title": &#123; "value":"appla", "fuzziness":1 &#125; &#125; &#125;&#125; 3.4 è¿‡æ»¤(filter) æ¡ä»¶æŸ¥è¯¢ä¸­è¿›è¡Œè¿‡æ»¤ æ‰€æœ‰çš„æŸ¥è¯¢éƒ½ä¼šå½±å“åˆ°æ–‡æ¡£çš„è¯„åˆ†åŠæŽ’åã€‚å¦‚æžœæˆ‘ä»¬éœ€è¦åœ¨æŸ¥è¯¢ç»“æžœä¸­è¿›è¡Œè¿‡æ»¤ï¼Œå¹¶ä¸”ä¸å¸Œæœ›è¿‡æ»¤æ¡ä»¶å½±å“è¯„åˆ†ï¼Œé‚£ä¹ˆå°±ä¸è¦æŠŠè¿‡æ»¤æ¡ä»¶ä½œä¸ºæŸ¥è¯¢æ¡ä»¶æ¥ç”¨ã€‚è€Œæ˜¯ä½¿ç”¨filteræ–¹å¼ï¼š 1234567891011GET /heima/_search&#123; "query":&#123; "bool":&#123; "must":&#123; "match": &#123; "title": "å°ç±³æ‰‹æœº" &#125;&#125;, "filter":&#123; "range":&#123;"price":&#123;"gt":2000.00,"lt":3800.00&#125;&#125; &#125; &#125; &#125;&#125; æ³¨æ„ï¼šfilterä¸­è¿˜å¯ä»¥å†æ¬¡è¿›è¡Œboolç»„åˆæ¡ä»¶è¿‡æ»¤ã€‚ æ— æŸ¥è¯¢æ¡ä»¶ï¼Œç›´æŽ¥è¿‡æ»¤ å¦‚æžœä¸€æ¬¡æŸ¥è¯¢åªæœ‰è¿‡æ»¤ï¼Œæ²¡æœ‰æŸ¥è¯¢æ¡ä»¶ï¼Œä¸å¸Œæœ›è¿›è¡Œè¯„åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨constant_scoreå–ä»£åªæœ‰ filter è¯­å¥çš„ bool æŸ¥è¯¢ã€‚åœ¨æ€§èƒ½ä¸Šæ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œä½†å¯¹äºŽæé«˜æŸ¥è¯¢ç®€æ´æ€§å’Œæ¸…æ™°åº¦æœ‰å¾ˆå¤§å¸®åŠ©ã€‚ 123456789GET /heima/_search&#123; "query":&#123; "constant_score": &#123; "filter": &#123; "range":&#123;"price":&#123;"gt":2000.00,"lt":3000.00&#125;&#125; &#125; &#125;&#125; 3.5 æŽ’åº3.4.1 å•å­—æ®µæŽ’åºsort å¯ä»¥è®©æˆ‘ä»¬æŒ‰ç…§ä¸åŒçš„å­—æ®µè¿›è¡ŒæŽ’åºï¼Œå¹¶ä¸”é€šè¿‡orderæŒ‡å®šæŽ’åºçš„æ–¹å¼ 123456789101112131415GET /heima/_search&#123; "query": &#123; "match": &#123; "title": "å°ç±³æ‰‹æœº" &#125; &#125;, "sort": [ &#123; "price": &#123; "order": "desc" &#125; &#125; ]&#125; 3.4.2 å¤šå­—æ®µæŽ’åºå‡å®šæˆ‘ä»¬æƒ³è¦ç»“åˆä½¿ç”¨ priceå’Œ _scoreï¼ˆå¾—åˆ†ï¼‰ è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸”åŒ¹é…çš„ç»“æžœé¦–å…ˆæŒ‰ç…§ä»·æ ¼æŽ’åºï¼Œç„¶åŽæŒ‰ç…§ç›¸å…³æ€§å¾—åˆ†æŽ’åºï¼š 123456789101112131415GET /goods/_search&#123; "query":&#123; "bool":&#123; "must":&#123; "match": &#123; "title": "å°ç±³æ‰‹æœº" &#125;&#125;, "filter":&#123; "range":&#123;"price":&#123;"gt":200000,"lt":300000&#125;&#125; &#125; &#125; &#125;, "sort": [ &#123; "price": &#123; "order": "desc" &#125;&#125;, &#123; "_score": &#123; "order": "desc" &#125;&#125; ]&#125; 4. èšåˆaggregationsèšåˆå¯ä»¥è®©æˆ‘ä»¬æžå…¶æ–¹ä¾¿çš„å®žçŽ°å¯¹æ•°æ®çš„ç»Ÿè®¡ã€åˆ†æžã€‚ä¾‹å¦‚ï¼š ä»€ä¹ˆå“ç‰Œçš„æ‰‹æœºæœ€å—æ¬¢è¿Žï¼Ÿ è¿™äº›æ‰‹æœºçš„å¹³å‡ä»·æ ¼ã€æœ€é«˜ä»·æ ¼ã€æœ€ä½Žä»·æ ¼ï¼Ÿ è¿™äº›æ‰‹æœºæ¯æœˆçš„é”€å”®æƒ…å†µå¦‚ä½•ï¼Ÿ å®žçŽ°è¿™äº›ç»Ÿè®¡åŠŸèƒ½çš„æ¯”æ•°æ®åº“çš„sqlè¦æ–¹ä¾¿çš„å¤šï¼Œè€Œä¸”æŸ¥è¯¢é€Ÿåº¦éžå¸¸å¿«ï¼Œå¯ä»¥å®žçŽ°å®žæ—¶æœç´¢æ•ˆæžœã€‚ 4.1 åŸºæœ¬æ¦‚å¿µElasticsearchä¸­çš„èšåˆï¼ŒåŒ…å«å¤šç§ç±»åž‹ï¼Œæœ€å¸¸ç”¨çš„ä¸¤ç§ï¼Œä¸€ä¸ªå«æ¡¶ï¼Œä¸€ä¸ªå«åº¦é‡ï¼š æ¡¶ï¼ˆbucketï¼‰ æ¡¶çš„ä½œç”¨ï¼Œæ˜¯æŒ‰ç…§æŸç§æ–¹å¼å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œæ¯ä¸€ç»„æ•°æ®åœ¨ESä¸­ç§°ä¸ºä¸€ä¸ªæ¡¶ï¼Œä¾‹å¦‚æˆ‘ä»¬æ ¹æ®å›½ç±å¯¹äººåˆ’åˆ†ï¼Œå¯ä»¥å¾—åˆ°ä¸­å›½æ¡¶ã€è‹±å›½æ¡¶ï¼Œæ—¥æœ¬æ¡¶â€¦â€¦æˆ–è€…æˆ‘ä»¬æŒ‰ç…§å¹´é¾„æ®µå¯¹äººè¿›è¡Œåˆ’åˆ†ï¼š0~10,10~20,20~30,30~40ç­‰ã€‚ Elasticsearchä¸­æä¾›çš„åˆ’åˆ†æ¡¶çš„æ–¹å¼æœ‰å¾ˆå¤šï¼š Date Histogram Aggregationï¼šæ ¹æ®æ—¥æœŸé˜¶æ¢¯åˆ†ç»„ï¼Œä¾‹å¦‚ç»™å®šé˜¶æ¢¯ä¸ºå‘¨ï¼Œä¼šè‡ªåŠ¨æ¯å‘¨åˆ†ä¸ºä¸€ç»„ Histogram Aggregationï¼šæ ¹æ®æ•°å€¼é˜¶æ¢¯åˆ†ç»„ï¼Œä¸Žæ—¥æœŸç±»ä¼¼ Terms Aggregationï¼šæ ¹æ®è¯æ¡å†…å®¹åˆ†ç»„ï¼Œè¯æ¡å†…å®¹å®Œå…¨åŒ¹é…çš„ä¸ºä¸€ç»„ Range Aggregationï¼šæ•°å€¼å’Œæ—¥æœŸçš„èŒƒå›´åˆ†ç»„ï¼ŒæŒ‡å®šå¼€å§‹å’Œç»“æŸï¼Œç„¶åŽæŒ‰æ®µåˆ†ç»„ â€¦â€¦ ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å‘çŽ°bucket aggregations åªè´Ÿè´£å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ä¸è¿›è¡Œè®¡ç®—ï¼Œå› æ­¤å¾€å¾€bucketä¸­å¾€å¾€ä¼šåµŒå¥—å¦ä¸€ç§èšåˆï¼šmetrics aggregationså³åº¦é‡ åº¦é‡ï¼ˆmetricsï¼‰ åˆ†ç»„å®Œæˆä»¥åŽï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå¯¹ç»„ä¸­çš„æ•°æ®è¿›è¡Œèšåˆè¿ç®—ï¼Œä¾‹å¦‚æ±‚å¹³å‡å€¼ã€æœ€å¤§ã€æœ€å°ã€æ±‚å’Œç­‰ï¼Œè¿™äº›åœ¨ESä¸­ç§°ä¸ºåº¦é‡ æ¯”è¾ƒå¸¸ç”¨çš„ä¸€äº›åº¦é‡èšåˆæ–¹å¼ï¼š Avg Aggregationï¼šæ±‚å¹³å‡å€¼ Max Aggregationï¼šæ±‚æœ€å¤§å€¼ Min Aggregationï¼šæ±‚æœ€å°å€¼ Percentiles Aggregationï¼šæ±‚ç™¾åˆ†æ¯” Stats Aggregationï¼šåŒæ—¶è¿”å›žavgã€maxã€minã€sumã€countç­‰ Sum Aggregationï¼šæ±‚å’Œ Top hits Aggregationï¼šæ±‚å‰å‡  Value Count Aggregationï¼šæ±‚æ€»æ•° â€¦â€¦ ä¸ºäº†æµ‹è¯•èšåˆï¼Œæˆ‘ä»¬å…ˆæ‰¹é‡å¯¼å…¥ä¸€äº›æ•°æ® åˆ›å»ºç´¢å¼•ï¼š 12345678910111213141516171819PUT /cars&#123; "settings": &#123; "number_of_shards": 1, "number_of_replicas": 0 &#125;, "mappings": &#123; "transactions": &#123; "properties": &#123; "color": &#123; "type": "keyword" &#125;, "make": &#123; "type": "keyword" &#125; &#125; &#125; &#125;&#125; æ³¨æ„ï¼šåœ¨ESä¸­ï¼Œéœ€è¦è¿›è¡Œèšåˆã€æŽ’åºã€è¿‡æ»¤çš„å­—æ®µå…¶å¤„ç†æ–¹å¼æ¯”è¾ƒç‰¹æ®Šï¼Œå› æ­¤ä¸èƒ½è¢«åˆ†è¯ã€‚è¿™é‡Œæˆ‘ä»¬å°†colorå’Œmakeè¿™ä¸¤ä¸ªæ–‡å­—ç±»åž‹çš„å­—æ®µè®¾ç½®ä¸ºkeywordç±»åž‹ï¼Œè¿™ä¸ªç±»åž‹ä¸ä¼šè¢«åˆ†è¯ï¼Œå°†æ¥å°±å¯ä»¥å‚ä¸Žèšåˆ å¯¼å…¥æ•°æ® 1234567891011121314151617POST /cars/transactions/_bulk&#123; "index": &#123;&#125;&#125;&#123; "price" : 10000, "color" : "red", "make" : "honda", "sold" : "2014-10-28" &#125;&#123; "index": &#123;&#125;&#125;&#123; "price" : 20000, "color" : "red", "make" : "honda", "sold" : "2014-11-05" &#125;&#123; "index": &#123;&#125;&#125;&#123; "price" : 30000, "color" : "green", "make" : "ford", "sold" : "2014-05-18" &#125;&#123; "index": &#123;&#125;&#125;&#123; "price" : 15000, "color" : "blue", "make" : "toyota", "sold" : "2014-07-02" &#125;&#123; "index": &#123;&#125;&#125;&#123; "price" : 12000, "color" : "green", "make" : "toyota", "sold" : "2014-08-19" &#125;&#123; "index": &#123;&#125;&#125;&#123; "price" : 20000, "color" : "red", "make" : "honda", "sold" : "2014-11-05" &#125;&#123; "index": &#123;&#125;&#125;&#123; "price" : 80000, "color" : "red", "make" : "bmw", "sold" : "2014-01-01" &#125;&#123; "index": &#123;&#125;&#125;&#123; "price" : 25000, "color" : "blue", "make" : "ford", "sold" : "2014-02-12" &#125; 4.2 èšåˆä¸ºæ¡¶é¦–å…ˆï¼Œæˆ‘ä»¬æŒ‰ç…§ æ±½è½¦çš„é¢œè‰²coloræ¥åˆ’åˆ†æ¡¶ 1234567891011GET /cars/_search&#123; "size" : 0, "aggs" : &#123; "popular_colors" : &#123; "terms" : &#123; "field" : "color" &#125; &#125; &#125;&#125; sizeï¼š æŸ¥è¯¢æ¡æ•°ï¼Œè¿™é‡Œè®¾ç½®ä¸º0ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å…³å¿ƒæœç´¢åˆ°çš„æ•°æ®ï¼Œåªå…³å¿ƒèšåˆç»“æžœï¼Œæé«˜æ•ˆçŽ‡ aggsï¼šå£°æ˜Žè¿™æ˜¯ä¸€ä¸ªèšåˆæŸ¥è¯¢ï¼Œæ˜¯aggregationsçš„ç¼©å†™ popular_colorsï¼šç»™è¿™æ¬¡èšåˆèµ·ä¸€ä¸ªåå­—ï¼Œä»»æ„ã€‚ termsï¼šåˆ’åˆ†æ¡¶çš„æ–¹å¼ï¼Œè¿™é‡Œæ˜¯æ ¹æ®è¯æ¡åˆ’åˆ† fieldï¼šåˆ’åˆ†æ¡¶çš„å­—æ®µ ç»“æžœï¼š 1234567891011121314151617181920212223242526272829303132333435&#123; "took": 1, "timed_out": false, "_shards": &#123; "total": 1, "successful": 1, "skipped": 0, "failed": 0 &#125;, "hits": &#123; "total": 8, "max_score": 0, "hits": [] &#125;, "aggregations": &#123; "popular_colors": &#123; "doc_count_error_upper_bound": 0, "sum_other_doc_count": 0, "buckets": [ &#123; "key": "red", "doc_count": 4 &#125;, &#123; "key": "blue", "doc_count": 2 &#125;, &#123; "key": "green", "doc_count": 2 &#125; ] &#125; &#125;&#125; hitsï¼šæŸ¥è¯¢ç»“æžœä¸ºç©ºï¼Œå› ä¸ºæˆ‘ä»¬è®¾ç½®äº†sizeä¸º0 aggregationsï¼šèšåˆçš„ç»“æžœ popular_colorsï¼šæˆ‘ä»¬å®šä¹‰çš„èšåˆåç§° bucketsï¼šæŸ¥æ‰¾åˆ°çš„æ¡¶ï¼Œæ¯ä¸ªä¸åŒçš„colorå­—æ®µå€¼éƒ½ä¼šå½¢æˆä¸€ä¸ªæ¡¶ keyï¼šè¿™ä¸ªæ¡¶å¯¹åº”çš„colorå­—æ®µçš„å€¼ doc_countï¼šè¿™ä¸ªæ¡¶ä¸­çš„æ–‡æ¡£æ•°é‡ é€šè¿‡èšåˆçš„ç»“æžœæˆ‘ä»¬å‘çŽ°ï¼Œç›®å‰çº¢è‰²çš„å°è½¦æ¯”è¾ƒç•…é”€ï¼ 4.3 æ¡¶å†…åº¦é‡å‰é¢çš„ä¾‹å­å‘Šè¯‰æˆ‘ä»¬æ¯ä¸ªæ¡¶é‡Œé¢çš„æ–‡æ¡£æ•°é‡ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚ ä½†é€šå¸¸ï¼Œæˆ‘ä»¬çš„åº”ç”¨éœ€è¦æä¾›æ›´å¤æ‚çš„æ–‡æ¡£åº¦é‡ã€‚ ä¾‹å¦‚ï¼Œæ¯ç§é¢œè‰²æ±½è½¦çš„å¹³å‡ä»·æ ¼æ˜¯å¤šå°‘ï¼Ÿ å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰Elasticsearchä½¿ç”¨å“ªä¸ªå­—æ®µï¼Œä½¿ç”¨ä½•ç§åº¦é‡æ–¹å¼è¿›è¡Œè¿ç®—ï¼Œè¿™äº›ä¿¡æ¯è¦åµŒå¥—åœ¨æ¡¶å†…ï¼Œåº¦é‡çš„è¿ç®—ä¼šåŸºäºŽæ¡¶å†…çš„æ–‡æ¡£è¿›è¡Œ çŽ°åœ¨ï¼Œæˆ‘ä»¬ä¸ºåˆšåˆšçš„èšåˆç»“æžœæ·»åŠ  æ±‚ä»·æ ¼å¹³å‡å€¼çš„åº¦é‡ï¼š 123456789101112131415161718GET /cars/_search&#123; "size" : 0, "aggs" : &#123; "popular_colors" : &#123; "terms" : &#123; "field" : "color" &#125;, "aggs":&#123; "avg_price": &#123; "avg": &#123; "field": "price" &#125; &#125; &#125; &#125; &#125;&#125; aggsï¼šæˆ‘ä»¬åœ¨ä¸Šä¸€ä¸ªaggs(popular_colors)ä¸­æ·»åŠ æ–°çš„aggsã€‚å¯è§åº¦é‡ä¹Ÿæ˜¯ä¸€ä¸ªèšåˆ,åº¦é‡æ˜¯åœ¨æ¡¶å†…çš„èšåˆ avg_priceï¼šèšåˆçš„åç§° avgï¼šåº¦é‡çš„ç±»åž‹ï¼Œè¿™é‡Œæ˜¯æ±‚å¹³å‡å€¼ fieldï¼šåº¦é‡è¿ç®—çš„å­—æ®µ ç»“æžœï¼š 12345678910111213141516171819202122232425262728293031... "aggregations": &#123; "popular_colors": &#123; "doc_count_error_upper_bound": 0, "sum_other_doc_count": 0, "buckets": [ &#123; "key": "red", "doc_count": 4, "avg_price": &#123; "value": 32500 &#125; &#125;, &#123; "key": "blue", "doc_count": 2, "avg_price": &#123; "value": 20000 &#125; &#125;, &#123; "key": "green", "doc_count": 2, "avg_price": &#123; "value": 21000 &#125; &#125; ] &#125; &#125;... å¯ä»¥çœ‹åˆ°æ¯ä¸ªæ¡¶ä¸­éƒ½æœ‰è‡ªå·±çš„avg_priceå­—æ®µï¼Œè¿™æ˜¯åº¦é‡èšåˆçš„ç»“æžœ 4.4 æ¡¶å†…åµŒå¥—æ¡¶åˆšåˆšçš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨æ¡¶å†…åµŒå¥—åº¦é‡è¿ç®—ã€‚äº‹å®žä¸Šæ¡¶ä¸ä»…å¯ä»¥åµŒå¥—è¿ç®—ï¼Œ è¿˜å¯ä»¥å†åµŒå¥—å…¶å®ƒæ¡¶ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨æ¯ä¸ªåˆ†ç»„ä¸­ï¼Œå†åˆ†æ›´å¤šç»„ã€‚ æ¯”å¦‚ï¼šæˆ‘ä»¬æƒ³ç»Ÿè®¡æ¯ç§é¢œè‰²çš„æ±½è½¦ä¸­ï¼Œåˆ†åˆ«å±žäºŽå“ªä¸ªåˆ¶é€ å•†ï¼ŒæŒ‰ç…§makeå­—æ®µå†è¿›è¡Œåˆ†æ¡¶ 1234567891011121314151617181920212223GET /cars/_search&#123; "size" : 0, "aggs" : &#123; "popular_colors" : &#123; "terms" : &#123; "field" : "color" &#125;, "aggs":&#123; "avg_price": &#123; "avg": &#123; "field": "price" &#125; &#125;, "maker":&#123; "terms":&#123; "field":"make" &#125; &#125; &#125; &#125; &#125;&#125; åŽŸæ¥çš„coloræ¡¶å’Œavgè®¡ç®—æˆ‘ä»¬ä¸å˜ makerï¼šåœ¨åµŒå¥—çš„aggsä¸‹æ–°æ·»ä¸€ä¸ªæ¡¶ï¼Œå«åšmaker termsï¼šæ¡¶çš„åˆ’åˆ†ç±»åž‹ä¾ç„¶æ˜¯è¯æ¡ filedï¼šè¿™é‡Œæ ¹æ®makeå­—æ®µè¿›è¡Œåˆ’åˆ† éƒ¨åˆ†ç»“æžœï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374...&#123;"aggregations": &#123; "popular_colors": &#123; "doc_count_error_upper_bound": 0, "sum_other_doc_count": 0, "buckets": [ &#123; "key": "red", "doc_count": 4, "maker": &#123; "doc_count_error_upper_bound": 0, "sum_other_doc_count": 0, "buckets": [ &#123; "key": "honda", "doc_count": 3 &#125;, &#123; "key": "bmw", "doc_count": 1 &#125; ] &#125;, "avg_price": &#123; "value": 32500 &#125; &#125;, &#123; "key": "blue", "doc_count": 2, "maker": &#123; "doc_count_error_upper_bound": 0, "sum_other_doc_count": 0, "buckets": [ &#123; "key": "ford", "doc_count": 1 &#125;, &#123; "key": "toyota", "doc_count": 1 &#125; ] &#125;, "avg_price": &#123; "value": 20000 &#125; &#125;, &#123; "key": "green", "doc_count": 2, "maker": &#123; "doc_count_error_upper_bound": 0, "sum_other_doc_count": 0, "buckets": [ &#123; "key": "ford", "doc_count": 1 &#125;, &#123; "key": "toyota", "doc_count": 1 &#125; ] &#125;, "avg_price": &#123; "value": 21000 &#125; &#125; ] &#125; &#125;&#125;... æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ–°çš„èšåˆmakerè¢«åµŒå¥—åœ¨åŽŸæ¥æ¯ä¸€ä¸ªcolorçš„æ¡¶ä¸­ã€‚ æ¯ä¸ªé¢œè‰²ä¸‹é¢éƒ½æ ¹æ® makeå­—æ®µè¿›è¡Œäº†åˆ†ç»„ æˆ‘ä»¬èƒ½è¯»å–åˆ°çš„ä¿¡æ¯ï¼š çº¢è‰²è½¦å…±æœ‰4è¾† çº¢è‰²è½¦çš„å¹³å‡å”®ä»·æ˜¯ $32ï¼Œ500 ç¾Žå…ƒã€‚ å…¶ä¸­3è¾†æ˜¯ Honda æœ¬ç”°åˆ¶é€ ï¼Œ1è¾†æ˜¯ BMW å®é©¬åˆ¶é€ ã€‚ 4.5.åˆ’åˆ†æ¡¶çš„å…¶å®ƒæ–¹å¼å‰é¢è®²äº†ï¼Œåˆ’åˆ†æ¡¶çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼š Date Histogram Aggregationï¼šæ ¹æ®æ—¥æœŸé˜¶æ¢¯åˆ†ç»„ï¼Œä¾‹å¦‚ç»™å®šé˜¶æ¢¯ä¸ºå‘¨ï¼Œä¼šè‡ªåŠ¨æ¯å‘¨åˆ†ä¸ºä¸€ç»„ Histogram Aggregationï¼šæ ¹æ®æ•°å€¼é˜¶æ¢¯åˆ†ç»„ï¼Œä¸Žæ—¥æœŸç±»ä¼¼ Terms Aggregationï¼šæ ¹æ®è¯æ¡å†…å®¹åˆ†ç»„ï¼Œè¯æ¡å†…å®¹å®Œå…¨åŒ¹é…çš„ä¸ºä¸€ç»„ Range Aggregationï¼šæ•°å€¼å’Œæ—¥æœŸçš„èŒƒå›´åˆ†ç»„ï¼ŒæŒ‡å®šå¼€å§‹å’Œç»“æŸï¼Œç„¶åŽæŒ‰æ®µåˆ†ç»„ åˆšåˆšçš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯Terms Aggregationï¼Œå³æ ¹æ®è¯æ¡åˆ’åˆ†æ¡¶ã€‚ æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†å­¦ä¹ å‡ ä¸ªæ¯”è¾ƒå®žç”¨çš„ï¼š 4.5.1.é˜¶æ¢¯åˆ†æ¡¶Histogram åŽŸç†ï¼š histogramæ˜¯æŠŠæ•°å€¼ç±»åž‹çš„å­—æ®µï¼ŒæŒ‰ç…§ä¸€å®šçš„é˜¶æ¢¯å¤§å°è¿›è¡Œåˆ†ç»„ã€‚ä½ éœ€è¦æŒ‡å®šä¸€ä¸ªé˜¶æ¢¯å€¼ï¼ˆintervalï¼‰æ¥åˆ’åˆ†é˜¶æ¢¯å¤§å°ã€‚ ä¸¾ä¾‹ï¼š æ¯”å¦‚ä½ æœ‰ä»·æ ¼å­—æ®µï¼Œå¦‚æžœä½ è®¾å®šintervalçš„å€¼ä¸º200ï¼Œé‚£ä¹ˆé˜¶æ¢¯å°±ä¼šæ˜¯è¿™æ ·çš„ï¼š 0ï¼Œ200ï¼Œ400ï¼Œ600ï¼Œâ€¦ ä¸Šé¢åˆ—å‡ºçš„æ˜¯æ¯ä¸ªé˜¶æ¢¯çš„keyï¼Œä¹Ÿæ˜¯åŒºé—´çš„å¯ç‚¹ã€‚ å¦‚æžœä¸€ä»¶å•†å“çš„ä»·æ ¼æ˜¯450ï¼Œä¼šè½å…¥å“ªä¸ªé˜¶æ¢¯åŒºé—´å‘¢ï¼Ÿè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š 1bucket_key = Math.floor((value - offset) / interval) * interval + offset valueï¼šå°±æ˜¯å½“å‰æ•°æ®çš„å€¼ï¼Œæœ¬ä¾‹ä¸­æ˜¯450 offsetï¼šèµ·å§‹åç§»é‡ï¼Œé»˜è®¤ä¸º0 intervalï¼šé˜¶æ¢¯é—´éš”ï¼Œæ¯”å¦‚200 å› æ­¤ä½ å¾—åˆ°çš„key = Math.floor((450 - 0) / 200) * 200 + 0 = 400 æ“ä½œä¸€ä¸‹ï¼š æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯¹æ±½è½¦çš„ä»·æ ¼è¿›è¡Œåˆ†ç»„ï¼ŒæŒ‡å®šé—´éš”intervalä¸º5000ï¼š 123456789101112GET /cars/_search&#123; "size":0, "aggs":&#123; "price":&#123; "histogram": &#123; "field": "price", "interval": 5000 &#125; &#125; &#125;&#125; ç»“æžœï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081&#123; "took": 21, "timed_out": false, "_shards": &#123; "total": 5, "successful": 5, "skipped": 0, "failed": 0 &#125;, "hits": &#123; "total": 8, "max_score": 0, "hits": [] &#125;, "aggregations": &#123; "price": &#123; "buckets": [ &#123; "key": 10000, "doc_count": 2 &#125;, &#123; "key": 15000, "doc_count": 1 &#125;, &#123; "key": 20000, "doc_count": 2 &#125;, &#123; "key": 25000, "doc_count": 1 &#125;, &#123; "key": 30000, "doc_count": 1 &#125;, &#123; "key": 35000, "doc_count": 0 &#125;, &#123; "key": 40000, "doc_count": 0 &#125;, &#123; "key": 45000, "doc_count": 0 &#125;, &#123; "key": 50000, "doc_count": 0 &#125;, &#123; "key": 55000, "doc_count": 0 &#125;, &#123; "key": 60000, "doc_count": 0 &#125;, &#123; "key": 65000, "doc_count": 0 &#125;, &#123; "key": 70000, "doc_count": 0 &#125;, &#123; "key": 75000, "doc_count": 0 &#125;, &#123; "key": 80000, "doc_count": 1 &#125; ] &#125; &#125;&#125; ä½ ä¼šå‘çŽ°ï¼Œä¸­é—´æœ‰å¤§é‡çš„æ–‡æ¡£æ•°é‡ä¸º0 çš„æ¡¶ï¼Œçœ‹èµ·æ¥å¾ˆä¸‘ã€‚ æˆ‘ä»¬å¯ä»¥å¢žåŠ ä¸€ä¸ªå‚æ•°min_doc_countä¸º1ï¼Œæ¥çº¦æŸæœ€å°‘æ–‡æ¡£æ•°é‡ä¸º1ï¼Œè¿™æ ·æ–‡æ¡£æ•°é‡ä¸º0çš„æ¡¶ä¼šè¢«è¿‡æ»¤ ç¤ºä¾‹ï¼š 12345678910111213GET /cars/_search&#123; "size":0, "aggs":&#123; "price":&#123; "histogram": &#123; "field": "price", "interval": 5000, "min_doc_count": 1 &#125; &#125; &#125;&#125; ç»“æžœï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445&#123; "took": 15, "timed_out": false, "_shards": &#123; "total": 5, "successful": 5, "skipped": 0, "failed": 0 &#125;, "hits": &#123; "total": 8, "max_score": 0, "hits": [] &#125;, "aggregations": &#123; "price": &#123; "buckets": [ &#123; "key": 10000, "doc_count": 2 &#125;, &#123; "key": 15000, "doc_count": 1 &#125;, &#123; "key": 20000, "doc_count": 2 &#125;, &#123; "key": 25000, "doc_count": 1 &#125;, &#123; "key": 30000, "doc_count": 1 &#125;, &#123; "key": 80000, "doc_count": 1 &#125; ] &#125; &#125;&#125; å®Œç¾Žï¼Œï¼ å¦‚æžœä½ ç”¨kibanaå°†ç»“æžœå˜ä¸ºæŸ±å½¢å›¾ï¼Œä¼šæ›´å¥½çœ‹ï¼š 4.5.2.èŒƒå›´åˆ†æ¡¶rangeèŒƒå›´åˆ†æ¡¶ä¸Žé˜¶æ¢¯åˆ†æ¡¶ç±»ä¼¼ï¼Œä¹Ÿæ˜¯æŠŠæ•°å­—æŒ‰ç…§é˜¶æ®µè¿›è¡Œåˆ†ç»„ï¼Œåªä¸è¿‡rangeæ–¹å¼éœ€è¦ä½ è‡ªå·±æŒ‡å®šæ¯ä¸€ç»„çš„èµ·å§‹å’Œç»“æŸå¤§å°ã€‚ 5.Spring Data ElasticsearchElasticsearchæä¾›çš„Javaå®¢æˆ·ç«¯æœ‰ä¸€äº›ä¸å¤ªæ–¹ä¾¿çš„åœ°æ–¹ï¼š å¾ˆå¤šåœ°æ–¹éœ€è¦æ‹¼æŽ¥Jsonå­—ç¬¦ä¸²ï¼Œåœ¨javaä¸­æ‹¼æŽ¥å­—ç¬¦ä¸²æœ‰å¤šææ€–ä½ åº”è¯¥æ‡‚çš„ éœ€è¦è‡ªå·±æŠŠå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå­˜å‚¨ æŸ¥è¯¢åˆ°ç»“æžœä¹Ÿéœ€è¦è‡ªå·±ååºåˆ—åŒ–ä¸ºå¯¹è±¡ å› æ­¤ï¼Œæˆ‘ä»¬è¿™é‡Œå°±ä¸è®²è§£åŽŸç”Ÿçš„Elasticsearchå®¢æˆ·ç«¯APIäº†ã€‚ è€Œæ˜¯å­¦ä¹ Springæä¾›çš„å¥—ä»¶ï¼šSpring Data Elasticsearchã€‚ 5.1.ç®€ä»‹Spring Data Elasticsearchæ˜¯Spring Dataé¡¹ç›®ä¸‹çš„ä¸€ä¸ªå­æ¨¡å—ã€‚ æŸ¥çœ‹ Spring Dataçš„å®˜ç½‘ï¼šhttp://projects.spring.io/spring-data/ Spring Dataçš„ä½¿å‘½æ˜¯ä¸ºæ•°æ®è®¿é—®æä¾›ç†Ÿæ‚‰ä¸”ä¸€è‡´çš„åŸºäºŽSpringçš„ç¼–ç¨‹æ¨¡åž‹ï¼ŒåŒæ—¶ä»ä¿ç•™åº•å±‚æ•°æ®å­˜å‚¨çš„ç‰¹æ®Šç‰¹æ€§ã€‚ å®ƒä½¿å¾—ä½¿ç”¨æ•°æ®è®¿é—®æŠ€æœ¯ï¼Œå…³ç³»æ•°æ®åº“å’Œéžå…³ç³»æ•°æ®åº“ï¼Œmap-reduceæ¡†æž¶å’ŒåŸºäºŽäº‘çš„æ•°æ®æœåŠ¡å˜å¾—å®¹æ˜“ã€‚è¿™æ˜¯ä¸€ä¸ªæ€»æ‹¬é¡¹ç›®ï¼Œå…¶ä¸­åŒ…å«è®¸å¤šç‰¹å®šäºŽç»™å®šæ•°æ®åº“çš„å­é¡¹ç›®ã€‚è¿™äº›ä»¤äººå…´å¥‹çš„æŠ€æœ¯é¡¹ç›®èƒŒåŽï¼Œæ˜¯ç”±è®¸å¤šå…¬å¸å’Œå¼€å‘äººå‘˜åˆä½œå¼€å‘çš„ã€‚ Spring Data çš„ä½¿å‘½æ˜¯ç»™å„ç§æ•°æ®è®¿é—®æä¾›ç»Ÿä¸€çš„ç¼–ç¨‹æŽ¥å£ï¼Œä¸ç®¡æ˜¯å…³ç³»åž‹æ•°æ®åº“ï¼ˆå¦‚MySQLï¼‰ï¼Œè¿˜æ˜¯éžå…³ç³»æ•°æ®åº“ï¼ˆå¦‚Redisï¼‰ï¼Œæˆ–è€…ç±»ä¼¼Elasticsearchè¿™æ ·çš„ç´¢å¼•æ•°æ®åº“ã€‚ä»Žè€Œç®€åŒ–å¼€å‘äººå‘˜çš„ä»£ç ï¼Œæé«˜å¼€å‘æ•ˆçŽ‡ã€‚ åŒ…å«å¾ˆå¤šä¸åŒæ•°æ®æ“ä½œçš„æ¨¡å—ï¼š Spring Data Elasticsearchçš„é¡µé¢ï¼šhttps://projects.spring.io/spring-data-elasticsearch/ ç‰¹å¾ï¼š æ”¯æŒSpringçš„åŸºäºŽ@Configurationçš„javaé…ç½®æ–¹å¼ï¼Œæˆ–è€…XMLé…ç½®æ–¹å¼ æä¾›äº†ç”¨äºŽæ“ä½œESçš„ä¾¿æ·å·¥å…·ç±»ElasticsearchTemplateã€‚åŒ…æ‹¬å®žçŽ°æ–‡æ¡£åˆ°POJOä¹‹é—´çš„è‡ªåŠ¨æ™ºèƒ½æ˜ å°„ã€‚ åˆ©ç”¨Springçš„æ•°æ®è½¬æ¢æœåŠ¡å®žçŽ°çš„åŠŸèƒ½ä¸°å¯Œçš„å¯¹è±¡æ˜ å°„ åŸºäºŽæ³¨è§£çš„å…ƒæ•°æ®æ˜ å°„æ–¹å¼ï¼Œè€Œä¸”å¯æ‰©å±•ä»¥æ”¯æŒæ›´å¤šä¸åŒçš„æ•°æ®æ ¼å¼ æ ¹æ®æŒä¹…å±‚æŽ¥å£è‡ªåŠ¨ç”Ÿæˆå¯¹åº”å®žçŽ°æ–¹æ³•ï¼Œæ— éœ€äººå·¥ç¼–å†™åŸºæœ¬æ“ä½œä»£ç ï¼ˆç±»ä¼¼mybatisï¼Œæ ¹æ®æŽ¥å£è‡ªåŠ¨å¾—åˆ°å®žçŽ°ï¼‰ã€‚å½“ç„¶ï¼Œä¹Ÿæ”¯æŒäººå·¥å®šåˆ¶æŸ¥è¯¢ 5.2.åˆ›å»ºDemoå·¥ç¨‹æˆ‘ä»¬æ–°å»ºä¸€ä¸ªdemoï¼Œå­¦ä¹ Elasticsearch pomä¾èµ–ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.leyou.demo&lt;/groupId&gt; &lt;artifactId&gt;elasticsearch&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;name&gt;elasticsearch&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.2.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; application.ymlæ–‡ä»¶é…ç½®ï¼š 12345spring: data: elasticsearch: cluster-name: elasticsearch cluster-nodes: 192.168.56.101:9300 5.3.å®žä½“ç±»åŠæ³¨è§£é¦–å…ˆæˆ‘ä»¬å‡†å¤‡å¥½å®žä½“ç±»ï¼š 12345678public class Item &#123; Long id; String title; //æ ‡é¢˜ String category;// åˆ†ç±» String brand; // å“ç‰Œ Double price; // ä»·æ ¼ String images; // å›¾ç‰‡åœ°å€&#125; æ˜ å°„ Spring Dataé€šè¿‡æ³¨è§£æ¥å£°æ˜Žå­—æ®µçš„æ˜ å°„å±žæ€§ï¼Œæœ‰ä¸‹é¢çš„ä¸‰ä¸ªæ³¨è§£ï¼š @Document ä½œç”¨åœ¨ç±»ï¼Œæ ‡è®°å®žä½“ç±»ä¸ºæ–‡æ¡£å¯¹è±¡ï¼Œä¸€èˆ¬æœ‰ä¸¤ä¸ªå±žæ€§ indexNameï¼šå¯¹åº”ç´¢å¼•åº“åç§° typeï¼šå¯¹åº”åœ¨ç´¢å¼•åº“ä¸­çš„ç±»åž‹ shardsï¼šåˆ†ç‰‡æ•°é‡ï¼Œé»˜è®¤5 replicasï¼šå‰¯æœ¬æ•°é‡ï¼Œé»˜è®¤1 @Id ä½œç”¨åœ¨æˆå‘˜å˜é‡ï¼Œæ ‡è®°ä¸€ä¸ªå­—æ®µä½œä¸ºidä¸»é”® @Field ä½œç”¨åœ¨æˆå‘˜å˜é‡ï¼Œæ ‡è®°ä¸ºæ–‡æ¡£çš„å­—æ®µï¼Œå¹¶æŒ‡å®šå­—æ®µæ˜ å°„å±žæ€§ï¼š typeï¼šå­—æ®µç±»åž‹ï¼Œå–å€¼æ˜¯æžšä¸¾ï¼šFieldType indexï¼šæ˜¯å¦ç´¢å¼•ï¼Œå¸ƒå°”ç±»åž‹ï¼Œé»˜è®¤æ˜¯true storeï¼šæ˜¯å¦å­˜å‚¨ï¼Œå¸ƒå°”ç±»åž‹ï¼Œé»˜è®¤æ˜¯false analyzerï¼šåˆ†è¯å™¨åç§° ç¤ºä¾‹ï¼š 1234567891011121314151617181920@Document(indexName = "item",type = "docs", shards = 1, replicas = 0)public class Item &#123; @Id private Long id; @Field(type = FieldType.Text, analyzer = "ik_max_word") private String title; //æ ‡é¢˜ @Field(type = FieldType.Keyword) private String category;// åˆ†ç±» @Field(type = FieldType.Keyword) private String brand; // å“ç‰Œ @Field(type = FieldType.Double) private Double price; // ä»·æ ¼ @Field(index = false, type = FieldType.Keyword) private String images; // å›¾ç‰‡åœ°å€&#125; 5.4.Templateç´¢å¼•æ“ä½œ5.4.1.åˆ›å»ºç´¢å¼•å’Œæ˜ å°„ åˆ›å»ºç´¢å¼• ElasticsearchTemplateä¸­æä¾›äº†åˆ›å»ºç´¢å¼•çš„APIï¼š å¯ä»¥æ ¹æ®ç±»çš„ä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šindexNameå’ŒSettings æ˜ å°„ æ˜ å°„ç›¸å…³çš„APIï¼š å¯ä»¥æ ¹æ®ç±»çš„å­—èŠ‚ç ä¿¡æ¯ï¼ˆæ³¨è§£é…ç½®ï¼‰æ¥ç”Ÿæˆæ˜ å°„ï¼Œæˆ–è€…æ‰‹åŠ¨ç¼–å†™æ˜ å°„ æˆ‘ä»¬è¿™é‡Œé‡‡ç”¨ç±»çš„å­—èŠ‚ç ä¿¡æ¯åˆ›å»ºç´¢å¼•å¹¶æ˜ å°„ï¼š 123456789101112131415@RunWith(SpringRunner.class)@SpringBootTest(classes = ItcastElasticsearchApplication.class)public class IndexTest &#123; @Autowired private ElasticsearchTemplate elasticsearchTemplate; @Test public void testCreate()&#123; // åˆ›å»ºç´¢å¼•ï¼Œä¼šæ ¹æ®Itemç±»çš„@Documentæ³¨è§£ä¿¡æ¯æ¥åˆ›å»º elasticsearchTemplate.createIndex(Item.class); // é…ç½®æ˜ å°„ï¼Œä¼šæ ¹æ®Itemç±»ä¸­çš„idã€Fieldç­‰å­—æ®µæ¥è‡ªåŠ¨å®Œæˆæ˜ å°„ elasticsearchTemplate.putMapping(Item.class); &#125;&#125; ç»“æžœï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445GET /item&#123; "item": &#123; "aliases": &#123;&#125;, "mappings": &#123; "docs": &#123; "properties": &#123; "brand": &#123; "type": "keyword" &#125;, "category": &#123; "type": "keyword" &#125;, "images": &#123; "type": "keyword", "index": false &#125;, "price": &#123; "type": "double" &#125;, "title": &#123; "type": "text", "analyzer": "ik_max_word" &#125; &#125; &#125; &#125;, "settings": &#123; "index": &#123; "refresh_interval": "1s", "number_of_shards": "1", "provided_name": "item", "creation_date": "1525405022589", "store": &#123; "type": "fs" &#125;, "number_of_replicas": "0", "uuid": "4sE9SAw3Sqq1aAPz5F6OEg", "version": &#123; "created": "6020499" &#125; &#125; &#125; &#125;&#125; 5.3.2.åˆ é™¤ç´¢å¼•åˆ é™¤ç´¢å¼•çš„APIï¼š å¯ä»¥æ ¹æ®ç±»åæˆ–ç´¢å¼•ååˆ é™¤ã€‚ ç¤ºä¾‹ï¼š 1234@Testpublic void deleteIndex() &#123; esTemplate.deleteIndex("heima");&#125; ç»“æžœï¼š 5.4.Repositoryæ–‡æ¡£æ“ä½œSpring Data çš„å¼ºå¤§ä¹‹å¤„ï¼Œå°±åœ¨äºŽä½ ä¸ç”¨å†™ä»»ä½•DAOå¤„ç†ï¼Œè‡ªåŠ¨æ ¹æ®æ–¹æ³•åæˆ–ç±»çš„ä¿¡æ¯è¿›è¡ŒCRUDæ“ä½œã€‚åªè¦ä½ å®šä¹‰ä¸€ä¸ªæŽ¥å£ï¼Œç„¶åŽç»§æ‰¿Repositoryæä¾›çš„ä¸€äº›å­æŽ¥å£ï¼Œå°±èƒ½å…·å¤‡å„ç§åŸºæœ¬çš„CRUDåŠŸèƒ½ã€‚ æˆ‘ä»¬åªéœ€è¦å®šä¹‰æŽ¥å£ï¼Œç„¶åŽç»§æ‰¿å®ƒå°±OKäº†ã€‚ 12public interface ItemRepository extends ElasticsearchRepository&lt;Item,Long&gt; &#123;&#125; æ¥çœ‹ä¸‹Repositoryçš„ç»§æ‰¿å…³ç³»ï¼š æˆ‘ä»¬çœ‹åˆ°æœ‰ä¸€ä¸ªElasticsearchRepositoryæŽ¥å£ï¼š 5.4.1.æ–°å¢žæ–‡æ¡£123456789@Autowiredprivate ItemRepository itemRepository;@Testpublic void index() &#123; Item item = new Item(1L, "å°ç±³æ‰‹æœº7", " æ‰‹æœº", "å°ç±³", 3499.00, "http://image.leyou.com/13123.jpg"); itemRepository.save(item);&#125; åŽ»é¡µé¢æŸ¥è¯¢çœ‹çœ‹ï¼š 1GET /item/_search ç»“æžœï¼š 123456789101112131415161718192021222324252627282930&#123; "took": 14, "timed_out": false, "_shards": &#123; "total": 1, "successful": 1, "skipped": 0, "failed": 0 &#125;, "hits": &#123; "total": 1, "max_score": 1, "hits": [ &#123; "_index": "item", "_type": "docs", "_id": "1", "_score": 1, "_source": &#123; "id": 1, "title": "å°ç±³æ‰‹æœº7", "category": " æ‰‹æœº", "brand": "å°ç±³", "price": 3499, "images": "http://image.leyou.com/13123.jpg" &#125; &#125; ] &#125;&#125; 5.4.2.æ‰¹é‡æ–°å¢žä»£ç ï¼š 12345678@Testpublic void indexList() &#123; List&lt;Item&gt; list = new ArrayList&lt;&gt;(); list.add(new Item(2L, "åšæžœæ‰‹æœºR1", " æ‰‹æœº", "é”¤å­", 3699.00, "http://image.leyou.com/123.jpg")); list.add(new Item(3L, "åŽä¸ºMETA10", " æ‰‹æœº", "åŽä¸º", 4499.00, "http://image.leyou.com/3.jpg")); // æŽ¥æ”¶å¯¹è±¡é›†åˆï¼Œå®žçŽ°æ‰¹é‡æ–°å¢ž itemRepository.saveAll(list);&#125; å†æ¬¡åŽ»é¡µé¢æŸ¥è¯¢ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758&#123; "took": 5, "timed_out": false, "_shards": &#123; "total": 1, "successful": 1, "skipped": 0, "failed": 0 &#125;, "hits": &#123; "total": 3, "max_score": 1, "hits": [ &#123; "_index": "item", "_type": "docs", "_id": "2", "_score": 1, "_source": &#123; "id": 2, "title": "åšæžœæ‰‹æœºR1", "category": " æ‰‹æœº", "brand": "é”¤å­", "price": 3699, "images": "http://image.leyou.com/13123.jpg" &#125; &#125;, &#123; "_index": "item", "_type": "docs", "_id": "3", "_score": 1, "_source": &#123; "id": 3, "title": "åŽä¸ºMETA10", "category": " æ‰‹æœº", "brand": "åŽä¸º", "price": 4499, "images": "http://image.leyou.com/13123.jpg" &#125; &#125;, &#123; "_index": "item", "_type": "docs", "_id": "1", "_score": 1, "_source": &#123; "id": 1, "title": "å°ç±³æ‰‹æœº7", "category": " æ‰‹æœº", "brand": "å°ç±³", "price": 3499, "images": "http://image.leyou.com/13123.jpg" &#125; &#125; ] &#125;&#125; 5.4.3.ä¿®æ”¹æ–‡æ¡£ä¿®æ”¹å’Œæ–°å¢žæ˜¯åŒä¸€ä¸ªæŽ¥å£ï¼ŒåŒºåˆ†çš„ä¾æ®å°±æ˜¯idï¼Œè¿™ä¸€ç‚¹è·Ÿæˆ‘ä»¬åœ¨é¡µé¢å‘èµ·PUTè¯·æ±‚æ˜¯ç±»ä¼¼çš„ã€‚ 5.4.4.åŸºæœ¬æŸ¥è¯¢ElasticsearchRepositoryæä¾›äº†ä¸€äº›åŸºæœ¬çš„æŸ¥è¯¢æ–¹æ³•ï¼š æˆ‘ä»¬æ¥è¯•è¯•æŸ¥è¯¢æ‰€æœ‰ï¼š 123456@Testpublic void testFind()&#123; // æŸ¥è¯¢å…¨éƒ¨ï¼Œå¹¶å®‰è£…ä»·æ ¼é™åºæŽ’åº Iterable&lt;Item&gt; items = this.itemRepository.findAll(Sort.by(Sort.Direction.DESC, "price")); items.forEach(item-&gt; System.out.println(item));&#125; ç»“æžœï¼š 5.4.5.è‡ªå®šä¹‰æ–¹æ³•Spring Data çš„å¦ä¸€ä¸ªå¼ºå¤§åŠŸèƒ½ï¼Œæ˜¯æ ¹æ®æ–¹æ³•åç§°è‡ªåŠ¨å®žçŽ°åŠŸèƒ½ã€‚ æ¯”å¦‚ï¼šä½ çš„æ–¹æ³•åå«åšï¼šfindByTitleï¼Œé‚£ä¹ˆå®ƒå°±çŸ¥é“ä½ æ˜¯æ ¹æ®titleæŸ¥è¯¢ï¼Œç„¶åŽè‡ªåŠ¨å¸®ä½ å®Œæˆï¼Œæ— éœ€å†™å®žçŽ°ç±»ã€‚ å½“ç„¶ï¼Œæ–¹æ³•åç§°è¦ç¬¦åˆä¸€å®šçš„çº¦å®šï¼š Keyword Sample Elasticsearch Query String And findByNameAndPrice {&quot;bool&quot; : {&quot;must&quot; : [ {&quot;field&quot; : {&quot;name&quot; : &quot;?&quot;}}, {&quot;field&quot; : {&quot;price&quot; : &quot;?&quot;}} ]}} Or findByNameOrPrice {&quot;bool&quot; : {&quot;should&quot; : [ {&quot;field&quot; : {&quot;name&quot; : &quot;?&quot;}}, {&quot;field&quot; : {&quot;price&quot; : &quot;?&quot;}} ]}} Is findByName {&quot;bool&quot; : {&quot;must&quot; : {&quot;field&quot; : {&quot;name&quot; : &quot;?&quot;}}}} Not findByNameNot {&quot;bool&quot; : {&quot;must_not&quot; : {&quot;field&quot; : {&quot;name&quot; : &quot;?&quot;}}}} Between findByPriceBetween {&quot;bool&quot; : {&quot;must&quot; : {&quot;range&quot; : {&quot;price&quot; : {&quot;from&quot; : ?,&quot;to&quot; : ?,&quot;include_lower&quot; : true,&quot;include_upper&quot; : true}}}}} LessThanEqual findByPriceLessThan {&quot;bool&quot; : {&quot;must&quot; : {&quot;range&quot; : {&quot;price&quot; : {&quot;from&quot; : null,&quot;to&quot; : ?,&quot;include_lower&quot; : true,&quot;include_upper&quot; : true}}}}} GreaterThanEqual findByPriceGreaterThan {&quot;bool&quot; : {&quot;must&quot; : {&quot;range&quot; : {&quot;price&quot; : {&quot;from&quot; : ?,&quot;to&quot; : null,&quot;include_lower&quot; : true,&quot;include_upper&quot; : true}}}}} Before findByPriceBefore {&quot;bool&quot; : {&quot;must&quot; : {&quot;range&quot; : {&quot;price&quot; : {&quot;from&quot; : null,&quot;to&quot; : ?,&quot;include_lower&quot; : true,&quot;include_upper&quot; : true}}}}} After findByPriceAfter {&quot;bool&quot; : {&quot;must&quot; : {&quot;range&quot; : {&quot;price&quot; : {&quot;from&quot; : ?,&quot;to&quot; : null,&quot;include_lower&quot; : true,&quot;include_upper&quot; : true}}}}} Like findByNameLike {&quot;bool&quot; : {&quot;must&quot; : {&quot;field&quot; : {&quot;name&quot; : {&quot;query&quot; : &quot;?*&quot;,&quot;analyze_wildcard&quot; : true}}}}} StartingWith findByNameStartingWith {&quot;bool&quot; : {&quot;must&quot; : {&quot;field&quot; : {&quot;name&quot; : {&quot;query&quot; : &quot;?*&quot;,&quot;analyze_wildcard&quot; : true}}}}} EndingWith findByNameEndingWith {&quot;bool&quot; : {&quot;must&quot; : {&quot;field&quot; : {&quot;name&quot; : {&quot;query&quot; : &quot;*?&quot;,&quot;analyze_wildcard&quot; : true}}}}} Contains/Containing findByNameContaining {&quot;bool&quot; : {&quot;must&quot; : {&quot;field&quot; : {&quot;name&quot; : {&quot;query&quot; : &quot;**?**&quot;,&quot;analyze_wildcard&quot; : true}}}}} In findByNameIn(Collection&lt;String&gt;names) {&quot;bool&quot; : {&quot;must&quot; : {&quot;bool&quot; : {&quot;should&quot; : [ {&quot;field&quot; : {&quot;name&quot; : &quot;?&quot;}}, {&quot;field&quot; : {&quot;name&quot; : &quot;?&quot;}} ]}}}} NotIn findByNameNotIn(Collection&lt;String&gt;names) {&quot;bool&quot; : {&quot;must_not&quot; : {&quot;bool&quot; : {&quot;should&quot; : {&quot;field&quot; : {&quot;name&quot; : &quot;?&quot;}}}}}} Near findByStoreNear Not Supported Yet ! True findByAvailableTrue {&quot;bool&quot; : {&quot;must&quot; : {&quot;field&quot; : {&quot;available&quot; : true}}}} False findByAvailableFalse {&quot;bool&quot; : {&quot;must&quot; : {&quot;field&quot; : {&quot;available&quot; : false}}}} OrderBy findByAvailableTrueOrderByNameDesc {&quot;sort&quot; : [{ &quot;name&quot; : {&quot;order&quot; : &quot;desc&quot;} }],&quot;bool&quot; : {&quot;must&quot; : {&quot;field&quot; : {&quot;available&quot; : true}}}} ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ¥æŒ‰ç…§ä»·æ ¼åŒºé—´æŸ¥è¯¢ï¼Œå®šä¹‰è¿™æ ·çš„ä¸€ä¸ªæ–¹æ³•ï¼š 12345678910public interface ItemRepository extends ElasticsearchRepository&lt;Item,Long&gt; &#123; /** * æ ¹æ®ä»·æ ¼åŒºé—´æŸ¥è¯¢ * @param price1 * @param price2 * @return */ List&lt;Item&gt; findByPriceBetween(double price1, double price2);&#125; ç„¶åŽæ·»åŠ ä¸€äº›æµ‹è¯•æ•°æ®ï¼š 1234567891011@Testpublic void indexList() &#123; List&lt;Item&gt; list = new ArrayList&lt;&gt;(); list.add(new Item(1L, "å°ç±³æ‰‹æœº7", "æ‰‹æœº", "å°ç±³", 3299.00, "http://image.leyou.com/13123.jpg")); list.add(new Item(2L, "åšæžœæ‰‹æœºR1", "æ‰‹æœº", "é”¤å­", 3699.00, "http://image.leyou.com/13123.jpg")); list.add(new Item(3L, "åŽä¸ºMETA10", "æ‰‹æœº", "åŽä¸º", 4499.00, "http://image.leyou.com/13123.jpg")); list.add(new Item(4L, "å°ç±³Mix2S", "æ‰‹æœº", "å°ç±³", 4299.00, "http://image.leyou.com/13123.jpg")); list.add(new Item(5L, "è£è€€V10", "æ‰‹æœº", "åŽä¸º", 2799.00, "http://image.leyou.com/13123.jpg")); // æŽ¥æ”¶å¯¹è±¡é›†åˆï¼Œå®žçŽ°æ‰¹é‡æ–°å¢ž itemRepository.saveAll(list);&#125; ä¸éœ€è¦å†™å®žçŽ°ç±»ï¼Œç„¶åŽæˆ‘ä»¬ç›´æŽ¥åŽ»è¿è¡Œï¼š 1234567@Testpublic void queryByPriceBetween()&#123; List&lt;Item&gt; list = this.itemRepository.findByPriceBetween(2000.00, 3500.00); for (Item item : list) &#123; System.out.println("item = " + item); &#125;&#125; ç»“æžœï¼š è™½ç„¶åŸºæœ¬æŸ¥è¯¢å’Œè‡ªå®šä¹‰æ–¹æ³•å·²ç»å¾ˆå¼ºå¤§äº†ï¼Œä½†æ˜¯å¦‚æžœæ˜¯å¤æ‚æŸ¥è¯¢ï¼ˆæ¨¡ç³Šã€é€šé…ç¬¦ã€è¯æ¡æŸ¥è¯¢ç­‰ï¼‰å°±æ˜¾å¾—åŠ›ä¸ä»Žå¿ƒäº†ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨åŽŸç”ŸæŸ¥è¯¢ã€‚ 5.5.é«˜çº§æŸ¥è¯¢5.5.1.åŸºæœ¬æŸ¥è¯¢å…ˆçœ‹çœ‹åŸºæœ¬çŽ©æ³• 12345678@Testpublic void testQuery()&#123; // è¯æ¡æŸ¥è¯¢ MatchQueryBuilder queryBuilder = QueryBuilders.matchQuery("title", "å°ç±³"); // æ‰§è¡ŒæŸ¥è¯¢ Iterable&lt;Item&gt; items = this.itemRepository.search(queryBuilder); items.forEach(System.out::println);&#125; Repositoryçš„searchæ–¹æ³•éœ€è¦QueryBuilderå‚æ•°ï¼ŒelasticSearchä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¯¹è±¡QueryBuildersï¼š QueryBuildersæä¾›äº†å¤§é‡çš„é™æ€æ–¹æ³•ï¼Œç”¨äºŽç”Ÿæˆå„ç§ä¸åŒç±»åž‹çš„æŸ¥è¯¢å¯¹è±¡ï¼Œä¾‹å¦‚ï¼šè¯æ¡ã€æ¨¡ç³Šã€é€šé…ç¬¦ç­‰QueryBuilderå¯¹è±¡ã€‚ ç»“æžœï¼š elasticsearchæä¾›å¾ˆå¤šå¯ç”¨çš„æŸ¥è¯¢æ–¹å¼ï¼Œä½†æ˜¯ä¸å¤Ÿçµæ´»ã€‚å¦‚æžœæƒ³çŽ©è¿‡æ»¤æˆ–è€…èšåˆæŸ¥è¯¢ç­‰å°±å¾ˆéš¾äº†ã€‚ 5.5.2.è‡ªå®šä¹‰æŸ¥è¯¢å…ˆæ¥çœ‹æœ€åŸºæœ¬çš„match queryï¼š 1234567891011121314@Testpublic void testNativeQuery()&#123; // æž„å»ºæŸ¥è¯¢æ¡ä»¶ NativeSearchQueryBuilder queryBuilder = new NativeSearchQueryBuilder(); // æ·»åŠ åŸºæœ¬çš„åˆ†è¯æŸ¥è¯¢ queryBuilder.withQuery(QueryBuilders.matchQuery("title", "å°ç±³")); // æ‰§è¡Œæœç´¢ï¼ŒèŽ·å–ç»“æžœ Page&lt;Item&gt; items = this.itemRepository.search(queryBuilder.build()); // æ‰“å°æ€»æ¡æ•° System.out.println(items.getTotalElements()); // æ‰“å°æ€»é¡µæ•° System.out.println(items.getTotalPages()); items.forEach(System.out::println);&#125; NativeSearchQueryBuilderï¼šSpringæä¾›çš„ä¸€ä¸ªæŸ¥è¯¢æ¡ä»¶æž„å»ºå™¨ï¼Œå¸®åŠ©æž„å»ºjsonæ ¼å¼çš„è¯·æ±‚ä½“ Page&lt;item&gt;ï¼šé»˜è®¤æ˜¯åˆ†é¡µæŸ¥è¯¢ï¼Œå› æ­¤è¿”å›žçš„æ˜¯ä¸€ä¸ªåˆ†é¡µçš„ç»“æžœå¯¹è±¡ï¼ŒåŒ…å«å±žæ€§ï¼š totalElementsï¼šæ€»æ¡æ•° totalPagesï¼šæ€»é¡µæ•° Iteratorï¼šè¿­ä»£å™¨ï¼Œæœ¬èº«å®žçŽ°äº†IteratoræŽ¥å£ï¼Œå› æ­¤å¯ç›´æŽ¥è¿­ä»£å¾—åˆ°å½“å‰é¡µçš„æ•°æ® å…¶å®ƒå±žæ€§ï¼š ç»“æžœï¼š 5.5.4.åˆ†é¡µæŸ¥è¯¢åˆ©ç”¨NativeSearchQueryBuilderå¯ä»¥æ–¹ä¾¿çš„å®žçŽ°åˆ†é¡µï¼š 12345678910111213141516171819202122232425@Testpublic void testNativeQuery()&#123; // æž„å»ºæŸ¥è¯¢æ¡ä»¶ NativeSearchQueryBuilder queryBuilder = new NativeSearchQueryBuilder(); // æ·»åŠ åŸºæœ¬çš„åˆ†è¯æŸ¥è¯¢ queryBuilder.withQuery(QueryBuilders.termQuery("category", "æ‰‹æœº")); // åˆå§‹åŒ–åˆ†é¡µå‚æ•° int page = 0; int size = 3; // è®¾ç½®åˆ†é¡µå‚æ•° queryBuilder.withPageable(PageRequest.of(page, size)); // æ‰§è¡Œæœç´¢ï¼ŒèŽ·å–ç»“æžœ Page&lt;Item&gt; items = this.itemRepository.search(queryBuilder.build()); // æ‰“å°æ€»æ¡æ•° System.out.println(items.getTotalElements()); // æ‰“å°æ€»é¡µæ•° System.out.println(items.getTotalPages()); // æ¯é¡µå¤§å° System.out.println(items.getSize()); // å½“å‰é¡µ System.out.println(items.getNumber()); items.forEach(System.out::println);&#125; ç»“æžœï¼š å¯ä»¥å‘çŽ°ï¼ŒElasticsearchä¸­çš„åˆ†é¡µæ˜¯ä»Žç¬¬0é¡µå¼€å§‹ã€‚ 5.5.5.æŽ’åºæŽ’åºä¹Ÿé€šç”¨é€šè¿‡NativeSearchQueryBuilderå®Œæˆï¼š 12345678910111213141516@Testpublic void testSort()&#123; // æž„å»ºæŸ¥è¯¢æ¡ä»¶ NativeSearchQueryBuilder queryBuilder = new NativeSearchQueryBuilder(); // æ·»åŠ åŸºæœ¬çš„åˆ†è¯æŸ¥è¯¢ queryBuilder.withQuery(QueryBuilders.termQuery("category", "æ‰‹æœº")); // æŽ’åº queryBuilder.withSort(SortBuilders.fieldSort("price").order(SortOrder.DESC)); // æ‰§è¡Œæœç´¢ï¼ŒèŽ·å–ç»“æžœ Page&lt;Item&gt; items = this.itemRepository.search(queryBuilder.build()); // æ‰“å°æ€»æ¡æ•° System.out.println(items.getTotalElements()); items.forEach(System.out::println);&#125; ç»“æžœï¼š 5.6.èšåˆ5.6.1.èšåˆä¸ºæ¡¶æ¡¶å°±æ˜¯åˆ†ç»„ï¼Œæ¯”å¦‚è¿™é‡Œæˆ‘ä»¬æŒ‰ç…§å“ç‰Œbrandè¿›è¡Œåˆ†ç»„ï¼š 12345678910111213141516171819202122232425@Testpublic void testAgg()&#123; NativeSearchQueryBuilder queryBuilder = new NativeSearchQueryBuilder(); // ä¸æŸ¥è¯¢ä»»ä½•ç»“æžœ queryBuilder.withSourceFilter(new FetchSourceFilter(new String[]&#123;""&#125;, null)); // 1ã€æ·»åŠ ä¸€ä¸ªæ–°çš„èšåˆï¼Œèšåˆç±»åž‹ä¸ºtermsï¼Œèšåˆåç§°ä¸ºbrandsï¼Œèšåˆå­—æ®µä¸ºbrand queryBuilder.addAggregation( AggregationBuilders.terms("brands").field("brand")); // 2ã€æŸ¥è¯¢,éœ€è¦æŠŠç»“æžœå¼ºè½¬ä¸ºAggregatedPageç±»åž‹ AggregatedPage&lt;Item&gt; aggPage = (AggregatedPage&lt;Item&gt;) this.itemRepository.search(queryBuilder.build()); // 3ã€è§£æž // 3.1ã€ä»Žç»“æžœä¸­å–å‡ºåä¸ºbrandsçš„é‚£ä¸ªèšåˆï¼Œ // å› ä¸ºæ˜¯åˆ©ç”¨Stringç±»åž‹å­—æ®µæ¥è¿›è¡Œçš„termèšåˆï¼Œæ‰€ä»¥ç»“æžœè¦å¼ºè½¬ä¸ºStringTermç±»åž‹ StringTerms agg = (StringTerms) aggPage.getAggregation("brands"); // 3.2ã€èŽ·å–æ¡¶ List&lt;StringTerms.Bucket&gt; buckets = agg.getBuckets(); // 3.3ã€éåŽ† for (StringTerms.Bucket bucket : buckets) &#123; // 3.4ã€èŽ·å–æ¡¶ä¸­çš„keyï¼Œå³å“ç‰Œåç§° System.out.println(bucket.getKeyAsString()); // 3.5ã€èŽ·å–æ¡¶ä¸­çš„æ–‡æ¡£æ•°é‡ System.out.println(bucket.getDocCount()); &#125;&#125; æ˜¾ç¤ºçš„ç»“æžœï¼š å…³é”®APIï¼š AggregationBuildersï¼šèšåˆçš„æž„å»ºå·¥åŽ‚ç±»ã€‚æ‰€æœ‰èšåˆéƒ½ç”±è¿™ä¸ªç±»æ¥æž„å»ºï¼Œçœ‹çœ‹ä»–çš„é™æ€æ–¹æ³•ï¼š AggregatedPageï¼šèšåˆæŸ¥è¯¢çš„ç»“æžœç±»ã€‚å®ƒæ˜¯Page&lt;T&gt;çš„å­æŽ¥å£ï¼š AggregatedPageåœ¨PageåŠŸèƒ½çš„åŸºç¡€ä¸Šï¼Œæ‹“å±•äº†ä¸Žèšåˆç›¸å…³çš„åŠŸèƒ½ï¼Œå®ƒå…¶å®žå°±æ˜¯å¯¹èšåˆç»“æžœçš„ä¸€ç§å°è£…ï¼Œå¤§å®¶å¯ä»¥å¯¹ç…§èšåˆç»“æžœçš„JSONç»“æž„æ¥çœ‹ã€‚ è€Œè¿”å›žçš„ç»“æžœéƒ½æ˜¯Aggregationç±»åž‹å¯¹è±¡ï¼Œä¸è¿‡æ ¹æ®å­—æ®µç±»åž‹ä¸åŒï¼Œåˆæœ‰ä¸åŒçš„å­ç±»è¡¨ç¤º æˆ‘ä»¬çœ‹ä¸‹é¡µé¢çš„æŸ¥è¯¢çš„JSONç»“æžœä¸ŽJavaç±»çš„å¯¹ç…§å…³ç³»ï¼š 5.6.2.åµŒå¥—èšåˆï¼Œæ±‚å¹³å‡å€¼ä»£ç ï¼š 1234567891011121314151617181920212223242526272829@Testpublic void testSubAgg()&#123; NativeSearchQueryBuilder queryBuilder = new NativeSearchQueryBuilder(); // ä¸æŸ¥è¯¢ä»»ä½•ç»“æžœ queryBuilder.withSourceFilter(new FetchSourceFilter(new String[]&#123;""&#125;, null)); // 1ã€æ·»åŠ ä¸€ä¸ªæ–°çš„èšåˆï¼Œèšåˆç±»åž‹ä¸ºtermsï¼Œèšåˆåç§°ä¸ºbrandsï¼Œèšåˆå­—æ®µä¸ºbrand queryBuilder.addAggregation( AggregationBuilders.terms("brands").field("brand") .subAggregation(AggregationBuilders.avg("priceAvg").field("price")) // åœ¨å“ç‰Œèšåˆæ¡¶å†…è¿›è¡ŒåµŒå¥—èšåˆï¼Œæ±‚å¹³å‡å€¼ ); // 2ã€æŸ¥è¯¢,éœ€è¦æŠŠç»“æžœå¼ºè½¬ä¸ºAggregatedPageç±»åž‹ AggregatedPage&lt;Item&gt; aggPage = (AggregatedPage&lt;Item&gt;) this.itemRepository.search(queryBuilder.build()); // 3ã€è§£æž // 3.1ã€ä»Žç»“æžœä¸­å–å‡ºåä¸ºbrandsçš„é‚£ä¸ªèšåˆï¼Œ // å› ä¸ºæ˜¯åˆ©ç”¨Stringç±»åž‹å­—æ®µæ¥è¿›è¡Œçš„termèšåˆï¼Œæ‰€ä»¥ç»“æžœè¦å¼ºè½¬ä¸ºStringTermç±»åž‹ StringTerms agg = (StringTerms) aggPage.getAggregation("brands"); // 3.2ã€èŽ·å–æ¡¶ List&lt;StringTerms.Bucket&gt; buckets = agg.getBuckets(); // 3.3ã€éåŽ† for (StringTerms.Bucket bucket : buckets) &#123; // 3.4ã€èŽ·å–æ¡¶ä¸­çš„keyï¼Œå³å“ç‰Œåç§° 3.5ã€èŽ·å–æ¡¶ä¸­çš„æ–‡æ¡£æ•°é‡ System.out.println(bucket.getKeyAsString() + "ï¼Œå…±" + bucket.getDocCount() + "å°"); // 3.6.èŽ·å–å­èšåˆç»“æžœï¼š InternalAvg avg = (InternalAvg) bucket.getAggregations().asMap().get("priceAvg"); System.out.println("å¹³å‡å”®ä»·ï¼š" + avg.getValue()); &#125;&#125; ç»“æžœï¼š]]></content>
      <categories>
        <category>Elasticsearch</category>
      </categories>
      <tags>
        <tag>Elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysqlä¼˜åŒ–]]></title>
    <url>%2F2019%2F03%2F27%2Fmysql%E4%BC%98%E5%8C%96%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–ï¼Ÿ1ã€ç³»ç»Ÿçš„åžåé‡ç“¶é¢ˆå¾€å¾€å‡ºçŽ°åœ¨æ•°æ®åº“çš„è®¿é—®é€Ÿåº¦ä¸Š2ã€éšç€åº”ç”¨ç¨‹åºçš„è¿è¡Œï¼Œæ•°æ®åº“çš„ä¸­çš„æ•°æ®ä¼šè¶Šæ¥è¶Šå¤šï¼Œå¤„ç†æ—¶é—´ä¼šç›¸åº”å˜æ…¢3ã€æ•°æ®æ˜¯å­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„ï¼Œè¯»å†™é€Ÿåº¦æ— æ³•å’Œå†…å­˜ç›¸æ¯” å¦‚ä½•ä¼˜åŒ–1ã€è®¾è®¡æ•°æ®åº“æ—¶ï¼šæ•°æ®åº“è¡¨ã€å­—æ®µçš„è®¾è®¡ï¼Œå­˜å‚¨å¼•æ“Ž2ã€åˆ©ç”¨å¥½MySQLè‡ªèº«æä¾›çš„åŠŸèƒ½ï¼Œå¦‚ç´¢å¼•ç­‰3ã€æ¨ªå‘æ‰©å±•ï¼šMySQLé›†ç¾¤ã€è´Ÿè½½å‡è¡¡ã€è¯»å†™åˆ†ç¦»4ã€SQLè¯­å¥çš„ä¼˜åŒ–ï¼ˆæ–‡ç« ä¸»è¦è®²è§£ï¼‰ ä¸€ã€å­˜å‚¨å¼•æ“Žçš„é€‰æ‹©1ã€æ—©æœŸé—®é¢˜ï¼šå¦‚ä½•é€‰æ‹©MyISAMå’ŒInnodbï¼ŸçŽ°åœ¨ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜äº†ï¼ŒInnodbä¸æ–­å®Œå–„ï¼Œä»Žå„ä¸ªæ–¹é¢èµ¶è¶…MyISAMï¼Œä¹Ÿæ˜¯MySQLé»˜è®¤ä½¿ç”¨çš„ã€‚å­˜å‚¨å¼•æ“ŽStorage engineï¼šMySQLä¸­çš„æ•°æ®ã€ç´¢å¼•ä»¥åŠå…¶ä»–å¯¹è±¡æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Œæ˜¯ä¸€å¥—æ–‡ä»¶ç³»ç»Ÿçš„å®žçŽ° 2ã€å­˜å‚¨å·®å¼‚ 3ã€é€‰æ‹©ä¾æ®MyISAMï¼šä»¥è¯»å†™æ’å…¥ä¸ºä¸»çš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚åšå®¢ç³»ç»Ÿã€æ–°é—»é—¨æˆ·ç½‘ç«™ã€‚Innodbï¼šæ›´æ–°ï¼ˆåˆ é™¤ï¼‰æ“ä½œé¢‘çŽ‡ä¹Ÿé«˜ï¼Œæˆ–è€…è¦ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼›å¹¶å‘é‡é«˜ï¼Œæ”¯æŒäº‹åŠ¡å’Œå¤–é”®ä¿è¯æ•°æ®å®Œæ•´æ€§ã€‚æ¯”å¦‚OAè‡ªåŠ¨åŒ–åŠžå…¬ç³»ç»Ÿã€‚ äºŒã€ç´¢å¼•çš„ä½¿ç”¨1ã€ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿï¼ˆ1ï¼‰ã€ç´¢å¼•æ˜¯å¸®åŠ©mysqlé«˜æ•ˆ èŽ·å–æ•°æ®çš„æ•°æ®ç»“æž„ï¼ˆæŽ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾æ•°æ®ç»“æž„ï¼‰ï¼ˆ2ï¼‰ã€ç´¢å¼•åˆ°æ—¶æŒ‡Bæ ‘ï¼ˆå¤šè·¯æœç´¢æ ‘ï¼Œä¸ä¸€å®šæ˜¯äºŒå‰çš„ï¼‰ç»“æž„ç»„ç»‡çš„ç´¢å¼• 2ã€å¦‚ä½•ä½¿ç”¨explainæ¥æŸ¥çœ‹æ˜¯å¦ä½¿ç”¨ç´¢å¼•ï¼ˆ1ï¼‰ã€ explainå…³é”®å­—çš„ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠå®ƒæ”¾åœ¨selectæŸ¥è¯¢è¯­å¥çš„å‰é¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šï¼ˆ2ï¼‰ã€è§£é‡Šä¸‹ä¸Šå›¾ä¸­å„å­—æ®µçš„æ„ä¹‰â‘ id:idå€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œï¼ˆä¸€èˆ¬æœ‰å­æŸ¥è¯¢çš„idå€¼è¶Šå¤§ï¼‰ï¼›idâ‘¡å€¼å¦‚æžœç›¸åŒï¼Œä»Žä¸Šåˆ°ä¸‹é¡ºåºæ‰§è¡Œï¼ˆè¡¨çš„è¯»å–é¡ºåºï¼‰â‘¡select_type:æŸ¥è¯¢çš„ç±»åž‹ï¼Œä¸»è¦åŒºåˆ«æ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰å¤æ‚æŸ¥è¯¢ï¼ˆè¿™ä¸ªå€¼ä¸éœ€è¦é‡ç‚¹çœ‹ï¼‰â‘¢table:æ˜¾ç¤ºçš„æŸ¥è¯¢è¡¨åï¼Œå¦‚æžœæŸ¥è¯¢ä½¿ç”¨äº†åˆ«åï¼ˆè¿™ä¸ªå€¼ä¸éœ€è¦é‡ç‚¹çœ‹ï¼‰â‘£type:ä»Žæœ€å¥½åˆ°æœ€å·®çš„ä¾æ¬¡æ˜¯system&gt;const&gt;eq_ref&gt;range&gt;index&gt;ALL,é™¤äº†ALLæ²¡æœ‰ä½¿ç”¨åˆ°ç´¢å¼•ä¹‹å¤–ï¼Œå…¶ä»–éƒ½ä½¿ç”¨ç´¢å¼•ï¼Œå…·ä½“ä»‹ç»å¦‚ä¸‹å›¾â‘¤possible_keys:æŸ¥è¯¢å¯èƒ½ä½¿ç”¨åˆ°çš„ç´¢å¼•éƒ½ä¼šåœ¨è¿™é‡Œåˆ—å‡ºæ¥â‘¥key:æŸ¥è¯¢çœŸæ­£ä½¿ç”¨åˆ°çš„ç´¢å¼•ï¼Œselect_typeä¸ºindex_mergeæ—¶ï¼Œè¿™é‡Œå¯èƒ½å‡ºçŽ°ä¸¤ä¸ªä»¥ä¸Šçš„ç´¢å¼•ï¼Œå…¶ä»–çš„select_typeè¿™é‡Œåªä¼šå‡ºçŽ°ä¸€ä¸ªã€‚å¦‚æžœä¸ºnullï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•â‘¦rows:æ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•é€‰ç”¨æƒ…å†µï¼Œå¤§è‡´ä¼°ç®—å‡ºæ‰¾åˆ°æ‰€éœ€çš„è®°å½•æ‰€éœ€è¦è¯»å–çš„è¡Œæ•°ï¼ˆè¶Šå°è¶Šå¥½ï¼‰ ä¸‰ã€SQLè¯­å¥çš„ä¼˜åŒ–1ã€å¯¹è¿›è¡Œå¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œåº”å°½é‡é¿å…å…¨è¡¨æ‰«æï¼Œé¦–å…ˆåº”è€ƒè™‘åœ¨ where åŠ order by æ¶‰åŠçš„åˆ—ä¸Šå»ºç«‹ç´¢å¼•ã€‚2ã€select*ä¼šè¿›è¡Œå…¨è¡¨æ‰«æï¼Œè¦æ±‚selectåŽé¢ç›´æŽ¥æŽ¥ä¸Šå­—æ®µå3ã€åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œ null å€¼åˆ¤æ–­ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“Žæ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æselect id from employee where num is null(é”™è¯¯)select id from t where num=0ï¼ˆæ­£ç¡®ï¼‰ 4ã€åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨!=æˆ–&lt;&gt;æ“ä½œç¬¦ï¼Œå¦åˆ™å°†å¼•æ“Žæ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚5ã€å°½é‡å°‘ç”¨orï¼Œä½¿ç”¨union allï¼ˆåŒ…æ‹¬é‡å¤ï¼Œä¸è¿›è¡ŒæŽ’åºï¼‰æˆ–è€…æ˜¯unionï¼ˆè‡ªåŠ¨åŽ»é™¤é‡å¤çš„å€¼ï¼Œé»˜è®¤è§„åˆ™çš„æŽ’åºï¼‰ä»£æ›¿or6ã€èƒ½ç”¨betweenå°±ä¸è¦ç”¨inã€not in7ã€ä¸å»ºè®®ä½¿ç”¨%å‰ç¼€æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¦‚likeâ€œ%nameâ€ï¼Œâ€œ%name%â€ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨likeâ€œname%â€ï¼Œè¿™ç§æŸ¥è¯¢ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆè€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œmysqlä½¿ç”¨å…¨æ–‡ç´¢å¼•å¯è§£å†³è¿™ä¸ªé—®é¢˜8ã€åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œè¡¨è¾¾å¼æ“ä½œï¼Œè¿™å°†å¯¼è‡´å¼•æ“Žæ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æselect id from t where num/2=100ï¼ˆé”™è¯¯ï¼‰select id from t where num=100*2ï¼ˆæ­£ç¡®ï¼‰ 9ã€åº”å°½é‡é¿å…åœ¨whereå­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œå‡½æ•°æ“ä½œï¼Œè¿™å°†å¯¼è‡´å¼•æ“Žæ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æselect id from t where substring(name,1,3)=â€™abcâ€™â€“nameä»¥abcå¼€å¤´çš„idï¼ˆé”™è¯¯ï¼‰select id from t where name like â€˜abc%â€™ï¼ˆæ­£ç¡®ï¼‰ 10ã€ç”¨ exists ä»£æ›¿ in æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©select num from a where num in(select num from b)ï¼ˆé”™è¯¯ï¼‰select num from a where exists(select 1 from b where num=a.num)ï¼ˆæ­£ç¡®ï¼‰ 11ã€å°½å¯èƒ½çš„ä½¿ç”¨ varchar ä»£æ›¿ char ï¼Œå› ä¸ºé¦–å…ˆå˜é•¿å­—æ®µå­˜å‚¨ç©ºé—´å°ï¼Œå¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œå…¶æ¬¡å¯¹äºŽæŸ¥è¯¢æ¥è¯´ï¼Œåœ¨ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„å­—æ®µå†…æœç´¢æ•ˆçŽ‡æ˜¾ç„¶è¦é«˜äº›ã€‚]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinuxçŽ¯å¢ƒä¸‹é…ç½®redisä»¥åŠredisç›¸å…³æ“ä½œ]]></title>
    <url>%2F2019%2F03%2F22%2Flinux%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%85%8D%E7%BD%AEredis%E4%BB%A5%E5%8F%8Aredis%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%2F</url>
    <content type="text"><![CDATA[å‰è¨€æ­¤æ–‡ç« ä¸»è¦æ˜¯åœ¨LinuxæœåŠ¡å™¨ä¸Šé…ç½®redisã€ä½¿ç”¨redisè¿›è¡Œç›¸å…³æ“ä½œä»¥åŠä½¿ç”¨RedisDesktopManagerè¿›è¡Œè¿œç¨‹è¿žæŽ¥ã€‚Redisæ˜¯å½“å‰æ¯”è¾ƒçƒ­é—¨çš„NOSQLç³»ç»Ÿä¹‹ä¸€ï¼Œå®ƒæ˜¯ä¸€ä¸ªkey-valueå­˜å‚¨ç³»ç»Ÿã€‚å’ŒMemcacheç±»ä¼¼ï¼Œä½†å¾ˆå¤§ç¨‹åº¦è¡¥å¿äº†Memcacheçš„ä¸è¶³ï¼Œå®ƒæ”¯æŒå­˜å‚¨çš„valueç±»åž‹ç›¸å¯¹æ›´å¤šï¼ŒåŒ…æ‹¬stringã€listã€setã€zsetå’Œhashã€‚è¿™äº›æ•°æ®ç±»åž‹éƒ½æ”¯æŒpush/popã€add/removeåŠå–äº¤é›†å¹¶é›†å’Œå·®é›†åŠæ›´ä¸°å¯Œçš„æ“ä½œã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒRedisæ”¯æŒå„ç§ä¸åŒæ–¹å¼çš„æŽ’åºã€‚å’ŒMemcacheä¸€æ ·ï¼ŒRedisæ•°æ®éƒ½æ˜¯ç¼“å­˜åœ¨è®¡ç®—æœºå†…å­˜ä¸­ï¼Œä¸åŒçš„æ˜¯ï¼ŒMemcacheåªèƒ½å°†æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œæ— æ³•è‡ªåŠ¨å®šæœŸå†™å…¥ç¡¬ç›˜ï¼Œè¿™å°±è¡¨ç¤ºï¼Œä¸€æ–­ç”µæˆ–é‡å¯ï¼Œå†…å­˜æ¸…ç©ºï¼Œæ•°æ®ä¸¢å¤±ã€‚æ‰€ä»¥Memcacheçš„åº”ç”¨åœºæ™¯é€‚ç”¨äºŽç¼“å­˜æ— éœ€æŒä¹…åŒ–çš„æ•°æ®ã€‚è€ŒRedisä¸åŒçš„æ˜¯å®ƒä¼šå‘¨æœŸæ€§çš„æŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ï¼Œå®žçŽ°æ•°æ®çš„æŒä¹…åŒ–ã€‚ ä¸€ã€åœ¨LinuxæœåŠ¡å™¨ä¸Šå®‰è£…Redis1ã€åœ¨linuxçŽ¯å¢ƒä¸­ä¸‹è½½å¹¶è§£åŽ‹rediså®‰è£…åŒ…,å°†å®‰è£…åŒ…è§£åŽ‹åˆ°/usr/localç›®å½•,å‘½ä»¤è¡Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤12wget http://download.redis.io/releases/redis-4.0.7tar -xzf redis-4.0.7.tar.gz -C /usr/local 2ã€æ‰§è¡Œmakeå¯¹Redisè§£åŽ‹åŽæ–‡ä»¶è¿›è¡Œç¼–è¯‘1make 3ã€ç¼–è¯‘æˆåŠŸåŽï¼Œè¿›å…¥srcæ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œmake installè¿›è¡ŒRediså®‰è£…12cd srcmake install äºŒã€Reidsçš„éƒ¨ç½²1ã€ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œå°†Redisæ–‡ä»¶ä¸­çš„confé…ç½®æ–‡ä»¶å’Œå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°ç»Ÿä¸€æ–‡ä»¶ä¸­åŽ»12mdkir /usr/local/rediscp /usr/local/redis-4.0.7/redis.conf /usr/local/redis 2ã€ä¿®æ”¹redisé…ç½®æ–‡ä»¶ï¼ˆ/usr/local/redis/redis.confï¼‰ï¼Œä»¥ä¸‹æ˜¯éœ€è¦ä¿®æ”¹çš„å†…å®¹1234vim /usr/local/redis/redis.confdaemonize yes(åŽå°å¼€å¯Redis,é»˜è®¤ä¸å¼€å¯)bind 127.0.0.1(æ³¨é‡ŠæŽ‰ä¸»æœºåœ°å€ï¼Œä¸ç„¶åªèƒ½æœ¬åœ°è¿žæŽ¥)requirepass å¯†ç ï¼ˆç™»å½•Redisçš„å¯†ç ï¼Œé»˜è®¤æ— å¯†ç ï¼‰ 3ã€Redisç›¸å…³æµ‹è¯•1ã€å¯åŠ¨Redis12cd /usr/local/redis/bin./redis-server 2ã€è¿žæŽ¥Redis1./redis-cli 3ã€æŸ¥çœ‹Redisæ˜¯å¦åœ¨è¿è¡Œ:1ps -ef|grep redis 4ã€ä¿®æ”¹é…ç½®æ–‡ä»¶åŽï¼Œç”±äºŽä¹‹å‰å·²å¼€å¯Redisè¿›ç¨‹ï¼Œæ‰€ä»¥éœ€è¦å…ˆå…³é—­Redisè¿›ç¨‹ï¼Œå†é‡å¯Redisï¼Œæ–¹æ³•å¦‚ä¸‹ï¼šä½¿ç”¨å‘½ä»¤æŸ¥çœ‹æ˜¯å¦è¿˜å¤„äºŽç›‘å¬çŠ¶æ€1netstat -nlt é‡æ–°å¯åŠ¨Redis12cd /usr/local/redis/bin./redis-server 5ã€æµ‹è¯•æœ¬åœ°è¿žæŽ¥æ˜¯å¦æˆåŠŸ6ã€æµ‹è¯•RedisDesktopManagerè¿œç¨‹è¿žæŽ¥æ˜¯å¦æˆåŠŸ ä¸‰ã€Redisçš„ç›¸å…³æ“ä½œRedisæ”¯æŒäº”ç§æ•°æ®ç±»åž‹ï¼šstringï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œhashï¼ˆå“ˆå¸Œï¼‰ï¼Œlistï¼ˆåˆ—è¡¨ï¼‰ï¼Œsetï¼ˆé›†åˆï¼‰åŠzset(sorted setï¼šæœ‰åºé›†åˆ)ã€‚ 1ã€Stringï¼ˆå­—ç¬¦ä¸²ï¼‰string æ˜¯ redis æœ€åŸºæœ¬çš„ç±»åž‹ï¼Œä½ å¯ä»¥ç†è§£æˆä¸Ž Memcached ä¸€æ¨¡ä¸€æ ·çš„ç±»åž‹ï¼Œä¸€ä¸ª key å¯¹åº”ä¸€ä¸ª valueã€‚ string ç±»åž‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„æ€æ˜¯ redis çš„ string å¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚jpgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚ 2ã€Hashï¼ˆå“ˆå¸Œï¼‰Redis hash æ˜¯ä¸€ä¸ªé”®å€¼(key=&gt;value)å¯¹é›†åˆã€‚ Redis hash æ˜¯ä¸€ä¸ª string ç±»åž‹çš„ field å’Œ value çš„æ˜ å°„è¡¨ï¼Œhash ç‰¹åˆ«é€‚åˆç”¨äºŽå­˜å‚¨å¯¹è±¡ã€‚ 3ã€Listï¼ˆåˆ—è¡¨ï¼‰Redis åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæŽ’åºã€‚ä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚ 4ã€Setï¼ˆé›†åˆï¼‰Redisçš„Setæ˜¯stringç±»åž‹çš„æ— åºé›†åˆã€‚ é›†åˆæ˜¯é€šè¿‡å“ˆå¸Œè¡¨å®žçŽ°çš„ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„å¤æ‚åº¦éƒ½æ˜¯O(1)ã€‚ 5ã€zset(sorted setï¼šæœ‰åºé›†åˆ)Redis zset å’Œ set ä¸€æ ·ä¹Ÿæ˜¯stringç±»åž‹å…ƒç´ çš„é›†åˆ,ä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜ã€‚ ä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»åž‹çš„åˆ†æ•°ã€‚redisæ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»Žå°åˆ°å¤§çš„æŽ’åºã€‚ zsetçš„æˆå‘˜æ˜¯å”¯ä¸€çš„,ä½†åˆ†æ•°(score)å´å¯ä»¥é‡å¤ã€‚ 6ã€å…·ä½“ç›¸å…³æ“ä½œRediså‘½ä»¤å‚è€ƒï¼š http://redisdoc.com/persistence/save.htmlæˆ–è€… http://www.runoob.com/redis/redis-data-types.html]]></content>
      <categories>
        <category>linuxæœåŠ¡å™¨</category>
        <category>redis</category>
      </categories>
      <tags>
        <tag>redis</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linuxæœåŠ¡å™¨æ­å»ºjavaçŽ¯å¢ƒ]]></title>
    <url>%2F2019%2F03%2F14%2Flinux%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAjava%E7%8E%AF%E5%A2%83%2F</url>
    <content type="text"><![CDATA[å‰è¨€è¿™ç¯‡æ–‡ç« ä¸»è¦è®²è§£åœ¨linuxæœåŠ¡å™¨ä¸‹é…ç½®javaçŽ¯å¢ƒï¼Œæˆ‘é€‰æ‹©çš„é˜¿é‡Œäº‘çš„æœåŠ¡å™¨ï¼Œå­¦ç”Ÿä»·9.5å…ƒä¸€ä¸ªæœˆï¼Œå¯¹äºŽå­¦ç”Ÿæ¥è¯´æ¯”è¾ƒä¾¿å®œï¼ŒæŽ¨èè´­ä¹°ã€‚å­¦ç”ŸæœåŠ¡å™¨è´­ä¹°ç½‘å€ï¼šhttps://promotion.aliyun.com/ntms/campus2017.html, è´­ä¹°éœ€è¦è¿›è¡Œå®žåéªŒè¯å’Œå­¦ç”ŸéªŒè¯ï¼Œå¤§éƒ¨åˆ†æœåŠ¡éƒ½æ˜¯linuxæœåŠ¡å™¨ï¼Œä¸‹é¢çš„æˆªå›¾æ˜¯æˆ‘æœåŠ¡å™¨çš„é…ç½®ï¼ŒæŽ¨èå¤§å®¶é€‰æ‹©CentOSç³»ç»Ÿ æœåŠ¡å™¨javaçŽ¯å¢ƒæ‰‹åŠ¨æ­å»º1ã€å·¥å…·å‡†å¤‡æˆ‘ä»¬éœ€è¦ä¸¤æ¬¾è½¯ä»¶æ¥è¿žæŽ¥æœåŠ¡å™¨ï¼Œä¸€ä¸ªå«Xshellï¼Œç”¨æ¥æ“æŽ§æœåŠ¡å™¨ï¼Œå¦ä¸€ä¸ªå«Xftpï¼Œç”¨æ¥è¿›è¡ŒæœåŠ¡å™¨å’Œè‡ªå·±ç”µè„‘ä¹‹é—´çš„æ–‡ä»¶ä¼ è¾“ã€‚ 2ã€Xshellçš„è¿žæŽ¥Xhellè¿žæŽ¥å¾ˆç®€å•ï¼Œé¦–å…ˆè¾“å…¥è‡ªå·±æœåŠ¡å™¨çš„ipåœ°å€ï¼Œç‚¹å‡»è¿žæŽ¥ï¼Œå‡ºçŽ°ç„¶åŽè¾“å…¥ç”¨æˆ·årootï¼Œè¾“å…¥ä¹‹å‰åœ¨æœåŠ¡å™¨ä¸Šè®¾ç½®çš„rootå¯†ç ï¼Œå½“å±å¹•å‡ºçŽ°Welcome to Alibaba Cloud Elastic Compute Serviceï¼Œè¡¨ç¤ºç™»å½•æˆåŠŸ 3ã€Xftpçš„è¿žæŽ¥Xftpçš„ç™»å½•å’ŒXShellç±»ä¼¼ï¼Œè¾“å…¥æœåŠ¡å™¨IPï¼Œè¾“å…¥ç”¨æˆ·årootï¼Œç„¶åŽè¾“å…¥rootå¯†ç ï¼Œå·¦è¾¹æ¡†ä¸ºä½ è‡ªå·±ç”µè„‘ä¸Šçš„æ–‡ä»¶ï¼Œå³è¾¹æ¡†ä¸ºlinuxæœåŠ¡å™¨çš„æ–‡ä»¶ï¼Œå·¦å³æ‹–åŠ¨æ¥è¿›è¡Œæ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œåœ¨ç”µè„‘å…ˆä¸‹è½½å¥½linuxç‰ˆæœ¬çš„tomcatã€nginxã€jdkåŽ‹ç¼©åŒ…ï¼Œä¸‹é¢çš„æˆªå›¾æ˜¯æˆ‘å·²ç»ä¸‹è½½å¥½å¹¶ç§»åˆ°linux 4ã€JDKçš„å®‰è£…å°†jdkåŽ‹ç¼©åŒ…è§£åŽ‹åˆ°/usr/localç›®å½•ä¸‹ ä½¿ç”¨viç¼–è¾‘å™¨æ‰“å¼€/etc/profileé…ç½®æ–‡ä»¶ï¼Œè¿›è¡ŒjdkçŽ¯å¢ƒå˜é‡çš„é…ç½®ï¼Œåœ¨æºæ–‡ä»¶çš„æœ€åŽç©ºä¸€è¡Œï¼Œå†™å…¥å¦‚ä¸‹ä»£ç #set java environment JAVA_HOME=/usr/local/jdk1.8.0_161 CLASSPATH=.:$JAVA_HOME/lib.tools.jar PATH=$JAVA_HOME/bin:$PATH export JAVA_HOME CLASSPATH PATH ä½¿ç”¨source /etc/profileé‡æ–°åŠ è½½/etc/profileé…ç½®æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨java -versionæµ‹è¯•jdkæ˜¯å¦å®‰è£…æˆåŠŸ,å¦‚æžœå‡ºçŽ°java version ç‰ˆæœ¬å·è¯´æ˜Žå®‰è£…æˆåŠŸ 5ã€tomcatçš„å®‰è£…å°†tomcatåŽ‹ç¼©åŒ…è§£åŽ‹åˆ°/usr/localç›®å½•ä¸‹,è¿›å…¥/usr/localç›®å½•ï¼Œä»¥ç¡®è®¤tomcatè§£åŽ‹åˆ°/usr/localä¸‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒLinuxä¸ä¼šå¼€æ”¾ç«¯å£å·ï¼Œéœ€æ‰‹åŠ¨å°†8080ç«¯å£å·å¼€æ”¾ï¼Œå¹¶åœ¨æœåŠ¡å™¨å®‰å…¨ç»„ä¸­æ·»åŠ 8080ç«¯å£å¤–ç½‘è®¿é—®ï¼ŒéšåŽè¿›å…¥tomcatçš„binä¸­å¼€å¯tomcatæœåŠ¡ï¼Œå¦‚æžœå®‰è£…æˆåŠŸï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥æœåŠ¡å™¨ip:8008å¯èŽ·å–åˆ°tomcatçš„å®˜æ–¹é¡µé¢ï¼Œæˆªå›¾å¦‚ä¸‹ 6ã€nginxçš„å®‰è£…å®‰è£…nginxä¾èµ–çŽ¯å¢ƒgcc,å®‰è£…æœŸé—´æœ‰æç¤ºä¸€å¾‹é€‰y yum install gcc-c++ yum -y install pcre pcre-devel yum -y install zlib zlib-devel yum -y install openssl openssl-devel å°†nginxåŽ‹ç¼©åŒ…è§£åŽ‹åˆ°/usr/localç›®å½•ä¸‹ tar -xvf nginx-1.15.9.tar.gz -C /usr/local/ è¿›å…¥nginxç›®å½•ï¼Œç¼–è¯‘å¹¶å®‰è£…nginx ./configure make make install å¼€æ”¾linuxçš„å¯¹å¤–è®¿é—®ç«¯å£80ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinuxä¸ä¼šå¼€æ”¾ç«¯å£å·ï¼Œéœ€è¦æ‰‹åŠ¨å¼€æ”¾ç«¯å£å·ã€‚ /sbin/iptables -I INPUT -p tcp --dport 80 -j ACCEPT è¿›å…¥nginx/sbinç›®å½•ï¼Œå¹¶å¯åŠ¨nginx cd /usr/local/nginx/sbin ./nginx å¦‚æžœå¯åŠ¨æˆåŠŸï¼Œå°†ä¼šå‡ºçŽ°ä¸‹é¢çš„æˆªå›¾é¡µé¢ 7ã€mysqlçš„å®‰è£…å®‰è£…ä¾èµ– yum -y install perl perl-devel autoconf libaio æŠŠä¸‹è½½çš„å®‰è£…åŒ…è§£åŽ‹åˆ°/usr/localä¸‹ï¼Œå¹¶æ”¹åä¸ºmysql tar -xvf mysql-5.6.43-linux-glibc2.12-x86_64.tar.gz -C /usr/local/ cd /usr/local mv mysql-5.6.43-linux-glibc2.12-x86_64.tar.gz mysql æ·»åŠ ç³»ç»Ÿmysqlç»„åˆmysqlç”¨æˆ· groupadd mysql useradd -r -g mysql -s /bin/false mysql è¿›å…¥å®‰è£…mysqlè½¯ä»¶ç›®å½•ï¼Œä¿®æ”¹ç›®å½•æ‹¥æœ‰è€…ä¸ºmysqlç”¨æˆ· cd mysql/ chown -R mysql:mysql ./ å®‰è£…æ•°æ®åº“ ./scripts/mysql_install_db --user=mysql ä¿®æ”¹å½“å‰ç›®å½•æ‹¥æœ‰è€…ä¸ºrootç”¨æˆ· chown -R root:root ./ ä¿®æ”¹å½“å‰dataç›®å½•æ‹¥æœ‰è€…ä¸ºmysqlç”¨æˆ· chown -R mysql:mysql data å¯åŠ¨mysqlæœåŠ¡å’Œæ·»åŠ å¼€æœºå¯åŠ¨mysqlæœåŠ¡ï¼š cp support-files/mysql.server /etc/init.d/mysql å¯åŠ¨mysqlæœåŠ¡ï¼Œå¦‚æžœå¯åŠ¨å¤±è´¥ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ service mysql start touch /var/log/mariadb.log(å¤±è´¥æ‰æ‰§è¡Œ) ä¿®æ”¹mysqlçš„rootç”¨æˆ·å¯†ç ï¼Œrootåˆå§‹å¯†ç ä¸ºç©ºçš„ï¼š ./bin/mysqladmin -u root password å¯†ç  æŠŠmysqlå®¢æˆ·ç«¯æ”¾åˆ°é»˜è®¤è·¯å¾„ ln -s /usr/local/mysql/bin/mysql /usr/local/bin/mysql è¿žæŽ¥æ•°æ®åº“,æˆåŠŸè¿žæŽ¥å¦‚ä¸‹å›¾ï¼š mysql -uroot -p 8ã€å°†é¡¹ç›®éƒ¨ç½²åˆ°linuxæœåŠ¡å™¨ä¸Šå°†é¡¹ç›®æ‰“åŒ…æˆ.waræ ¼å¼ä½¿ç”¨Xftpå·¥å…·å°†æ‰“åŒ…å¥½çš„waråŒ…å¤åˆ¶åˆ°tomcatä¸‹çš„webappsç›®å½•å¦‚ä½•è®¿é—®é¡¹ç›®ï¼šhttp://ipåœ°å€:8080/é¡¹ç›®åç§°,å¦‚ä¸‹å›¾ â€‹ â€‹]]></content>
      <categories>
        <category>linuxæœåŠ¡å™¨</category>
        <category>java</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
        <tag>jdk</tag>
        <tag>nginx</tag>
      </tags>
  </entry>
</search>
